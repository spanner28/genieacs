#!/usr/bin/env node
"use strict";const jobs=new Set,fileName=process.argv[2];let script;function errorToFault(e){if(!e)return null;if(!e.name)return{code:"ext",message:`${e}`};const s={code:`ext.${e.name}`,message:e.message,detail:{name:e.name,message:e.message}};if(e.stack){s.detail.stack=e.stack;const c=s.detail.stack.match(/\s+at\s[^\s]+\s\(.*genieacs-ext:.+\)/);c&&(s.detail.stack=s.detail.stack.slice(0,c.index))}return s}process.on("uncaughtException",e=>{const s=errorToFault(e);jobs.forEach(e=>{process.send([e,s,null])}),jobs.clear(),process.disconnect()}),process.on("message",e=>{if(jobs.add(e[0]),!script){const e=process.env.GENIEACS_EXT_DIR;process.chdir(e),script=require(`${e}/${fileName}`)}const s=e[1][0];if(script[s])script[s](e[1].slice(1),(s,c)=>{jobs.delete(e[0])&&process.send([e[0],errorToFault(s),c])});else{const c={code:"ext",message:`No such function '${s}' in extension '${fileName}'`};process.send([e[0],c,null])}}),process.on("SIGINT",()=>{});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuaWVhY3MtZXh0Iiwic291cmNlcyI6WyIuLi8uLi9iaW4vZ2VuaWVhY3MtZXh0Il0sInNvdXJjZXNDb250ZW50IjpudWxsLCJuYW1lcyI6WyJqb2JzIiwiU2V0IiwiZmlsZU5hbWUiLCJwcm9jZXNzIiwiYXJndiIsInNjcmlwdCIsImVycm9yVG9GYXVsdCIsImVyciIsIm5hbWUiLCJjb2RlIiwibWVzc2FnZSIsImZhdWx0IiwiZGV0YWlsIiwic3RhY2siLCJzdGFja1RyaW1JbmRleCIsIm1hdGNoIiwic2xpY2UiLCJpbmRleCIsIm9uIiwiZm9yRWFjaCIsImpvYklkIiwic2VuZCIsImNsZWFyIiwiZGlzY29ubmVjdCIsImFkZCIsImN3ZCIsImVudiIsImNoZGlyIiwicmVxdWlyZSIsImZ1bmNOYW1lIiwicmVzIiwiZGVsZXRlIl0sIm1hcHBpbmdzIjoiO2FBdUJBLE1BQU1BLEtBQU8sSUFBSUMsSUFDWEMsU0FBV0MsUUFBUUMsS0FBSyxHQUM5QixJQUFJQyxPQUVKLFNBQVNDLGFBQWFDLEdBQ3BCLElBQUtBLEVBQUssT0FBTyxLQUVqQixJQUFLQSxFQUFJQyxLQUFNLE1BQU8sQ0FBRUMsS0FBTSxNQUFPQyxXQUFZSCxLQUVqRCxNQUFNSSxFQUFlLENBQ25CRixZQUFhRixFQUFJQyxPQUNqQkUsUUFBU0gsRUFBSUcsUUFDYkUsT0FBUSxDQUNOSixLQUFNRCxFQUFJQyxLQUNWRSxRQUFTSCxFQUFJRyxVQUlqQixHQUFJSCxFQUFJTSxNQUFPLENBQ2JGLEVBQU1DLE9BQWMsTUFBSUwsRUFBSU0sTUFFNUIsTUFBTUMsRUFBaUJILEVBQU1DLE9BQWMsTUFBRUcsTUFDM0Msd0NBRUVELElBQ0ZILEVBQU1DLE9BQWMsTUFBSUQsRUFBTUMsT0FBYyxNQUFFSSxNQUM1QyxFQUNBRixFQUFlRyxRQUtyQixPQUFPTixFQUdUUixRQUFRZSxHQUFHLG9CQUFxQlgsSUFDOUIsTUFBTUksRUFBUUwsYUFBYUMsR0FDM0JQLEtBQUttQixRQUFRQyxJQUNYakIsUUFBUWtCLEtBQUssQ0FBQ0QsRUFBT1QsRUFBTyxTQUU5QlgsS0FBS3NCLFFBQ0xuQixRQUFRb0IsZUFHVnBCLFFBQVFlLEdBQUcsVUFBV1IsSUFHcEIsR0FGQVYsS0FBS3dCLElBQUlkLEVBQVEsS0FFWkwsT0FBUSxDQUNYLE1BQU1vQixFQUFNdEIsUUFBUXVCLElBQXNCLGlCQUMxQ3ZCLFFBQVF3QixNQUFNRixHQUNkcEIsT0FBU3VCLFdBQVdILEtBQU92QixZQUc3QixNQUFNMkIsRUFBV25CLEVBQVEsR0FBRyxHQUU1QixHQUFLTCxPQUFPd0IsR0FTWnhCLE9BQU93QixHQUFVbkIsRUFBUSxHQUFHTSxNQUFNLEdBQUksQ0FBQ1QsRUFBS3VCLEtBQ3JDOUIsS0FBSytCLE9BQU9yQixFQUFRLEtBRXpCUCxRQUFRa0IsS0FBSyxDQUFDWCxFQUFRLEdBQUlKLGFBQWFDLEdBQU11QixVQVovQyxDQUNFLE1BQU1uQixFQUFRLENBQ1pGLEtBQU0sTUFDTkMsNkJBQThCbUIsb0JBQTJCM0IsYUFFM0RDLFFBQVFrQixLQUFLLENBQUNYLEVBQVEsR0FBSUMsRUFBTyxVQVlyQ1IsUUFBUWUsR0FBRyxTQUFVIn0=
