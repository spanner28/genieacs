!function(e){function t(t){for(var r,o,i=t[0],s=t[1],a=0,c=[];a<i.length;a++)o=i[a],n[o]&&c.push(n[o][0]),n[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);for(l&&l(t);c.length;)c.shift()()}var r={},n={0:0};function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(e){var t=[],r=n[e];if(0!==r)if(r)t.push(r[2]);else{var i=new Promise(function(t,o){r=n[e]=[t,o]});t.push(r[2]=i);var s,a=document.createElement("script");a.charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.src=function(e){return o.p+""+e+".app.js"}(e);var l=new Error;s=function(t){a.onerror=a.onload=null,clearTimeout(c);var r=n[e];if(0!==r){if(r){var o=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+o+": "+i+")",l.name="ChunkLoadError",l.type=o,l.request=i,r[1](l)}n[e]=void 0}};var c=setTimeout(function(){s({type:"timeout",target:a})},12e4);a.onerror=a.onload=s,document.head.appendChild(a)}return Promise.all(t)},o.m=e,o.c=r,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o.oe=function(e){throw console.error(e),e};var i=window.webpackJsonp=window.webpackJsonp||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var a=0;a<i.length;a++)t(i[a]);var l=s;o(o.s=17)}([function(e,t,r){"use strict";var n=r(18),o=r(21),i=r(4),s=function(){return n.apply(this,arguments)};s.m=n,s.trust=n.trust,s.fragment=n.fragment,s.mount=i.mount,s.route=r(27),s.render=r(12),s.redraw=i.redraw,s.request=o.request,s.jsonp=o.jsonp,s.parseQueryString=r(15),s.buildQueryString=r(13),s.parsePathname=r(6),s.buildPathname=r(5),s.vnode=r(2),s.PromisePolyfill=r(10),e.exports=s},function(e,t,r){(function(t){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,r,n){"use strict";function o(e){if(!(this instanceof o))return new o(e);this._=e}var i=o.prototype;function s(e,t){for(var r=0;r<e;r++)t(r)}function a(e,t,r){return function(e,t){s(t.length,function(r){e(t[r],r,t)})}(function(r,n,o){t=e(t,r,n,o)},r),t}function l(e,t){return a(function(t,r,n,o){return t.concat([e(r,n,o)])},[],t)}function c(e,r){var n={v:0,buf:r};return s(e,function(){var e;n={v:n.v<<1|(e=n.buf,e[0]>>7),buf:function(e){var r=a(function(e,r,n,o){return e.concat(n===o.length-1?t.from([r,0]).readUInt16BE(0):o.readUInt16BE(n))},[],e);return t.from(l(function(e){return(e<<1&65535)>>8},r))}(n.buf)}}),n}function u(){return void 0!==t}function f(){if(!u())throw new Error("Buffer global does not exist; please use webpack if you need to parse Buffers in the browser.")}function d(e){f();var t=a(function(e,t){return e+t},0,e);if(t%8!=0)throw new Error("The bits ["+e.join(", ")+"] add up to "+t+" which is not an even number of bytes; the total should be divisible by 8");var r,n=t/8,i=(r=function(e){return e>48},a(function(e,t){return e||(r(t)?t:e)},null,e));if(i)throw new Error(i+" bit range requested exceeds 48 bit (6 byte) Number max.");return new o(function(t,r){var o=n+r;return o>t.length?E(r,n.toString()+" bytes"):O(o,a(function(e,t){var r=c(t,e.buf);return{coll:e.coll.concat(r.v),buf:r.buf}},{coll:[],buf:t.slice(r,o)},e).coll)})}function h(e,t){return new o(function(r,n){return f(),n+t>r.length?E(n,t+" bytes for "+e):O(n+t,r.slice(n,n+t))})}function p(e,t){if("number"!=typeof(r=t)||Math.floor(r)!==r||t<0||t>6)throw new Error(e+" requires integer length in range [0, 6].");var r}function m(e){return p("uintBE",e),h("uintBE("+e+")",e).map(function(t){return t.readUIntBE(0,e)})}function g(e){return p("uintLE",e),h("uintLE("+e+")",e).map(function(t){return t.readUIntLE(0,e)})}function v(e){return p("intBE",e),h("intBE("+e+")",e).map(function(t){return t.readIntBE(0,e)})}function w(e){return p("intLE",e),h("intLE("+e+")",e).map(function(t){return t.readIntLE(0,e)})}function y(e){return e instanceof o}function b(e){return"[object Array]"==={}.toString.call(e)}function A(e){return u()&&t.isBuffer(e)}function O(e,t){return{status:!0,index:e,value:t,furthest:-1,expected:[]}}function E(e,t){return b(t)||(t=[t]),{status:!1,index:-1,value:null,furthest:e,expected:t}}function P(e,t){if(!t)return e;if(e.furthest>t.furthest)return e;var r=e.furthest===t.furthest?function(e,t){for(var r={},n=0;n<e.length;n++)r[e[n]]=!0;for(var o=0;o<t.length;o++)r[t[o]]=!0;var i=[];for(var s in r)({}).hasOwnProperty.call(r,s)&&i.push(s);return i.sort(),i}(e.expected,t.expected):t.expected;return{status:e.status,index:e.index,value:e.value,furthest:t.furthest,expected:r}}function x(e,t){if(A(e))return{offset:t,line:-1,column:-1};var r=e.slice(0,t).split("\n");return{offset:t,line:r.length,column:r[r.length-1].length+1}}function j(e){if(!y(e))throw new Error("not a parser: "+e)}function k(e,t){return"string"==typeof e?e.charAt(t):e[t]}function S(e){if("number"!=typeof e)throw new Error("not a number: "+e)}function C(e){if("function"!=typeof e)throw new Error("not a function: "+e)}function $(e){if("string"!=typeof e)throw new Error("not a string: "+e)}var D=2,T=3,I=8,R=5*I,N=4*I,_="  ";function L(e,t){return new Array(t+1).join(e)}function M(e,t,r){var n=t-e.length;return n<=0?e:L(r,n)+e}function U(e,t,r,n){return{from:e-t>0?e-t:0,to:e+r>n?n:e+r}}function z(e,t){var r,n,o,i,s,c=t.index,u=c.offset,f=1;if(u===e.length)return"Got the end of the input";if(A(e)){var d=u-u%I,h=u-d,p=U(d,R,N+I,e.length),m=l(function(e){return l(function(e){return M(e.toString(16),2,"0")},e)},function(e,t){var r=e.length,n=[],o=0;if(r<=t)return[e.slice()];for(var i=0;i<r;i++)n[o]||n.push([]),n[o].push(e[i]),(i+1)%t==0&&o++;return n}(e.slice(p.from,p.to).toJSON().data,I));i=function(e){return 0===e.from&&1===e.to?{from:e.from,to:e.to}:{from:e.from/I,to:Math.floor(e.to/I)}}(p),n=d/I,r=3*h,h>=4&&(r+=1),f=2,o=l(function(e){return e.length<=4?e.join(" "):e.slice(0,4).join(" ")+"  "+e.slice(4).join(" ")},m),(s=(8*(i.to>0?i.to-1:i.to)).toString(16).length)<2&&(s=2)}else{var g=e.split(/\r\n|[\n\r\u2028\u2029]/);r=c.column-1,n=c.line-1,i=U(n,D,T,g.length),o=g.slice(i.from,i.to),s=i.to.toString().length}var v=n-i.from;return A(e)&&(s=(8*(i.to>0?i.to-1:i.to)).toString(16).length)<2&&(s=2),a(function(t,n,o){var a,l=o===v,c=l?"> ":_;return a=A(e)?M((8*(i.from+o)).toString(16),s,"0"):M((i.from+o+1).toString(),s," "),[].concat(t,[c+a+" | "+n],l?[_+L(" ",s)+" | "+M("",r," ")+L("^",f)]:[])},[],o).join("\n")}function B(e,t){return["\n","-- PARSING FAILED "+L("-",50),"\n\n",z(e,t),"\n\n",(r=t.expected,1===r.length?"Expected:\n\n"+r[0]:"Expected one of the following: \n\n"+r.join(", ")),"\n"].join("");var r}function F(e){var t=""+e;return t.slice(t.lastIndexOf("/")+1)}function Y(){for(var e=[].slice.call(arguments),t=e.length,r=0;r<t;r+=1)j(e[r]);return o(function(r,n){for(var o,i=new Array(t),s=0;s<t;s+=1){if(!(o=P(e[s]._(r,n),o)).status)return o;i[s]=o.value,n=o.index}return P(O(n,i),o)})}function W(){var e=[].slice.call(arguments);if(0===e.length)throw new Error("seqMap needs at least one argument");var t=e.pop();return C(t),Y.apply(null,e).map(function(e){return t.apply(null,e)})}function V(){var e=[].slice.call(arguments),t=e.length;if(0===t)return G("zero alternates");for(var r=0;r<t;r+=1)j(e[r]);return o(function(t,r){for(var n,o=0;o<e.length;o+=1)if((n=P(e[o]._(t,r),n)).status)return n;return n})}function q(e,t){return J(e,t).or(Q([]))}function J(e,t){return j(e),j(t),W(e,t.then(e).many(),function(e,t){return[e].concat(t)})}function H(e){$(e);var t="'"+e+"'";return o(function(r,n){var o=n+e.length,i=r.slice(n,o);return i===e?O(o,i):E(n,t)})}function K(e,t){!function(e){if(!(e instanceof RegExp))throw new Error("not a regexp: "+e);for(var t=F(e),r=0;r<t.length;r++){var n=t.charAt(r);if("i"!==n&&"m"!==n&&"u"!==n)throw new Error('unsupported regexp flag "'+n+'": '+e)}}(e),arguments.length>=2?S(t):t=0;var r=function(e){return RegExp("^(?:"+e.source+")",F(e))}(e),n=""+e;return o(function(e,o){var i=r.exec(e.slice(o));if(i){if(0<=t&&t<=i.length){var s=i[0],a=i[t];return O(o+s.length,a)}return E(o,"valid match group (0 to "+i.length+") in "+n)}return E(o,n)})}function Q(e){return o(function(t,r){return O(r,e)})}function G(e){return o(function(t,r){return E(r,e)})}function Z(e){if(y(e))return o(function(t,r){var n=e._(t,r);return n.index=r,n.value="",n});if("string"==typeof e)return Z(H(e));if(e instanceof RegExp)return Z(K(e));throw new Error("not a string, regexp, or parser: "+e)}function X(e){return j(e),o(function(t,r){var n=e._(t,r),o=t.slice(r,n.index);return n.status?E(r,'not "'+o+'"'):O(r,null)})}function ee(e){return C(e),o(function(t,r){var n=k(t,r);return r<t.length&&e(n)?O(r+1,n):E(r,"a character/byte matching "+e)})}function te(e,t){arguments.length<2&&(t=e,e=void 0);var r=o(function(e,n){return r._=t()._,r._(e,n)});return e?r.desc(e):r}function re(){return G("fantasy-land/empty")}i.parse=function(e){if("string"!=typeof e&&!A(e))throw new Error(".parse must be called with a string or Buffer as its argument");var t=this.skip(se)._(e,0);return t.status?{status:!0,value:t.value}:{status:!1,index:x(e,t.furthest),expected:t.expected}},i.tryParse=function(e){var t=this.parse(e);if(t.status)return t.value;var r=B(e,t),n=new Error(r);throw n.type="ParsimmonError",n.result=t,n},i.assert=function(e,t){return this.chain(function(r){return e(r)?Q(r):G(t)})},i.or=function(e){return V(this,e)},i.trim=function(e){return this.wrap(e,e)},i.wrap=function(e,t){return W(e,this,t,function(e,t){return t})},i.thru=function(e){return e(this)},i.then=function(e){return j(e),Y(this,e).map(function(e){return e[1]})},i.many=function(){var e=this;return o(function(t,r){for(var n=[],o=void 0;;){if(!(o=P(e._(t,r),o)).status)return P(O(r,n),o);if(r===o.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");r=o.index,n.push(o.value)}})},i.tieWith=function(e){return $(e),this.map(function(t){if(function(e){if(!b(e))throw new Error("not an array: "+e)}(t),t.length){$(t[0]);for(var r=t[0],n=1;n<t.length;n++)$(t[n]),r+=e+t[n];return r}return""})},i.tie=function(){return this.tieWith("")},i.times=function(e,t){var r=this;return arguments.length<2&&(t=e),S(e),S(t),o(function(n,o){for(var i=[],s=void 0,a=void 0,l=0;l<e;l+=1){if(a=P(s=r._(n,o),a),!s.status)return a;o=s.index,i.push(s.value)}for(;l<t&&(a=P(s=r._(n,o),a),s.status);l+=1)o=s.index,i.push(s.value);return P(O(o,i),a)})},i.result=function(e){return this.map(function(){return e})},i.atMost=function(e){return this.times(0,e)},i.atLeast=function(e){return W(this.times(e),this.many(),function(e,t){return e.concat(t)})},i.map=function(e){C(e);var t=this;return o(function(r,n){var o=t._(r,n);return o.status?P(O(o.index,e(o.value)),o):o})},i.contramap=function(e){C(e);var t=this;return o(function(r,n){var o=t.parse(e(r.slice(n)));return o.status?O(n+r.length,o.value):o})},i.promap=function(e,t){return C(e),C(t),this.contramap(e).map(t)},i.skip=function(e){return Y(this,e).map(function(e){return e[0]})},i.mark=function(){return W(ne,this,ne,function(e,t,r){return{start:e,value:t,end:r}})},i.node=function(e){return W(ne,this,ne,function(t,r,n){return{name:e,value:r,start:t,end:n}})},i.sepBy=function(e){return q(this,e)},i.sepBy1=function(e){return J(this,e)},i.lookahead=function(e){return this.skip(Z(e))},i.notFollowedBy=function(e){return this.skip(X(e))},i.desc=function(e){b(e)||(e=[e]);var t=this;return o(function(r,n){var o=t._(r,n);return o.status||(o.expected=e),o})},i.fallback=function(e){return this.or(Q(e))},i.ap=function(e){return W(e,this,function(e,t){return e(t)})},i.chain=function(e){var t=this;return o(function(r,n){var o=t._(r,n);return o.status?P(e(o.value)._(r,o.index),o):o})},i.concat=i.or,i.empty=re,i.of=Q,i["fantasy-land/ap"]=i.ap,i["fantasy-land/chain"]=i.chain,i["fantasy-land/concat"]=i.concat,i["fantasy-land/empty"]=i.empty,i["fantasy-land/of"]=i.of,i["fantasy-land/map"]=i.map;var ne=o(function(e,t){return O(t,x(e,t))}),oe=o(function(e,t){return t>=e.length?E(t,"any character/byte"):O(t+1,k(e,t))}),ie=o(function(e,t){return O(e.length,e.slice(t))}),se=o(function(e,t){return t<e.length?E(t,"EOF"):O(t,null)}),ae=K(/[0-9]/).desc("a digit"),le=K(/[0-9]*/).desc("optional digits"),ce=K(/[a-z]/i).desc("a letter"),ue=K(/[a-z]*/i).desc("optional letters"),fe=K(/\s*/).desc("optional whitespace"),de=K(/\s+/).desc("whitespace"),he=H("\r"),pe=H("\n"),me=H("\r\n"),ge=V(me,pe,he).desc("newline"),ve=V(ge,se);o.all=ie,o.alt=V,o.any=oe,o.cr=he,o.createLanguage=function(e){var t={};for(var r in e)({}).hasOwnProperty.call(e,r)&&function(r){t[r]=te(function(){return e[r](t)})}(r);return t},o.crlf=me,o.custom=function(e){return o(e(O,E))},o.digit=ae,o.digits=le,o.empty=re,o.end=ve,o.eof=se,o.fail=G,o.formatError=B,o.index=ne,o.isParser=y,o.lazy=te,o.letter=ce,o.letters=ue,o.lf=pe,o.lookahead=Z,o.makeFailure=E,o.makeSuccess=O,o.newline=ge,o.noneOf=function(e){return ee(function(t){return e.indexOf(t)<0}).desc("none of '"+e+"'")},o.notFollowedBy=X,o.of=Q,o.oneOf=function(e){for(var t=e.split(""),r=0;r<t.length;r++)t[r]="'"+t[r]+"'";return ee(function(t){return e.indexOf(t)>=0}).desc(t)},o.optWhitespace=fe,o.Parser=o,o.range=function(e,t){return ee(function(r){return e<=r&&r<=t}).desc(e+"-"+t)},o.regex=K,o.regexp=K,o.sepBy=q,o.sepBy1=J,o.seq=Y,o.seqMap=W,o.seqObj=function(){for(var e,t={},r=0,n=(e=arguments,Array.prototype.slice.call(e)),i=n.length,s=0;s<i;s+=1){var a=n[s];if(!y(a)){if(b(a)&&2===a.length&&"string"==typeof a[0]&&y(a[1])){var l=a[0];if(Object.prototype.hasOwnProperty.call(t,l))throw new Error("seqObj: duplicate key "+l);t[l]=!0,r++;continue}throw new Error("seqObj arguments must be parsers or [string, parser] array pairs.")}}if(0===r)throw new Error("seqObj expects at least one named parser, found zero");return o(function(e,t){for(var r,o={},s=0;s<i;s+=1){var a,l;if(b(n[s])?(a=n[s][0],l=n[s][1]):(a=null,l=n[s]),!(r=P(l._(e,t),r)).status)return r;a&&(o[a]=r.value),t=r.index}return P(O(t,o),r)})},o.string=H,o.succeed=Q,o.takeWhile=function(e){return C(e),o(function(t,r){for(var n=r;n<t.length&&e(k(t,n));)n++;return O(n,t.slice(r,n))})},o.test=ee,o.whitespace=de,o["fantasy-land/empty"]=re,o["fantasy-land/of"]=Q,o.Binary={bitSeq:d,bitSeqObj:function(e){f();var t={},r=0,n=l(function(e){if(b(e)){var n=e;if(2!==n.length)throw new Error("["+n.join(", ")+"] should be length 2, got length "+n.length);if($(n[0]),S(n[1]),Object.prototype.hasOwnProperty.call(t,n[0]))throw new Error("duplicate key in bitSeqObj: "+n[0]);return t[n[0]]=!0,r++,n}return S(e),[null,e]},e);if(r<1)throw new Error("bitSeqObj expects at least one named pair, got ["+e.join(", ")+"]");var o=l(function(e){return e[0]},n);return d(l(function(e){return e[1]},n)).map(function(e){return a(function(e,t){return null!==t[0]&&(e[t[0]]=t[1]),e},{},l(function(t,r){return[t,e[r]]},o))})},byte:function(e){if(f(),S(e),e>255)throw new Error("Value specified to byte constructor ("+e+"=0x"+e.toString(16)+") is larger in value than a single byte.");var t=(e>15?"0x":"0x0")+e.toString(16);return o(function(r,n){var o=k(r,n);return o===e?O(n+1,o):E(n,t)})},buffer:function(e){return h("buffer",e).map(function(e){return t.from(e)})},encodedString:function(e,t){return h("string",t).map(function(t){return t.toString(e)})},uintBE:m,uint8BE:m(1),uint16BE:m(2),uint32BE:m(4),uintLE:g,uint8LE:g(1),uint16LE:g(2),uint32LE:g(4),intBE:v,int8BE:v(1),int16BE:v(2),int32BE:v(4),intLE:w,int8LE:w(1),int16LE:w(2),int32LE:w(4),floatBE:h("floatBE",4).map(function(e){return e.readFloatBE(0)}),floatLE:h("floatLE",4).map(function(e){return e.readFloatLE(0)}),doubleBE:h("doubleBE",8).map(function(e){return e.readDoubleBE(0)}),doubleLE:h("doubleLE",8).map(function(e){return e.readDoubleLE(0)})},e.exports=o}])}).call(this,r(16).Buffer)},function(e,t,r){"use strict";function n(e,t,r,n,o,i){return{tag:e,key:t,attrs:r,children:n,text:o,dom:i,domSize:void 0,state:void 0,events:void 0,instance:void 0}}n.normalize=function(e){return Array.isArray(e)?n("[",void 0,void 0,n.normalizeChildren(e),void 0,void 0):null==e||"boolean"==typeof e?null:"object"==typeof e?e:n("#",void 0,void 0,String(e),void 0,void 0)},n.normalizeChildren=function(e){var t=[];if(e.length){for(var r=null!=e[0]&&null!=e[0].key,o=1;o<e.length;o++)if((null!=e[o]&&null!=e[o].key)!==r)throw new TypeError("Vnodes must either always have keys or never have keys!");for(o=0;o<e.length;o++)t[o]=n.normalize(e[o])}return t},e.exports=n},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";var n=r(12);e.exports=r(25)(n,requestAnimationFrame,console)},function(e,t,r){"use strict";var n=r(13),o=r(14);e.exports=function(e,t){if(/:([^\/\.-]+)(\.{3})?:/.test(e))throw new SyntaxError("Template parameter names *must* be separated");if(null==t)return e;var r=e.indexOf("?"),i=e.indexOf("#"),s=i<0?e.length:i,a=r<0?s:r,l=e.slice(0,a),c={};o(c,t);var u=l.replace(/:([^\/\.-]+)(\.{3})?/g,function(e,r,n){return delete c[r],null==t[r]?e:n?t[r]:encodeURIComponent(String(t[r]))}),f=u.indexOf("?"),d=u.indexOf("#"),h=d<0?u.length:d,p=f<0?h:f,m=u.slice(0,p);r>=0&&(m+=e.slice(r,s)),f>=0&&(m+=(r<0?"?":"&")+u.slice(f,h));var g=n(c);return g&&(m+=(r<0&&f<0?"?":"&")+g),i>=0&&(m+=e.slice(i)),d>=0&&(m+=(i<0?"":"&")+u.slice(d)),m}},function(e,t,r){"use strict";var n=r(15);e.exports=function(e){var t=e.indexOf("?"),r=e.indexOf("#"),o=r<0?e.length:r,i=t<0?o:t,s=e.slice(0,i).replace(/\/{2,}/g,"/");return s?("/"!==s[0]&&(s="/"+s),s.length>1&&"/"===s[s.length-1]&&(s=s.slice(0,-1))):s="/",{path:s,params:t<0?{}:n(e.slice(t+1,o))}}},function(e,t,r){"use strict";var n=r(2),o=r(8),i=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,s={},a={}.hasOwnProperty;function l(e){for(var t in e)if(a.call(e,t))return!1;return!0}e.exports=function(e){if(null==e||"string"!=typeof e&&"function"!=typeof e&&"function"!=typeof e.view)throw Error("The selector must be either a string or a component.");var t=o.apply(1,arguments);return"string"==typeof e&&(t.children=n.normalizeChildren(t.children),"["!==e)?function(e,t){var r=t.attrs,o=n.normalizeChildren(t.children),i=a.call(r,"class"),s=i?r.class:r.className;if(t.tag=e.tag,t.attrs=null,t.children=void 0,!l(e.attrs)&&!l(r)){var c={};for(var u in r)a.call(r,u)&&(c[u]=r[u]);r=c}for(var u in e.attrs)a.call(e.attrs,u)&&"className"!==u&&!a.call(r,u)&&(r[u]=e.attrs[u]);for(var u in null==s&&null==e.attrs.className||(r.className=null!=s?null!=e.attrs.className?String(e.attrs.className)+" "+String(s):s:null!=e.attrs.className?e.attrs.className:null),i&&(r.class=null),r)if(a.call(r,u)&&"key"!==u){t.attrs=r;break}return Array.isArray(o)&&1===o.length&&null!=o[0]&&"#"===o[0].tag?t.text=o[0].children:t.children=o,t}(s[e]||function(e){for(var t,r="div",n=[],o={};t=i.exec(e);){var a=t[1],l=t[2];if(""===a&&""!==l)r=l;else if("#"===a)o.id=l;else if("."===a)n.push(l);else if("["===t[3][0]){var c=t[6];c&&(c=c.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),"class"===t[4]?n.push(c):o[t[4]]=""===c?c:c||!0}}return n.length>0&&(o.className=n.join(" ")),s[e]={tag:r,attrs:o}}(e),t):(t.tag=e,t)}},function(e,t,r){"use strict";var n=r(2);e.exports=function(){var e,t=arguments[this],r=this+1;if(null==t?t={}:("object"!=typeof t||null!=t.tag||Array.isArray(t))&&(t={},r=this),arguments.length===r+1)e=arguments[r],Array.isArray(e)||(e=[e]);else for(e=[];r<arguments.length;)e.push(arguments[r++]);return n("",t.key,t,e)}},function(e,t,r){"use strict";(function(t){var n=r(10);"undefined"!=typeof window?(void 0===window.Promise?window.Promise=n:window.Promise.prototype.finally||(window.Promise.prototype.finally=n.prototype.finally),e.exports=window.Promise):void 0!==t?(void 0===t.Promise?t.Promise=n:t.Promise.prototype.finally||(t.Promise.prototype.finally=n.prototype.finally),e.exports=t.Promise):e.exports=n}).call(this,r(3))},function(e,t,r){"use strict";(function(t){var r=function(e){if(!(this instanceof r))throw new Error("Promise must be called with `new`");if("function"!=typeof e)throw new TypeError("executor must be a function");var n=this,o=[],i=[],s=u(o,!0),a=u(i,!1),l=n._instance={resolvers:o,rejectors:i},c="function"==typeof t?t:setTimeout;function u(e,t){return function r(s){var u;try{if(!t||null==s||"object"!=typeof s&&"function"!=typeof s||"function"!=typeof(u=s.then))c(function(){t||0!==e.length||console.error("Possible unhandled promise rejection:",s);for(var n=0;n<e.length;n++)e[n](s);o.length=0,i.length=0,l.state=t,l.retry=function(){r(s)}});else{if(s===n)throw new TypeError("Promise can't be resolved w/ itself");f(u.bind(s))}}catch(e){a(e)}}}function f(e){var t=0;function r(e){return function(r){t++>0||e(r)}}var n=r(a);try{e(r(s),n)}catch(e){n(e)}}f(e)};r.prototype.then=function(e,t){var n,o,i=this._instance;function s(e,t,r,s){t.push(function(t){if("function"!=typeof e)r(t);else try{n(e(t))}catch(e){o&&o(e)}}),"function"==typeof i.retry&&s===i.state&&i.retry()}var a=new r(function(e,t){n=e,o=t});return s(e,i.resolvers,n,!0),s(t,i.rejectors,o,!1),a},r.prototype.catch=function(e){return this.then(null,e)},r.prototype.finally=function(e){return this.then(function(t){return r.resolve(e()).then(function(){return t})},function(t){return r.resolve(e()).then(function(){return r.reject(t)})})},r.resolve=function(e){return e instanceof r?e:new r(function(t){t(e)})},r.reject=function(e){return new r(function(t,r){r(e)})},r.all=function(e){return new r(function(t,r){var n=e.length,o=0,i=[];if(0===e.length)t([]);else for(var s=0;s<e.length;s++)!function(s){function a(e){o++,i[s]=e,o===n&&t(i)}null==e[s]||"object"!=typeof e[s]&&"function"!=typeof e[s]||"function"!=typeof e[s].then?a(e[s]):e[s].then(a,r)}(s)})},r.race=function(e){return new r(function(t,r){for(var n=0;n<e.length;n++)e[n].then(t,r)})},e.exports=r}).call(this,r(11).setImmediate)},function(e,t,r){(function(e){var n=void 0!==e&&e||"undefined"!=typeof self&&self||window,o=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(o.call(setTimeout,n,arguments),clearTimeout)},t.setInterval=function(){return new i(o.call(setInterval,n,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(n,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},r(22),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,r(3))},function(e,t,r){"use strict";e.exports=r(24)(window)},function(e,t,r){"use strict";e.exports=function(e){if("[object Object]"!==Object.prototype.toString.call(e))return"";var t=[];for(var r in e)n(r,e[r]);return t.join("&");function n(e,r){if(Array.isArray(r))for(var o=0;o<r.length;o++)n(e+"["+o+"]",r[o]);else if("[object Object]"===Object.prototype.toString.call(r))for(var o in r)n(e+"["+o+"]",r[o]);else t.push(encodeURIComponent(e)+(null!=r&&""!==r?"="+encodeURIComponent(r):""))}}},function(e,t,r){"use strict";e.exports=Object.assign||function(e,t){t&&Object.keys(t).forEach(function(r){e[r]=t[r]})}},function(e,t,r){"use strict";e.exports=function(e){if(""===e||null==e)return{};"?"===e.charAt(0)&&(e=e.slice(1));for(var t=e.split("&"),r={},n={},o=0;o<t.length;o++){var i=t[o].split("="),s=decodeURIComponent(i[0]),a=2===i.length?decodeURIComponent(i[1]):"";"true"===a?a=!0:"false"===a&&(a=!1);var l=s.split(/\]\[?|\[/),c=n;s.indexOf("[")>-1&&l.pop();for(var u=0;u<l.length;u++){var f=l[u],d=l[u+1],h=""==d||!isNaN(parseInt(d,10));if(""===f)null==r[s=l.slice(0,u).join()]&&(r[s]=Array.isArray(c)?c.length:0),f=r[s]++;else if("__proto__"===f)break;if(u===l.length-1)c[f]=a;else{var p=Object.getOwnPropertyDescriptor(c,f);null!=p&&(p=p.value),null==p&&(c[f]=p=h?[]:{}),c=p}}}return n}},function(e,t,r){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var n=r(30),o=r(31),i=r(32);function s(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,r){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return f(this,e)}return c(this,e,t,r)}function c(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=d(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!l.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(t,r),o=(e=a(e,n)).write(t,r);o!==n&&(e=e.slice(0,o));return e}(e,t,r):function(e,t){if(l.isBuffer(t)){var r=0|h(t.length);return 0===(e=a(e,r)).length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?a(e,0):d(e,t);if("Buffer"===t.type&&i(t.data))return d(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function f(e,t){if(u(t),e=a(e,t<0?0:0|h(t)),!l.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function d(e,t){var r=t.length<0?0:0|h(t.length);e=a(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function h(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return F(e).length;default:if(n)return B(e).length;t=(""+t).toLowerCase(),n=!0}}function m(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return $(this,t,r);case"utf8":case"utf-8":return j(this,t,r);case"ascii":return S(this,t,r);case"latin1":case"binary":return C(this,t,r);case"base64":return x(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function v(e,t,r,n,o){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=o?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(o)return-1;r=e.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:w(e,t,r,n,o);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):w(e,[t],r,n,o);throw new TypeError("val must be string, number or Buffer")}function w(e,t,r,n,o){var i,s=1,a=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,r/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(o){var u=-1;for(i=r;i<a;i++)if(c(e,i)===c(t,-1===u?0:i-u)){if(-1===u&&(u=i),i-u+1===l)return u*s}else-1!==u&&(i-=i-u),u=-1}else for(r+l>a&&(r=a-l),i=r;i>=0;i--){for(var f=!0,d=0;d<l;d++)if(c(e,i+d)!==c(t,d)){f=!1;break}if(f)return i}return-1}function y(e,t,r,n){r=Number(r)||0;var o=e.length-r;n?(n=Number(n))>o&&(n=o):n=o;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");n>i/2&&(n=i/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[r+s]=a}return s}function b(e,t,r,n){return Y(B(t,e.length-r),e,r,n)}function A(e,t,r,n){return Y(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function O(e,t,r,n){return A(e,t,r,n)}function E(e,t,r,n){return Y(F(t),e,r,n)}function P(e,t,r,n){return Y(function(e,t){for(var r,n,o,i=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,o=r%256,i.push(o),i.push(n);return i}(t,e.length-r),e,r,n)}function x(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function j(e,t,r){r=Math.min(e.length,r);for(var n=[],o=t;o<r;){var i,s,a,l,c=e[o],u=null,f=c>239?4:c>223?3:c>191?2:1;if(o+f<=r)switch(f){case 1:c<128&&(u=c);break;case 2:128==(192&(i=e[o+1]))&&(l=(31&c)<<6|63&i)>127&&(u=l);break;case 3:i=e[o+1],s=e[o+2],128==(192&i)&&128==(192&s)&&(l=(15&c)<<12|(63&i)<<6|63&s)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:i=e[o+1],s=e[o+2],a=e[o+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&(l=(15&c)<<18|(63&i)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(u=l)}null===u?(u=65533,f=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),o+=f}return function(e){var t=e.length;if(t<=k)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=k));return r}(n)}t.Buffer=l,t.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,r){return c(null,e,t,r)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,r){return function(e,t,r,n){return u(t),t<=0?a(e,t):void 0!==r?"string"==typeof n?a(e,t).fill(r,n):a(e,t).fill(r):a(e,t)}(null,e,t,r)},l.allocUnsafe=function(e){return f(null,e)},l.allocUnsafeSlow=function(e){return f(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,o=0,i=Math.min(r,n);o<i;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!i(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=l.allocUnsafe(t),o=0;for(r=0;r<e.length;++r){var s=e[r];if(!l.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,o),o+=s.length}return n},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?j(this,0,e):m.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,r,n,o){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),t<0||r>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&t>=r)return 0;if(n>=o)return-1;if(t>=r)return 1;if(this===e)return 0;for(var i=(o>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),a=Math.min(i,s),c=this.slice(n,o),u=e.slice(t,r),f=0;f<a;++f)if(c[f]!==u[f]){i=c[f],s=u[f];break}return i<s?-1:s<i?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return v(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return v(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var o=this.length-t;if((void 0===r||r>o)&&(r=o),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return y(this,e,t,r);case"utf8":case"utf-8":return b(this,e,t,r);case"ascii":return A(this,e,t,r);case"latin1":case"binary":return O(this,e,t,r);case"base64":return E(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function S(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(127&e[o]);return n}function C(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(e[o]);return n}function $(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var o="",i=t;i<r;++i)o+=z(e[i]);return o}function D(e,t,r){for(var n=e.slice(t,r),o="",i=0;i<n.length;i+=2)o+=String.fromCharCode(n[i]+256*n[i+1]);return o}function T(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function I(e,t,r,n,o,i){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function R(e,t,r,n){t<0&&(t=65535+t+1);for(var o=0,i=Math.min(e.length-r,2);o<i;++o)e[r+o]=(t&255<<8*(n?o:1-o))>>>8*(n?o:1-o)}function N(e,t,r,n){t<0&&(t=4294967295+t+1);for(var o=0,i=Math.min(e.length-r,4);o<i;++o)e[r+o]=t>>>8*(n?o:3-o)&255}function _(e,t,r,n,o,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function L(e,t,r,n,i){return i||_(e,0,r,4),o.write(e,t,r,n,23,4),r+4}function M(e,t,r,n,i){return i||_(e,0,r,8),o.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=l.prototype;else{var o=t-e;r=new l(o,void 0);for(var i=0;i<o;++i)r[i]=this[i+e]}return r},l.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||T(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n},l.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||T(e,t,this.length);for(var n=this[e+--t],o=1;t>0&&(o*=256);)n+=this[e+--t]*o;return n},l.prototype.readUInt8=function(e,t){return t||T(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||T(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||T(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||T(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||T(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||T(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n>=(o*=128)&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||T(e,t,this.length);for(var n=t,o=1,i=this[e+--n];n>0&&(o*=256);)i+=this[e+--n]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*t)),i},l.prototype.readInt8=function(e,t){return t||T(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||T(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){t||T(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return t||T(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||T(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||T(e,4,this.length),o.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||T(e,4,this.length),o.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||T(e,8,this.length),o.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||T(e,8,this.length),o.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||I(this,e,t,r,Math.pow(2,8*r)-1,0);var o=1,i=0;for(this[t]=255&e;++i<r&&(o*=256);)this[t+i]=e/o&255;return t+r},l.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||I(this,e,t,r,Math.pow(2,8*r)-1,0);var o=r-1,i=1;for(this[t+o]=255&e;--o>=0&&(i*=256);)this[t+o]=e/i&255;return t+r},l.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):R(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):R(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):N(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var o=Math.pow(2,8*r-1);I(this,e,t,r,o-1,-o)}var i=0,s=1,a=0;for(this[t]=255&e;++i<r&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var o=Math.pow(2,8*r-1);I(this,e,t,r,o-1,-o)}var i=r-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):R(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):R(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):N(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||I(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,r){return L(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return L(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return M(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return M(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var o,i=n-r;if(this===e&&r<t&&t<n)for(o=i-1;o>=0;--o)e[o+t]=this[o+r];else if(i<1e3||!l.TYPED_ARRAY_SUPPORT)for(o=0;o<i;++o)e[o+t]=this[o+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+i),t);return i},l.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var s=l.isBuffer(e)?e:B(new l(e,n).toString()),a=s.length;for(i=0;i<r-t;++i)this[i+t]=s[i%a]}return this};var U=/[^+\/0-9A-Za-z-_]/g;function z(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var r;t=t||1/0;for(var n=e.length,o=null,i=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!o){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&i.push(239,191,189);continue}o=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function F(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(U,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Y(e,t,r,n){for(var o=0;o<n&&!(o+r>=t.length||o>=e.length);++o)t[o+r]=e[o];return o}}).call(this,r(3))},function(e,t,r){"use strict";r.r(t);var n=r(0),o=r.n(n),i=r(1);const s=()=>({view:e=>{const t={[e.attrs.page]:"active"},r=[];window.authorizer.hasAccess("devices",1)&&r.push(o()("li",{class:t.overview},o()("a",{href:"#!/overview"},"Overview"))),window.authorizer.hasAccess("devices",2)&&r.push(o()("li",{class:t.devices},o()("a",{href:"#!/devices"},"Devices"))),window.authorizer.hasAccess("faults",2)&&r.push(o()("li",{class:t.faults},o()("a",{href:"#!/faults"},"Faults")));const n=["presets","provisions","virtualParameters","files"];for(const e of n)if(window.authorizer.hasAccess(e,2)){r.push(o()("li",{class:t.admin},o()("a",{href:"#!/admin"},"Admin")));break}return o()("nav",o()("ul",r))}});function a(e){const t={b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};return e.replace(/\\(u[0-9a-fA-F]{4}|[^u])/,(e,r)=>{const n=r.charAt(0),o=r.slice(1);return"u"===n?String.fromCharCode(parseInt(o,16)):t.hasOwnProperty(n)?t[n]:n})}function l(e,t){if(!Array.isArray(e))return t(e);let r;for(let n=1;n<e.length;++n){const o=l(e[n],t);o!==e[n]&&((r=r||e.slice())[n]=o)}return t(r||e)}function c(e,t){return Object(i.seqMap)(t,Object(i.seq)(e,t).many(),(e,t)=>t.reduce((e,t)=>{const[r,n]=t;return Array.isArray(e)&&r===e[0]?e.concat([n]):Array.isArray(n)&&r===n[0]?[r,e].concat(n.slice(1)):[r,e,n]},e))}const u=Object(i.createLanguage)({ComparisonOperator:function(){return Object(i.alt)(Object(i.string)(">="),Object(i.string)("<>"),Object(i.string)("<="),Object(i.string)("="),Object(i.string)(">"),Object(i.string)("<")).skip(i.optWhitespace)},LikeOperator:function(){return Object(i.alt)(Object(i.regexp)(/like/i).result("LIKE").desc("LIKE"),Object(i.regexp)(/not\s+like/i).result("NOT LIKE").desc("NOT LIKE")).notFollowedBy(Object(i.regexp)(/[a-zA-Z0-9_]/)).skip(i.optWhitespace)},IsNullOperator:function(){return Object(i.alt)(Object(i.regexp)(/is\s+null/i).result("IS NULL").desc("IS NULL"),Object(i.regexp)(/is\s+not\s+null/i).result("IS NOT NULL").desc("IS NOT NULL")).notFollowedBy(Object(i.regexp)(/[a-zA-Z0-9_]/)).skip(i.optWhitespace)},NotOperator:function(){return Object(i.regexp)(/not/i).result("NOT").notFollowedBy(Object(i.regexp)(/[a-zA-Z0-9_]/)).skip(i.optWhitespace).desc("NOT")},AndOperator:function(){return Object(i.regexp)(/and/i).result("AND").notFollowedBy(Object(i.regexp)(/[a-zA-Z0-9_]/)).skip(i.optWhitespace).desc("AND")},OrOperator:function(){return Object(i.regexp)(/or/i).result("OR").notFollowedBy(Object(i.regexp)(/[a-zA-Z0-9_]/)).skip(i.optWhitespace).desc("OR")},Parameter:function(e){return Object(i.alt)(Object(i.regexp)(/[a-zA-Z0-9_.*-]+/),e.Expression.wrap(Object(i.string)("{").skip(i.optWhitespace),Object(i.string)("}"))).atLeast(1).map(e=>["PARAM",e.length>1?["||"].concat(e):e[0]]).skip(i.optWhitespace).desc("parameter")},StringValueSql:function(){return Object(i.regexp)(/'([^']*)'/,1).atLeast(1).skip(i.optWhitespace).map(e=>e.join("'")).desc("string")},StringValueJs:function(){return Object(i.regexp)(/"((?:\\.|.)*?)"/,1).skip(i.optWhitespace).map(a).desc("string")},NumberValue:function(){return Object(i.regexp)(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).skip(i.optWhitespace).map(Number).desc("number")},BooleanValue:function(){return Object(i.alt)(Object(i.regexp)(/true/i).result(!0).desc("TRUE"),Object(i.regexp)(/false/i).result(!1).desc("FALSE")).notFollowedBy(Object(i.regexp)(/[a-zA-Z0-9_]/)).skip(i.optWhitespace)},NullValue:function(){return Object(i.regexp)(/null/i).notFollowedBy(Object(i.regexp)(/[a-zA-Z0-9_]/)).skip(i.optWhitespace).result(null).desc("NULL")},FuncValue:function(e){return Object(i.seqMap)(Object(i.regexp)(/([a-zA-Z0-9_]+)/,1).skip(i.optWhitespace).desc("function"),e.ValueExpression.sepBy(Object(i.string)(",").skip(i.optWhitespace)).wrap(Object(i.string)("(").skip(i.optWhitespace),Object(i.string)(")").skip(i.optWhitespace)),(e,t)=>["FUNC",e.toUpperCase()].concat(t))},Value:function(e){return Object(i.alt)(e.NullValue,e.BooleanValue,e.NumberValue,e.StringValueSql,e.StringValueJs,e.FuncValue)},ValueExpression:function(e){return c(Object(i.string)("||").skip(i.optWhitespace),c(Object(i.alt)(Object(i.string)("+"),Object(i.string)("-")).skip(i.optWhitespace),c(Object(i.alt)(Object(i.string)("*"),Object(i.string)("/")).skip(i.optWhitespace),Object(i.alt)(e.Value,e.Parameter,e.Expression.wrap(Object(i.string)("(").skip(i.optWhitespace),Object(i.string)(")").skip(i.optWhitespace))))))},Comparison:function(e){return Object(i.alt)(Object(i.seqMap)(e.ValueExpression,e.IsNullOperator,(e,t)=>[t,e]),Object(i.seqMap)(e.ValueExpression,e.ComparisonOperator,e.ValueExpression,(e,t,r)=>[t,e,r]),Object(i.seqMap)(e.ValueExpression,e.LikeOperator,e.ValueExpression.skip(Object(i.regexp)(/escape/i).result("ESCAPE").skip(i.whitespace).desc("ESCAPE")),e.ValueExpression,(e,t,r,n)=>[t,e,r,n]),Object(i.seqMap)(e.ValueExpression,e.LikeOperator,e.ValueExpression,(e,t,r)=>[t,e,r]))},Expression:function(e){return c(e.OrOperator,c(e.AndOperator,(t=e.NotOperator,r=e.Comparison.or(e.ValueExpression),Object(i.seq)(t,r).or(r)))).trim(i.optWhitespace);var t,r}});function f(e){return e?u.Expression.tryParse(e):null}function d(e,t=0){if(!Array.isArray(e))return JSON.stringify(e);const r={OR:10,AND:11,NOT:12,"=":20,"<>":20,">":20,">=":20,"<":20,"<=":20,LIKE:20,"NOT LIKE":20,"IS NULL":20,"IS NOT NULL":20,"||":30,"+":31,"-":31,"*":32,"/":32},n=e[0].toUpperCase();function o(e){return r[n]<=t?`(${e})`:e}if("FUNC"===n)return o(`${e[1]}(${e.slice(2).map(e=>d(e)).join(", ")})`);if("PARAM"===n)return"string"==typeof e[1]?o(e[1]):Array.isArray(e[1])&&"||"===e[1][0]?o(e[1].slice(1).map(e=>"string"==typeof e?e:`{${d(e)}}`).join("")):o(`{${d(e[1])}}`);if("IS NULL"===n||"IS NOT NULL"===n)return o(`${d(e[1],r[n])} ${n}`);if("LIKE"===n||"NOT LIKE"===n)return e[3]?o(`${d(e[1],r[n])} ${n} ${d(e[2],r[n])} ESCAPE ${d(e[3],r[n])}`):o(`${d(e[1],r[n])} ${n} ${d(e[2],r[n])}`);if(n in r){const t=e.slice(1).map((t,n)=>d(t,r[e[0]]+Math.min(n-1,0)));return o("NOT"===n?`${n} ${t[0]}`:t.join(` ${n} `))}throw new Error(`Unrecognized operator ${e[0]}`)}function h(e,t){const r=e.split("");for(let e=0;e<r.length;++e){const n=r[e];if(n===t)r[e]=r[e+1]||"",r[e+1]="";else if("_"===n)r[e]="\\_";else if("%"===n)for(r[e]="\\%";"%"===r[e+1];)r[++e]=""}return r.filter(e=>e)}function p(e,t){if(0===e.length)return t;if(0===t.length)return e;if(e.length>t.length){const r=e;e=t,t=r}const r=[];for(let n=0;n<e.length;++n)for(let o=n;o<t.length;++o)r.push(e[n].concat(t[o]));return r}function m(e,t,r=0,n=0){for(;r<e.length&&n<t.length;){if("\\%"===e[r]){for(let o=n;o<=t.length;++o)if(m(e,t,r+1,o))return!0;return!1}if("\\%"===t[n]){if("\\%"!==e[r])return!1}else if("\\_"===e[r]);else{if("\\_"===t[n])return!1;if(t[n]!==e[r])return!1}++r,++n}return r===e.length&&n===t.length}function g(e){const t=new Map,r=new Map;l(e,e=>{if(!Array.isArray(e))return e;if("LIKE"===e[0]||"NOT LIKE"===e[0]){if("string"==typeof e[2]&&(e.length>=4||null!=e[3]&&!Array.isArray(e[3]))){const t=JSON.stringify(e[1]);let n=r.get(t);n||r.set(t,n=new Map),n.set(`${e[3]||""}:${e[2]}`,h(e[2],e[3]))}}else if([">",">=","<","<=","=","<>"].includes(e[0]))if(Array.isArray(e[2])){if(!Array.isArray(e[1])){const r=`${JSON.stringify(e[2])}:${typeof e[1]}`;let n=t.get(r);n||t.set(r,n=new Set),n.add(e[2])}}else{const r=`${JSON.stringify(e[1])}:${typeof e[2]}`;let n=t.get(r);n||t.set(r,n=new Set),n.add(e[2])}return e});for(const[e,r]of t)e.endsWith(":number")?t.set(e,Array.from(r).sort((e,t)=>e-t)):t.set(e,Array.from(r).sort());const n=new Map,o=new Map;function i(e,t,r=""){const s=`${e}:${t}:${r}`;let a=n.get(s);if(!a){n.set(s,a=n.size+1);let l=o.get(e);l||o.set(e,l=new Set),l.add(a),(r||"null"!==t)&&l.add(i(e,"null"))}return a}function s(e,r,i,s,a){const l=null!=r?typeof r:typeof s,c=t.get(`${e}:${l}`),u=[];null==r&&u.push(`${e}:--${c[0]}`);for(let t=0;t<c.length;++t)t>0&&(null==r||c[t]>r)&&(null==s||c[t]<=s)&&u.push(`${e}:${c[t-1]}--${c[t]}`),(c[t]>r&&c[t]<s||c[t]===r&&i||c[t]===s&&a)&&u.push(`${e}:${c[t]}`);return null==s&&u.push(`${e}:${c[c.length-1]}--`),u.map(t=>{let r=n.get(t);if(!r){n.set(t,r=n.size+1);let i=o.get(e);i||o.set(e,i=new Set),i.add(r)}return r})}const a={"=":e=>[e,!0,e,!0],">":e=>[e,!1,null,null],">=":e=>[e,!0,null,null],"<":e=>[null,null,e,!1],"<=":e=>[null,null,e,!0]};const c=function e(t,o){let l=t[0];if("AND"===l&&!o||"OR"===l&&o){let r=[];for(let n=1;n<t.length;++n)r=r.concat(e(t[n],o));return r}if("OR"===l&&!o||"AND"===l&&o){let r=[];for(let n=1;n<t.length;++n)r=p(r,e(t[n],o));return r}if("NOT"===l)return e(t[1],!o);if("<>"===l){const e=s(JSON.stringify(t[1]),...a["="](t[2]));return o?[e]:e.map(e=>[0-e])}if("IS NULL"===l){const e=i(JSON.stringify(t[1]),"null");return o?[[0-e]]:[[e]]}if("IS NOT NULL"===l){const e=i(JSON.stringify(t[1]),"null");return o?[[e]]:[[0-e]]}if(l in a){if(Array.isArray(t[2])){if(Array.isArray(t[1])){let e=JSON.stringify(t[1]),r=JSON.stringify(t[2]);if(r>e){const t=r;r=e,e=t,l={">":"<",">=":"<=","<":">","<=":">="}[l]||l}const n=i(e,l,r);return o?[[0-n]]:[[n]]}{l={">":"<",">=":"<=","<":">","<=":">="}[l]||l;const e=s(JSON.stringify(t[2]),...a[l](t[1]));return o?e.map(e=>[0-e]):[e]}}{const e=s(JSON.stringify(t[1]),...a[l](t[2]));return o?e.map(e=>[0-e]):[e]}}if("LIKE"!==l&&"NOT LIKE"!==l||Array.isArray(t[2])||null==t[2]||!(t.length>=4||null!=t[3])){const e=i(JSON.stringify(t),"");return o?[[0-e]]:[[e]]}{"NOT LIKE"===l&&(o=!o);const e=function(e,t,o){const i=[],s=r.get(e);t=s.get(`${o||""}:${t}`);for(const r of s.values())(t===r||m(t,r))&&i.push(`${e}:like:${JSON.stringify(r)}`);return i.map(e=>{let t=n.get(e);return t||n.set(e,t=n.size+1),t})}(JSON.stringify(t[1]),t[2],t[3]);return o?e.map(e=>[0-e]):[e]}}(e,!1);for(const e of o.values()){const t=Array.from(e);for(let e=0;e<t.length;++e)for(let r=e+1;r<t.length;++r)c.push([0-t[e],0-t[r]])}return{vars:n.size,clauses:c}}function v(e,t){return function e(t,r,n,o){0!==n&&(r[n]=o);const i=function(e,t){const r=[];for(;;){let n=!0;const o=[];for(let i=0;i<e.length;i++){const s=e[i];let a=0,l=0,c=0;for(let e=0;e<s.length;e++){const r=s[e];let n,o;if(r<0?(n=0-r,o=-1):(n=r,o=1),t[n]===o){a=1;break}0===t[n]&&(l++,c=r)}if(1!==a){if(0===l){for(let e=0;e<r.length;e++)t[r[e]]=0;return-1}1===l&&o.push(c),0!==l&&(n=!1)}}if(n)return 1;if(0===o.length)break;for(let e=0;e<o.length;e++){const n=o[e];let i,s;n<0?(i=0-n,s=-1):(i=n,s=1),t[i]=s,r.push(i)}}return r}(t,r);if(1===i)return r[n]=0,!0;if(-1===i)return r[n]=0,!1;let s=0;for(let e=1;e<r.length;e++)if(0===r[e]){s=e;break}if(0===s)throw new Error("Error in satisfiableAt");if(e(t,r,s,1)||e(t,r,s,-1))return!0;r[s]=0;for(let e=0;e<i.length;e++)r[i[e]]=0;return!1}(e,new Int32Array(t+1),0,0)}const w=Array.isArray,y=new WeakMap,b={};function A(e,t){let r=!0;for(;r;){r=!1;for(let n=2;n<e.length;++n){const o=t(e[n-1],e[n],n-2);o!==b&&(r=!0,(e=e.slice()).splice(n-1,2,o))}}return 2===e.length?e[1]:e}function O(e,t="",r=""){const n={"-":"\\-","/":"\\/","\\":"\\/","^":"\\^",$:"\\$","*":"\\*","+":"\\+","?":"\\?",".":"\\.","(":"\\(",")":"\\)","|":"\\|","[":"\\[","]":"\\]","{":"\\{","}":"\\}","\\%":".*","\\_":"."};let o=h(e,t);if(!o.length)return new RegExp("^$",r);(o=o.map(e=>n[e]||e))[0]=".*"===o[0]?"":"^"+o[0];const i=o.length-1;return o[i]=[".*",""].includes(o[i])?"":o[i]+"$",new RegExp(o.join(""),r)}function E(e,t,r,n){return l(e,e=>{if(n&&(e=n(e)),!w(e))return e;if("FUNC"===e[0]){if("NOW"===e[1]){if(r)return r}else if("UPPER"===e[1]){if(null==e[2])return null;if(!w(e[2]))return`${e[2]}`.toUpperCase()}else if("LOWER"===e[1]){if(null==e[2])return null;if(!w(e[2]))return`${e[2]}`.toLowerCase()}}else if("PARAM"===e[0]){if(null==e[1])return null;if(t&&!w(e[1])){let r;return null==(r="function"==typeof t?t(e[1]):t[e[1]])?null:("object"==typeof r&&(r=r.value?r.value[0]:null),r)}}return function(e){if("AND"===e[0])return A(e,(e,t)=>w(e)?w(t)?b:t?e:t:e?t:e);if("OR"===e[0])return A(e,(e,t)=>w(e)?w(t)?b:t||e:e||t);if("NOT"===e[0]){if(!w(e[1]))return!e[1];if("NOT"===e[1][0])return e[1][1]}else{if("IS NULL"===e[0])return w(e[1])?e:null==e[1]||null;if("IS NOT NULL"===e[0])return w(e[1])?e:null!=e[1]||null;if("LIKE"===e[0]){if(w(e[1])||w(e[2])||w(e[3]))return e;if(null==e[1]||null==e[2]||e.length>=4&&null==e[3])return null;let t=y.get(e);return t||(t=O(e[2],e[3]),y.set(e,t)),t.test(e[1])}if("NOT LIKE"===e[0]){if(w(e[1])||w(e[2])||w(e[3]))return e;if(null==e[1]||null==e[2]||e.length>=4&&null==e[3])return null;let t=y.get(e);return t||(t=O(e[2],e[3]),y.set(e,t)),!t.test(e[1])}if("="===e[0])return w(e[1])||w(e[2])?e:null==e[1]||null==e[2]?null:e[1]===e[2];if("<>"===e[0])return w(e[1])||w(e[2])?e:null==e[1]||null==e[2]?null:e[1]!==e[2];if(">"===e[0])return w(e[1])||w(e[2])?e:null==e[1]||null==e[2]?null:e[1]>e[2];if(">="===e[0])return w(e[1])||w(e[2])?e:null==e[1]||null==e[2]?null:e[1]>=e[2];if("<"===e[0])return w(e[1])||w(e[2])?e:null==e[1]||null==e[2]?null:e[1]<e[2];if("<="===e[0])return w(e[1])||w(e[2])?e:null==e[1]||null==e[2]?null:e[1]<=e[2];if("*"===e[0])return A(e,(e,t)=>w(e)||w(t)?b:null==e||null==t?null:e*t);if("/"===e[0])return A(e,(e,t,r)=>w(e)||w(t)?b:null==e||null==t?null:0===r?e/t:e*t);if("+"===e[0])return A(e,(e,t)=>w(e)||w(t)?b:null==e||null==t?null:e+t);if("-"===e[0])return A(e,(e,t,r)=>w(e)||w(t)?b:null==e||null==t?null:0===r?e-t:e+t);if("||"===e[0])return A(e,(e,t)=>w(e)||w(t)?b:null==e||null==t?null:`${e}${t}`)}return e}(e)})}function P(e,t){if(!w(e))return e?t:e;if(!w(t))return t?e:t;let r=["AND"];return"AND"===e[0]?r=r.concat(e.slice(1)):r.push(e),"AND"===t[0]?r=r.concat(t.slice(1)):r.push(t),r}function x(e,t){if(!w(e))return e||t;if(!w(t))return t||e;let r=["OR"];return"OR"===e[0]?r=r.concat(e.slice(1)):r.push(e),"OR"===t[0]?r=r.concat(t.slice(1)):r.push(t),r}function j(e){return w(e)&&"NOT"===e[0]?e[1]:["NOT",e]}function k(e,t){const r=E(["NOT",["OR",["NOT",e],t]]);if(!w(r))return!r;const{vars:n,clauses:o}=g(r);return!v(o,n)}let S=new Map,C=new Map;const $=new WeakMap;function D(e){if(null===e)return"null";if(void 0===e)return"undefined";const t=typeof e;if("number"===t||"boolean"===t||"string"===t)return`${t}:${e}`;if("function"!==t&&"object"!==t)throw new Error(`Cannot memoize ${t} arguments`);let r=$.get(e);if(!r){r=`${t}:${Math.trunc(Math.random()*Number.MAX_SAFE_INTEGER).toString(36)}`,$.set(e,r)}return r}function T(e){const t=D(e);return(...r)=>{const n=JSON.stringify(r.map(D))+t;if(S.has(n))return S.get(n);let o;return o=C.has(n)?C.get(n):e(...r),S.set(n,o),o}}const I=setInterval(()=>{C=S,S=new Map},12e4);I.unref&&I.unref();const R=new Set;function N(e,t,r){const n={type:e,message:t,timestamp:Date.now(),actions:r};return R.add(n),o.a.redraw(),r||setTimeout(()=>{_(n)},4e3),n}function _(e){R.delete(e),o.a.redraw()}const L=window.clientConfig,M=window.configSnapshot,U=window.genieacsVersion,z=T(d),B=T(E);let F,Y,W,V=0;const q={filter:new WeakMap,bookmark:new WeakMap,limit:new WeakMap,sort:new WeakMap,fulfilled:new WeakMap,fulfilling:new WeakSet,accessed:new WeakMap,value:new WeakMap},J={};for(const e of["devices","faults","files","presets","provisions","virtualParameters","files","config","users","permissions"])J[e]={objects:new Map,count:new Map,fetch:new Map,combinedFilter:null};class H{get fulfilled(){return q.accessed.set(this,Date.now()),!!q.fulfilled.get(this)}get fulfilling(){return q.accessed.set(this,Date.now()),q.fulfilling.has(this)}get value(){return q.accessed.set(this,Date.now()),q.value.get(this)}}async function K(e){const t=e.extract,r=e.deserialize;return e.extract=(e,n)=>{if("function"==typeof t)return t(e,n);let o;if("function"==typeof r)o=r(e.responseText);else if(e.getResponseHeader("content-type").startsWith("application/json"))try{o=e.responseText?JSON.parse(e.responseText):null}catch(t){throw new Error("Invalid JSON: "+e.responseText.slice(0,80))}else o=e.responseText;if(304!==e.status&&2!==Math.floor(e.status/100)){const t=new Error;throw t.message=e.responseText,t.code=e.status,t.response=o,t}return o},o.a.request(e)}function Q(e){if(!Array.isArray(e))return e;return B(e,null,V)}function G(e,t){const r=z(t);let n=J[e].count.get(r);return n||(n=new H,J[e].count.set(r,n),q.filter.set(n,t),n)}function Z(e,t,r){return P(e,Object.entries(t).sort((e,t)=>Math.abs(t[1])-Math.abs(e[1])).reverse().reduce((e,t)=>{const[n,o]=t;if(o<=0){if(null==r[n])return x(["IS NOT NULL",["PARAM",n]],P(["IS NULL",["PARAM",n]],e));let t=null;return"string"!=typeof r[n]&&(t=x(t,[">=",["PARAM",n],""])),t=x(t,[">",["PARAM",n],r[n]]),x(t,P(["=",["PARAM",n],r[n]],e))}{let t=["IS NULL",["PARAM",n]];return null==r[n]?P(t,e):("number"!=typeof r[n]&&(t=x(t,[">=",["PARAM",n],0]),t=x(t,["<",["PARAM",n],0])),t=x(t,["<",["PARAM",n],r[n]]),x(t,P(["=",["PARAM",n],r[n]],e)))}},!0))}function X(e,t,r,n){let o=[];for(const r of J[e].objects.values())E(t,r,V)&&o.push(r);return o=o.sort(function(e){const t=Object.entries(e).sort((e,t)=>Math.abs(t[1])-Math.abs(e[1]));return(e,r)=>{for(const[n,o]of t){let t=e[n],i=r[n];if(null!=t&&"object"==typeof t&&(t=t.value?t.value[0]:null),null!=i&&"object"==typeof i&&(i=i.value?i.value[0]:null),t>i)return o;if(t<i)return-1*o;if(t!==i){const e={null:1,number:2,string:3},r=e[null==t?"null":typeof t]||4,n=e[null==i?"null":typeof i]||4;return Math.max(-1,Math.min(1,r-n))*o}}return 0}}(r)),n&&(o=o.slice(0,n)),o}function ee(e,t,r={}){const n=z(t),o=Object.assign({},r.sort);for(const[e,t]of Object.entries(o))o[e]+=Math.sign(t);const i=r.limit||0;"devices"===e?o["DeviceID.ID"]=o["DeviceID.ID"]||1:o._id=o._id||1;const s=`${n}:${i}:${JSON.stringify(o)}`;let a=J[e].fetch.get(s);return a||(a=new H,J[e].fetch.set(s,a),q.filter.set(a,t),q.limit.set(a,i),q.sort.set(a,o),function(e,t){const r=q.limit.get(t);let n=q.filter.get(t);n=Q(n);const o=q.bookmark.get(t),i=q.sort.get(t);!o&&r||(o&&(n=Z(n,i,o)),J[e].combinedFilter&&k(n,J[e].combinedFilter)&&q.fulfilled.set(t,V)),q.value.set(t,X(e,n,i,r))}(e,a),a)}function te(e,t){let r=!1;if(t>V){for(const e of Object.values(J))e.combinedFilter=null;V=t}const n=[];for(const[t,i]of Object.entries(J))for(const[s,a]of i.count)q.accessed.get(a)>=e?q.fulfilling.has(a)||V<=q.fulfilled.get(a)||(q.fulfilling.add(a),n.push(new Promise((e,n)=>{r=!0;let i=q.filter.get(a);i=Q(i),K({method:"HEAD",url:`/api/${t}/?`+o.a.buildQueryString({filter:z(i)}),extract:e=>+e.getResponseHeader("x-total-count"),background:!0}).then(t=>{q.value.set(a,t),q.fulfilled.set(a,V),q.fulfilling.delete(a),e()}).catch(e=>n(e))}))):i.count.delete(s);const i={};for(const[t,s]of Object.entries(J))for(const[a,l]of s.fetch)if(q.accessed.get(l)>=e){if(!(q.fulfilling.has(l)||V<=q.fulfilled.get(l))){q.fulfilling.add(l),i[t]=i[t]||[],i[t].push(l);const e=q.limit.get(l),s=q.sort.get(l);e&&n.push(new Promise((n,i)=>{r=!0;let a=q.filter.get(l);a=Q(a),K({method:"GET",url:`/api/${t}/?`+o.a.buildQueryString({filter:z(a),limit:1,skip:e-1,sort:JSON.stringify(s),projection:Object.keys(s).join(",")})}).then(e=>{if(e.length){const t=Object.keys(s).reduce((t,r)=>(null!=e[0][r]&&("object"==typeof e[0][r]?null!=e[0][r].value&&(t[r]=e[0][r].value[0]):t[r]=e[0][r]),t),{});q.bookmark.set(l,t)}else q.bookmark.delete(l);n()}).catch(i)}))}}else s.fetch.delete(a);return new Promise((e,t)=>{Promise.all(n).then(()=>{const n=[];for(let[e,t]of Object.entries(i)){let i=null;if(t=t.filter(t=>{let r=q.filter.get(t);r=Q(r);const n=q.limit.get(t),o=q.bookmark.get(t),s=q.sort.get(t);return o&&(r=Z(r,s,o)),J[e].combinedFilter&&k(r,J[e].combinedFilter)?(q.value.set(t,X(e,r,s,n)),q.fulfilled.set(t,V),q.fulfilling.delete(t),!1):(i=x(i,r),!0)}),null==i)continue;r=!0;let s=new Set;J[e].combinedFilter||(s=new Set(J[e].objects.keys()));let a=i;J[e].combinedFilter&&(a=P(a,j(J[e].combinedFilter))),J[e].combinedFilter=x(i,J[e].combinedFilter),n.push(new Promise((r,n)=>{K({method:"GET",url:`/api/${e}/?`+o.a.buildQueryString({filter:z(a)})}).then(n=>{for(const t of n){const r="devices"===e?t["DeviceID.ID"].value[0]:t._id;J[e].objects.set(r,t),s.delete(r)}for(const t of s){const r=J[e].objects.get(t);E(a,r,V)&&J[e].objects.delete(t)}for(const r of t){let t=q.filter.get(r);t=Q(t);const n=q.limit.get(r),o=q.bookmark.get(r),i=q.sort.get(r);o&&(t=Z(t,i,o)),q.value.set(r,X(e,t,i,n)),q.fulfilled.set(r,V),q.fulfilling.delete(r)}r()}).catch(n)}))}Promise.all(n).then(()=>e(r)).catch(t)}).catch(t)})}function re(e,t){for(const r of t)r.status="pending",r.device=e;return K({method:"POST",url:`/api/devices/${encodeURIComponent(e)}/tasks`,body:t,extract:e=>{if(200!==e.status)throw new Error(e.response);const r=e.getResponseHeader("Connection-Request"),n=JSON.parse(e.response);for(const[e,r]of n.entries())t[e]._id=r._id,t[e].status=r.status,t[e].fault=r.fault;return r}})}function ne(e,t){return K({method:"POST",url:`/api/devices/${encodeURIComponent(e)}/tags`,body:t})}function oe(e,t){return K({method:"DELETE",url:`/api/${e}/${encodeURIComponent(t)}`})}function ie(e,t,r){for(const e in r)void 0===r[e]&&(r[e]=null);return K({method:"PUT",url:`/api/${e}/${encodeURIComponent(t)}`,body:r})}function se(e,t){const r=["=",["PARAM","devices"===e?"DeviceID.ID":"_id"],t];return K({method:"HEAD",url:`/api/${e}/?`+o.a.buildQueryString({filter:z(r)}),extract:e=>+e.getResponseHeader("x-total-count"),background:!0})}function ae(e,t){return Array.isArray(e)?B(e,t,V):e}function le(e,t,r){const n={newPassword:t};return r&&(n.authPassword=r),K({method:"PUT",url:`/api/users/${e}/password`,background:!0,body:n})}setInterval(function(){o.a.request({url:"/status",method:"GET",background:!0,extract:e=>{if(200!==e.status)F||(F=N("warning","Server is unreachable",{}));else{F&&(_(F),F=null);const t=e.getResponseHeader("x-config-snapshot")!==M,r=e.getResponseHeader("genieacs-version")!==U;!Y!=!t&&(Y?(_(Y),Y=null):Y=N("warning","Configuration has been modified, please reload the page",{Reload:()=>{window.location.reload()}})),!W!=!r&&(W?(_(W),W=null):W=N("warning","Server has been updated, please reload the page",{Reload:()=>{window.location.reload()}}))}}})},3e3);const ce=new Set,ue=new Set;function fe(e){ue.delete(e),e.status="queued",ce.add(e)}function de(e){ue.delete(e),ce.delete(e)}function he(){return ce}function pe(){ce.clear()}function me(){return ue}function ge(e,t){const r={};for(const t of e)r[t.device]=r[t.device]||[],r[t.device].push(t),fe(t);return new Promise(e=>{let n=1;for(const[o,i]of Object.entries(r))++n,re(o,i).then(r=>{for(const e of i)"pending"===e.status?e.status="stale":"done"===e.status&&ce.delete(e);t(o,null,r,i),0==--n&&e()}).catch(r=>{for(const e of i)e.status="stale";t(o,r,null,i),0==--n&&e()});0==--n&&e()})}function ve(e){return o()(`svg.icon.icon-${e}`,{key:`icon-${e}`},o()("use",{href:`icons.svg#icon-${e}`}))}function we(e){return o()("span.parameter",{title:e},`${e}`)}function ye(e,t,r){function n(e){13===e.keyCode?t():27===e.keyCode?r():e.redraw=!1}let i;return i="xsd:boolean"===e.parameterValues[0][2]?o()("select",{value:e.parameterValues[0][1].toString(),onchange:t=>{t.redraw=!1,e.parameterValues[0][1]=i.dom.value},onkeydown:n,oncreate:e=>{e.dom.focus()}},[o()("option",{value:"true"},"true"),o()("option",{value:"false"},"false")]):o()("input",{type:["xsd:dateTime","xsd:int","xsd:unsignedInt"].includes(e.parameterValues[0][2])?"number":"text",value:e.parameterValues[0][1],oninput:t=>{t.redraw=!1,e.parameterValues[0][1]=i.dom.value},onkeydown:n,oncreate:e=>{e.dom.focus(),e.dom.select(),e.dom.parentNode.parentNode.scrollTop=0}}),[o()("span","Editing ",we(e.parameterValues[0][0])),i]}function be(e){e.invalid=!e.fileName||!e.fileType;const t=ee("files",!0),r=e.device.split("-"),n=decodeURIComponent(r[0]),i=3===r.length?decodeURIComponent(r[1]):"",s=["","1 Firmware Upgrade Image","2 Web Content","3 Vendor Configuration File","4 Tone File","5 Ringer File"].map(t=>o()("option",{disabled:!t,value:t,selected:(e.fileType||"")===t},t)),a=[""].concat(t.value.filter(e=>!(e["metadata.oui"]&&e["metadata.oui"]!==n||e["metadata.productClass"]&&e["metadata.productClass"]!==i)).map(e=>e._id)).map(t=>o()("option",{disabled:!t,value:t,selected:(e.fileName||"")===t},t));return["Push ",o()("select",{onchange:r=>{const n=r.target.value;e.fileName=n,e.fileType="";for(const r of t.value)r._id===n&&(e.fileType=r["metadata.fileType"])},disabled:t.fulfilling,style:"width: 350px"},a)," as ",o()("select",{onchange:t=>{e.fileType=t.target.value}},s)]}const Ae=()=>({view:e=>{const t=he(),r=me();let n,i;const s=function(e){const t=[];for(const r of e){let e;if(r.actions){const t=Object.entries(r.actions).map(([e,t])=>o()("button.primary",{onclick:t},e));t.length&&(e=o()("div",{style:"float: right"},t))}t.push(o()("div.notification",{class:r.type,style:"position: absolute;opacity: 0",oncreate:e=>{e.dom.style.opacity="1"},onbeforeremove:e=>(e.dom.style.opacity="0",new Promise(e=>{setTimeout(()=>{e()},500)})),key:r.timestamp},o()("div",e,r.message)))}return t}(R),a=function(e){const t=[];for(const r of e){const n=()=>{e.delete(r),fe(r)},i=()=>{e.delete(r)};let s;"setParameterValues"===r.name?s=ye(r,n,i):"download"===r.name&&(s=be(r));const a=o()("button.primary",{title:"Queue task",onclick:n,disabled:r.invalid},"Queue"),l=o()("button",{title:"Cancel edit",onclick:i},"Cancel");t.push(o()(".staging",s,o()("div.actions",a,l)))}return t}(r),l=function(e){const t=[],r={};for(const t of e)r[t.device]=r[t.device]||[],r[t.device].push(t);for(const[e,i]of Object.entries(r)){t.push(o()("strong",e));for(const e of i){const r=[];"fault"!==e.status&&"stale"!==e.status||r.push(o()("button",{title:"Retry this task",onclick:()=>{fe(e)}},ve("retry"))),r.push(o()("button",{title:"Remove this task",onclick:()=>{de(e)}},ve("remove"))),"setParameterValues"===e.name?t.push(o()(`div.${e.status}`,o()("span","Set ",we(e.parameterValues[0][0])," to '",(n=e.parameterValues[0][1],o()("span.value",{title:n},`${n}`)),"'"),o()(".actions",r))):"refreshObject"===e.name?t.push(o()(`div.${e.status}`,o()("span","Refresh ",we(e.parameterName)),o()(".actions",r))):"reboot"===e.name?t.push(o()(`div.${e.status}`,"Reboot",o()(".actions",r))):"factoryReset"===e.name?t.push(o()(`div.${e.status}`,"Factory reset",o()(".actions",r))):"addObject"===e.name?t.push(o()(`div.${e.status}`,o()("span","Add ",we(e.objectName)),o()(".actions",r))):"deleteObject"===e.name?t.push(o()(`div.${e.status}`,o()("span","Delete ",we(e.objectName)),o()(".actions",r))):"getParameterValues"===e.name?t.push(o()(`div.${e.status}`,`Refresh ${e.parameterNames.length} parameters`,o()(".actions",r))):"download"===e.name?t.push(o()(`div.${e.status}`,`Push file: ${e.fileName} (${e.fileType})`,o()(".actions",r))):t.push(o()(`div.${e.status}`,e.name,o()(".actions",r)))}}var n;return t}(t);function c(){let e=10;for(const t of s)t.dom.style.top=`${e}`,e+=t.dom.offsetHeight+10}function u(){let t=i.dom.offsetTop+i.dom.offsetHeight;if(a.length)for(const e of a)t=Math.max(t,e.dom.offsetTop+e.dom.offsetHeight);else if(e.state.mouseIn)for(const e of n.children)t=Math.max(t,e.dom.offsetTop+e.dom.offsetHeight);n.dom.style.height=t}if(a.length+l.length){const r={queued:0,pending:0,fault:0,stale:0};for(const e of t)r[e.status]+=1;const s=o()(".actions",o()("button.primary",{title:"Commit queued tasks",disabled:!r.queued,onclick:()=>{ge(Array.from(he()).filter(e=>"queued"===e.status),(e,t,r,n)=>{if(t)N("error",`${e}: ${t.message}`);else if("OK"===r){for(const t of n){if("stale"===t.status)return void N("error",`${e}: No contact from device`);if("fault"===t.status)return void N("error",`${e}: Task(s) faulted`)}N("success",`${e}: Task(s) committed`)}else N("error",`${e}: ${r}`)}).then(()=>{te(0,Date.now())})}},"Commit"),o()("button",{title:"Clear tasks",onclick:pe,disabled:!l.length},"Clear"));i=o()(".status",o()("span.queued",{class:r.queued?"active":""},`Queued: ${r.queued}`),o()("span.pending",{class:r.pending?"active":""},`Pending: ${r.pending}`),o()("span.fault",{class:r.fault?"active":""},`Fault: ${r.fault}`),o()("span.stale",{class:r.stale?"active":""},`Stale: ${r.stale}`),s),n=o()(".drawer",{key:"drawer",style:"opacity: 0;height: 0;",oncreate:t=>{e.state.mouseIn=!1,t.dom.style.opacity="1",u()},onmouseover:t=>{e.state.mouseIn=!0,u(),t.redraw=!1},onmouseleave:t=>{e.state.mouseIn=!1,u(),t.redraw=!1},onupdate:u,onbeforeremove:e=>(e.dom.onmouseover=null,e.dom.onmouseleave=null,e.dom.style.opacity="0",e.dom.style.height="0",new Promise(e=>{setTimeout(e,500)}))},i,a.length?a:o()(".queue",l))}return o()("div.drawer-wrapper",n,o()("div.notifications-wrapper",{key:"notifications",style:"position: relative;",onupdate:c,oncreate:c},s))}}),Oe=()=>({view:()=>window.username?o()("div.user-menu",window.username,o()("button",{onclick:e=>(e.target.disabled=!0,K({method:"POST",url:"/logout"}).then(()=>{location.hash="",location.reload()}).catch(t=>{e.target.disabled=!1,N("error",t.message)}),!1)},"Log out")):o()("div.user-menu",o()("a",{href:"#!/login?"+o.a.buildQueryString({continue:o.a.route.get()})},"Log in"))}),Ee=()=>({view:e=>{const t={[e.attrs.page]:"active"},r=[];return window.authorizer.hasAccess("presets",1)&&r.push(o()("li",{class:t.presets},o()("a",{href:"#!/admin/presets"},"Presets"))),window.authorizer.hasAccess("provisions",1)&&r.push(o()("li",{class:t.provisions},o()("a",{href:"#!/admin/provisions"},"Provisions"))),window.authorizer.hasAccess("virtualParameters",1)&&r.push(o()("li",{class:t.virtualParameters},o()("a",{href:"#!/admin/virtualParameters"},"Virtual Parameters"))),window.authorizer.hasAccess("files",1)&&r.push(o()("li",{class:t.files},o()("a",{href:"#!/admin/files"},"Files"))),window.authorizer.hasAccess("config",1)&&r.push(o()("li",{class:t.config},o()("a",{href:"#!/admin/config"},"Config"))),window.authorizer.hasAccess("permissions",1)&&r.push(o()("li",{class:t.permissions},o()("a",{href:"#!/admin/permissions"},"Permissions"))),window.authorizer.hasAccess("users",1)&&r.push(o()("li",{class:t.users},o()("a",{href:"#!/admin/users"},"Users"))),o()("nav#side-menu",o()("ul",r))}});let Pe=null;function xe(e){Pe=e}function je(e){return e===Pe&&(Pe=null,!0)}document.addEventListener("keydown",e=>{Pe&&27===e.keyCode&&je(Pe)&&o.a.redraw()}),window.addEventListener("popstate",()=>{je(Pe)&&o.a.redraw()});const ke=["presets","provisions","virtualParameters","files","config","users","permissions"],Se=()=>({view:e=>{let t,r;if(ke.includes(e.attrs.page)){r="admin";const n={};n.page=e.attrs.page,t=o()(Ee,n)}const n={};return n.page=r||e.attrs.page,[o()("#header",[o()("img.logo",{src:"logo.svg"}),o()(Oe),o()(s,n),o()(Ae)]),o()("#content-wrapper",t,o()("#content",{class:`page-${e.attrs.page}`},[e.children])),Pe?o()(".overlay-wrapper",{tabindex:0,onclick:()=>{je(Pe)},style:"opacity: 0",oncreate:e=>{e.dom.focus(),e.dom.style.opacity="1"},onbeforeremove:e=>(e.dom.style.opacity="0",new Promise(e=>{setTimeout(()=>{e()},500)}))},o()(".overlay",{onclick:e=>{e.stopPropagation()}},Pe())):null]}});const Ce=Object.freeze({init:async function(){return o.a.request({url:"/init"})},component:e=>{let t=e.attrs;const r=new Set;for(const[e,n]of Object.entries(t))n&&r.add(e);return{view:()=>{document.title="Initialization wizard - GenieACS";const e=["users","presets","filters","device","index","overview"].map(e=>(t[e]||r.delete(e),o()("input",{type:"checkbox",checked:r.has(e),disabled:!t[e],style:"display: inline; margin-right: 0.5em;",onclick:t=>{t.target.checked?r.add(e):r.delete(e)}})));return o()(".wizard-dialog",[o()("h1","Initialization wizard"),o()("p","This wizard will seed the database with a minimal initial configuration to serve as a starting point. Select what you want to initialize and click 'ABRACADABRA!'."),o()("div",o()("label",e[0],"Users, roles and permissions")),o()("div",o()("label",e[1],"Presets and provisions")),o()("div",o()("label",e[2],"Devices predefined search filters")),o()("div",o()("label",e[3],"Device details page")),o()("div",o()("label",e[4],"Devices listing page")),o()("div",o()("label",e[5],"Overview page")),o()("button.primary",{style:"margin: 10px;",disabled:0===r.size,onclick:e=>{e.target.disabled=!0;const n={};for(const e of r)n[e]=!0;o.a.request({method:"POST",url:"/init",body:n}).then(()=>{setTimeout(()=>{o.a.request({url:"/init"}).then(r=>{e.target.disabled=!1,t=r,N("success","Initialization complete",{"Open Sesame!":()=>{o.a.route.set("/login"),window.location.reload()}})})},3e3),n.users&&alert("An administrator user has been created for you. Use admin/admin to log in. Don't forget to change the default password.")}).catch(e=>{N("error",e.message)})}},"ABRACADABRA!")])}}}}),$e={year:31104e6,month:2592e6,day:864e5,hour:36e5,minute:6e4,second:1e3};const De=T((e,t,r)=>{let n=r;const o=new Set,i=E(e,t,r,e=>{if(Array.isArray(e)){if("PARAM"===e[0]&&(o.add(e[1]),!Array.isArray(e[1]))){const r=t[e[1]];r&&r.valueTimestamp&&(n=Math.min(n,r.valueTimestamp))}if("FUNC"===e[0]&&"DATE_STRING"===e[1]&&!Array.isArray(e[2]))return new Date(e[2]).toLocaleString()}return e});let s=1===o.size?o.values().next().value:null;return Array.isArray(s)&&(s=null),{value:i,timestamp:n,parameter:s}}),Te=L.ui.overview.charts,Ie=T(f);const Re={parameter:()=>({view:e=>{const t=e.attrs.device,{value:r,timestamp:n,parameter:o}=De(e.attrs.parameter,e.attrs.device,V);if(null==r)return null;let i;t[o]&&t[o].writable&&(i=Le("button",{title:"Edit parameter value",onclick:()=>{!function(e){ue.add(e)}({name:"setParameterValues",device:t["DeviceID.ID"].value[0],parameterValues:[[o,t[o].value[0],t[o].value[1]]]})}},ve("edit")));const s=Le("long-text",{text:`${r}`});return Le("span",{class:"parameter-value",onmouseover:e=>{if(e.redraw=!1,e.target===s.dom){const t=Date.now(),r=new Date(n).toLocaleString();e.target.title=`${r} (${function(e){let t="",r=2;for(const[n,o]of Object.entries($e))if(e>=o){let i;if(r>1?e-=(i=Math.floor(e/o))*o:i=Math.round(e/o),t+=i>1?`${i} ${n}s `:`${i} ${n} `,!--r)break}return t+"ago"}(t-n)})`}}},s,i)}}),"parameter-list":()=>({view:e=>{const t=e.attrs.device,r=Object.values(e.attrs.parameters).map(e=>{const r=Le.context({device:t,parameter:e.parameter},e.type||"parameter",e);return Le("tr",{onupdate:e=>{e.dom.style.display=r.dom?"":"none"}},Le("th",e.label),Le("td",r))});return Le("table.parameter-list",r)}}),"parameter-table":()=>({oninit:e=>{const t=e.attrs.parameter;if(!Array.isArray(t)||"PARAM"!==t[0])throw new Error("Object must be a parameter path");e.state.object=t[1],e.state.parameters=Object.values(e.attrs.childParameters)},view:e=>{const t=e.attrs.device,r=ae(e.state.object,t),n=e.state.parameters;if(!t[r])return null;const o=new Set,i=`${r}.`;for(const e in t)if(e.startsWith(i)){const t=e.indexOf(".",i.length);-1===t?o.add(e):o.add(e.slice(0,t))}const s=Object.values(n).map(e=>Le("th",e.label)),a=Le("thead",Le("tr",s)),c=[];for(const r of o){let o=null==e.attrs.filter||e.attrs.filter;if(!ae(o=l(o,e=>Array.isArray(e)&&"PARAM"===e[0]?["PARAM",["||",r,".",e[1]]]:e),t))continue;const i=n.map(e=>{const n=l(e.parameter,e=>Array.isArray(e)&&"PARAM"===e[0]?["PARAM",["||",r,".",e[1]]]:e);return Le("td",Le.context({device:t,parameter:n},e.type||"parameter",Object.assign({},e,{device:t,parameter:n,label:null})))});!0===t[r].writable&&i.push(Le("td",Le("button",{title:"Delete this instance",onclick:()=>{fe({name:"deleteObject",device:t["DeviceID.ID"].value[0],objectName:r})}},ve("delete-instance")))),c.push(Le("tr",i))}let u;return c.length||c.push(Le("tr.empty",Le("td",{colspan:s.length},"No instances"))),!0===t[r].writable&&c.push(Le("tr",Le("td",{colspan:s.length}),Le("td",Le("button",{title:"Create a new instance",onclick:()=>{fe({name:"addObject",device:t["DeviceID.ID"].value[0],objectName:r})}},ve("add-instance"))))),e.attrs.label&&(u=Le("h2",e.attrs.label)),[u,Le("table.table",a,Le("tbody",c))]}}),"overview-dot":()=>({view:e=>{const t=e.attrs.device,r=Te[e.attrs.chart];if(!r)return null;for(const e of Object.values(r.slices))if(ae(e.filter,t)){const t=Le("svg",{width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},Le("circle",{cx:"0.5em",cy:"0.5em",r:"0.4em",fill:e.color}));return Le("span.overview-dot",t,`${e.label}`)}return null}}),container:()=>({view:e=>{if(e.attrs.filter&&!ae(e.attrs.filter,e.attrs.device))return null;const t=Object.values(e.attrs.components).map(e=>"object"!=typeof e?`${e}`:Le(e.type,e));return e.attrs.element?Le(e.attrs.element,t):t}}),"summon-button":()=>({view:e=>{const t=e.attrs.device;return Le("button.primary",{title:"Initiate session and refresh basic parameters",onclick:r=>{r.target.disabled=!0,ge([{name:"getParameterValues",parameterNames:Object.values(e.attrs.parameters).map(e=>Array.isArray(e)&&"PARAM"===e[0]?ae(e[1],t):null).filter(e=>!!e),device:t["DeviceID.ID"].value[0]}],(e,t,r,n)=>{if(t)N("error",`${e}: ${t.message}`);else{for(const e of n)"stale"===e.status&&de(e);"OK"!==r?N("error",`${e}: ${r}`):"stale"===n[0].status?N("error",`${e}: No contact from device`):"fault"===n[0].status?N("error",`${e}: Refresh faulted`):N("success",`${e}: Summoned`)}}).then(()=>{r.target.disabled=!1,te(0,Date.now())})}},"Summon")}}),"device-faults":()=>({view:e=>{const t=e.attrs.device["DeviceID.ID"].value[0],r=ee("faults",["AND",[">",["PARAM","_id"],`${t}:`],["<",["PARAM","_id"],`${t}:zzzz`]]),n=["Channel","Code","Message","Retries","Timestamp"].map(e=>Le("th",e)),o=Le("thead",Le("tr",n)),i=[];for(const e of r.value)i.push([Le("td",e.channel),Le("td",e.code),Le("td",e.message),Le("td",e.retries),Le("td",new Date(e.timestamp).toLocaleString()),Le("td",Le("button",{title:"Delete fault",onclick:t=>{t.redraw=!1,oe("faults",e._id).then(()=>{N("success","Fault deleted"),te(Date.now(),Date.now()),Le.redraw()}).catch(e=>{N("error",e.message),te(Date.now(),Date.now())})}},ve("remove")))]);let s;return s=i.length?Le("tbody",i.map(e=>Le("tr",e))):Le("tbody",Le("tr.empty",Le("td",{colspan:n.length},"No faults"))),Le("table.table",o,s)}}),"all-parameters":()=>({view:e=>{const t=e.attrs.device,r=Le("input",{type:"text",placeholder:"Search parameters",oninput:t=>{e.state.searchString=t.target.value,t.redraw=!1,clearTimeout(e.state.timeout),e.state.timeout=setTimeout(Le.redraw,500)}}),n=/\.[0-9]+$/;let o;if(e.state.searchString){const t=e.state.searchString.split(" ").filter(e=>e);t.length&&(o=new RegExp(t.map(e=>(function(e){return e.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")})(e)).join(".*"),"i"))}const i=Object.keys(t).sort().map(e=>{const r=t[e],i=[],s={};if(o){const t=r.value&&r.value[0]?`${e} ${r.value[0]}`:e;o.test(t)||(s.style="display: none;")}return!1===r.object?i.push(Le("parameter",Object.assign({device:t,parameter:Ie(e)}))):r.object&&r.writable&&(n.test(e)?i.push(Le("button",{title:"Delete this instance",onclick:()=>{fe({name:"deleteObject",device:t["DeviceID.ID"].value[0],objectName:e})}},ve("delete-instance"))):i.push(Le("button",{title:"Create a new instance",onclick:()=>{fe({name:"addObject",device:t["DeviceID.ID"].value[0],objectName:e})}},ve("add-instance")))),i.push(Le("button",{title:"Refresh tree",onclick:()=>{fe({name:"getParameterValues",device:t["DeviceID.ID"].value[0],parameterNames:[e]})}},ve("refresh"))),Le("tr",s,Le("td.left",Le("long-text",{text:e})),Le("td.right",i))});return Le(".all-parameters",Le("a.download-csv",{href:`/api/devices/${encodeURIComponent(t["DeviceID.ID"].value[0])}.csv`,download:"",style:"float: right;"},"Download"),r,Le(".parameter-list",Le("table",Le("tbody",i))))}}),"device-actions":()=>({view:e=>{const t=e.attrs.device,r=[];return r.push(Le("button.primary",{title:"Reboot device",onclick:()=>{fe({name:"reboot",device:t["DeviceID.ID"].value[0]})}},"Reboot")),r.push(Le("button.critical",{title:"Factory reset device",onclick:()=>{fe({name:"factoryReset",device:t["DeviceID.ID"].value[0]})}},"Reset")),r.push(Le("button.critical",{title:"Push a firmware or a config file",onclick:()=>{!function(e){ue.add(e)}({name:"download",device:t["DeviceID.ID"].value[0]})}},"Push file")),r.push(Le("button.primary",{title:"Delete device",onclick:()=>{if(!confirm("Deleting this device. Are you sure?"))return;const e=t["DeviceID.ID"].value[0];oe("devices",e).then(()=>{N("success",`${e}: Device deleted`),Le.route.set("/devices")}).catch(e=>{N("error",e.message)})}},"Delete")),Le(".actions-bar",r)}}),tags:()=>({view:e=>{const t=e.attrs.device;let r=!0;null!=e.attrs.writable&&(r=e.attrs.writable);const n=[];for(const e of Object.keys(t))e.startsWith("Tags.")&&n.push(e.slice(5));return n.sort(),r?Le(".tags",n.map(e=>Le("span.tag",e,Le("button",{onclick:r=>{r.target.disabled=!0;const n=t["DeviceID.ID"].value[0];ne(n,{[e]:!1}).then(()=>{r.target.disabled=!1,N("success",`${n}: Tags updated`),te(0,Date.now())}).catch(e=>{r.target.disabled=!1,N("error",`${n}: ${e.message}`)})}},ve("remove")))),Le("span.tag.writable",Le.trust("&nbsp;"),Le("button",{onclick:e=>{e.target.disabled=!0;const r=t["DeviceID.ID"].value[0],n=prompt("Enter tag to assign to device:");n?ne(r,{[n]:!0}).then(()=>{e.target.disabled=!1,N("success",`${r}: Tags updated`),te(0,Date.now())}).catch(t=>{e.target.disabled=!1,N("error",`${r}: ${t.message}`)}):e.target.disabled=!1}},ve("add")))):Le(".tags",n.map(e=>Le("span.tag",e)))}}),ping:e=>{let t,r;const n=async()=>{let t="";if(r)try{const e=await function(e){return K({url:`/api/ping/${encodeURIComponent(e)}`,background:!0})}(r);t=null!=e.avg?`${Math.trunc(e.avg)} ms`:"Unreachable"}catch(e){setTimeout(()=>{throw e},0)}const n=e.dom;n&&(n.innerHTML=`Pinging ${r}: ${t}`)};return{onremove:()=>{clearInterval(t)},view:e=>{const o=e.attrs.device;let i,s=o["InternetGatewayDevice.ManagementServer.ConnectionRequestURL"];return s||(s=o["Device.ManagementServer.ConnectionRequestURL"]),s&&s.value&&(i=new URL(s.value[0]).hostname),r!==i&&(r=i,clearInterval(t),r&&(n(),t=setInterval(n,3e3))),Le("div",`Pinging ${r}:`)}}},"device-link":()=>({view:e=>{let t;e.attrs.device&&(t=e.attrs.device["DeviceID.ID"].value[0]);const r=Object.values(e.attrs.components).map(t=>{if("object"!=typeof t)return`${t}`;const r=Object.assign({},e.attrs,t);return Le(r.type,r)});return t?Le("a",{href:`#!/devices/${encodeURIComponent(t)}`},r):r}}),"long-text":()=>({view:e=>{const t=e.attrs.text,r=e.attrs.element||"span";function n(e){e.dom.classList.add("long-text-overflowed"),e.dom.onclick=e=>{xe(()=>o()("textarea.long-text",{value:t,cols:80,rows:24,readonly:"",oncreate:e=>{e.dom.focus(),e.dom.select()}})),e.stopPropagation(),o.a.redraw()}}return o()(r,{oncreate:e=>{e.dom.clientWidth!==e.dom.scrollWidth&&n(e)},onupdate:e=>{e.dom.clientWidth===e.dom.scrollWidth?(e.dom.classList.remove("long-text-overflowed"),e.dom.onclick=null):n(e)},class:"long-text",title:t},t)}})},Ne=new WeakMap,_e=new WeakMap,Le=new Proxy(o.a,{apply:(e,t,r)=>{const n=r[0];return"string"!=typeof n?r[0]=ze(n):Re[n]&&(r[0]=ze(Re[n])),Reflect.apply(e,void 0,r)},get:(e,t)=>"context"===t?Me:Reflect.get(e,t)});function Me(e,...t){const r=Reflect.apply(Le,void 0,t);return _e.set(r,e),r}function Ue(e,t){if(Array.isArray(e))for(const r of e)Ue(r,t);else if(e&&"object"==typeof e&&e.tag){const r=Object.assign({},t,_e.get(e));if("string"!=typeof e.tag&&(_e.set(e,r),e.attrs=Object.assign({},r,e.attrs)),e.children&&e.children.length)for(const t of e.children)Ue(t,r)}}function ze(e){let t=Ne.get(e);if(!t){if("function"!=typeof e){t=Object.assign({},e);const r=e.view;t.view=function(e){const t=_e.get(e)||{},n=Reflect.apply(r,this,[e]);return Ue(n,t),n}}else{if(e.prototype&&e.prototype.view)throw new Error("Class components not supported");t=t=>{const r=e(t),n=r.view;return r.view=function(e){const t=_e.get(e)||{},r=Reflect.apply(n,this,[e]);return Ue(r,t),r},r}}Ne.set(e,t)}return t}const Be=()=>({view:e=>{const t=e.attrs.onPasswordChange,r=!e.attrs.noAuth,n=e.attrs.username;n&&(e.state.username=n);const o=[Le("p",Le("label",{for:"username"},"Username"),Le("input",{name:"username",type:"text",value:e.state.username,disabled:!!n,oninput:t=>{e.state.username=t.target.value},oncreate:e=>{e.dom.focus()}}))];let i={newPassword:"New password",confirmPassword:"Confirm password"};r&&(i=Object.assign({authPassword:"Your password"},i));for(const[t,r]of Object.entries(i))o.push(Le("p",Le("label",{for:t},r),Le("input",{name:t,type:"password",value:e.state[t],oninput:r=>{e.state[t]=r.target.value}})));const s=Le("button.primary",{type:"submit"},"Change password");o.push(Le(".actions-bar",s));const a=[Le("h1","Change password"),Le("form",{onsubmit:n=>{n.redraw=!1,n.preventDefault(),!e.state.username||!e.state.newPassword||r&&!e.state.authPassword?N("error","Please fill all fields"):e.state.newPassword!==e.state.confirmPassword?N("error","Password confirm doesn't match new password"):(s.dom.disabled=!0,le(e.state.username,e.state.newPassword,e.state.authPassword).then(()=>{N("success","Password updated successfully"),t&&t(),s.dom.disabled=!1}).catch(e=>{N("error",e.message),s.dom.disabled=!1}))}},o)];return Le("div.put-form",a)}});const Fe=Object.freeze({init:function(e){return Promise.resolve(e)},component:()=>({view:e=>(window.username&&Le.route.set(e.attrs.continue||"/"),document.title="Login - GenieACS",[Le("h1","Log in"),Le("form",Le("p",Le("label",{for:"username"},"Username"),Le("input",{name:"username",type:"text",value:e.state.username,oncreate:e=>{e.dom.focus()},oninput:t=>{e.state.username=t.target.value}})),Le("p",Le("label",{for:"password"},"Password"),Le("input",{name:"password",type:"password",value:e.state.password,oninput:t=>{e.state.password=t.target.value}})),Le("p",Le("button.primary",{type:"submit",onclick:t=>(t.target.disabled=!0,function(e,t){return K({method:"POST",url:"/login",background:!0,body:{username:e,password:t}})}(e.state.username,e.state.password).then(()=>{location.reload()}).catch(e=>{N("error",e.message),t.target.disabled=!1}),!1)},"Login"))),Le("a",{onclick:()=>{const e=()=>{const t={onPasswordChange:()=>{je(e),Le.redraw()}};return Le(Be,t)};xe(e)}},"Change password")])})}),Ye=T(d);const We=()=>({view:e=>(function(e){const t=e.slices,r=Array.from(Object.values(e.slices)).reduce((e,t)=>e+(t.count.value||0),0),n=[],o=[],i=[];let s,a,l=0,c=100*Math.cos(2*Math.PI*l),u=100*Math.sin(2*Math.PI*l);for(const e of Object.values(t)){const t=r>0?(e.count.value||0)/r:0;if(n.push(Le(".legend-line",[Le("span.color",{style:`background-color: ${e.color} !important;`}),`${e.label}: `,Le("a",{href:`/#!/devices/?${Le.buildQueryString({filter:Ye(e.filter)})}`},e.count.value||0),` (${(100*t).toFixed(2)}%)`])),t>0){l+=t;const r=`M ${c} ${u} `+`A 100 100 0 ${t>.5?1:0} 1 ${s=100*Math.cos(2*Math.PI*l)} ${a=100*Math.sin(2*Math.PI*l)} `+"L 0 0 z";c=s,u=a,o.push(Le("path",{d:r,fill:e.color}));const n=50*Math.cos(2*Math.PI*(l-t/2)),f=50*Math.sin(2*Math.PI*(l-t/2));i.push(Le("a",{"xlink:href":`/#!/devices/?${Le.buildQueryString({filter:Ye(e.filter)})}`},[Le("path",{d:r,"fill-opacity":0}),Le("text",{x:n,y:f,"dominant-baseline":"middle","text-anchor":"middle"},`${(100*t).toFixed(2)}%`)]))}}return n.push(Le("span.legend-total",`Total: ${r}`)),Le("div",{class:"pie-chart"},[Le("svg",{viewBox:"-102 -102 204 204",width:"204px",height:"204px",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},o.concat(i)),Le(".legend",n)])})(e.attrs.chart)}),Ve=L.ui.overview.groups||{},qe={};for(const e of Object.values(Ve))for(const t of Object.values(e.charts))qe[t]=L.ui.overview.charts[t];function Je(e){e=Object.assign({},e);for(let[t,r]of Object.entries(e)){e[t]=r=Object.assign({},r),r.slices=Object.assign({},r.slices);for(let[e,t]of Object.entries(r.slices)){const n=t.filter;r.slices[e]=t=Object.assign({},t),t.count=G("devices",n)}}return e}const He=Object.freeze({init:function(){return window.authorizer.hasAccess("devices",1)?Promise.resolve({charts:Je(qe)}):Promise.reject(new Error("You are not authorized to view this page"))},component:()=>({view:e=>{document.title="Overview - GenieACS";const t=[];for(const r of Object.values(Ve)){r.label&&t.push(Le("h1",r.label));const n=[];for(const t of Object.values(r.charts)){const r=e.attrs.charts[t],o=[];r.label&&o.push(Le("h2",r.label));const i={};i.chart=r,o.push(Le(We,i)),n.push(Le(".overview-chart",o))}t.push(Le(".overview-chart-group",n))}return t}})});const Ke=()=>{let e=new Set;return{view:t=>{const r=t.attrs.attributes,n=t.attrs.data,o=t.attrs.valueCallback,i=t.attrs.total,s=t.attrs.showMoreCallback,a=t.attrs.sortAttributes,l=t.attrs.onSortChange,c=t.attrs.downloadUrl,u=t.attrs.actionsCallback,f=t.attrs.recordActionsCallback,d=new Set;for(const t of n){const r=t._id||t["DeviceID.ID"].value[0];e.has(r)&&d.add(r)}return function(e,t,r,n,o,i,s,a,l,c,u){const f=t||[];let d=[];"function"==typeof c?(d=c(o),Array.isArray(d)||(d=[d])):Array.isArray(c)&&(d=c);const h=[];if(d.length){const e=Le("input",{type:"checkbox",checked:f.length&&o.size===f.length,onchange:e=>{for(const t of f){const r=t._id||t["DeviceID.ID"].value[0];e.target.checked?o.add(r):o.delete(r)}},disabled:!r});h.push(Le("th",e))}for(let t=0;t<e.length;t++){const r=e[t].label;if(!i.hasOwnProperty(t)){h.push(Le("th",r));continue}let n=1,o=ve("unsorted");i[t]>0?o=ve("sorted-asc"):i[t]<0&&(o=ve("sorted-dsc"));const a=Le("button",{onclick:()=>(i[t]>0&&(n*=-1),s({[t]:n}))},o);h.push(Le("th",[r,a]))}const p=[];for(const t of f){const r=t._id||t["DeviceID.ID"].value[0],n=[];if(d.length){const e=Le("input",{type:"checkbox",checked:o.has(r),onchange:e=>{e.target.checked?o.add(r):o.delete(r)},onclick:e=>{e.stopPropagation(),e.redraw=!1}});n.push(Le("td",e))}for(const r of e){const e={};let o;if("function"==typeof l)o=l(r,t);else if("code"===r.type){const n=t[r.id].split("\n",11);n.length>10&&(n[10]=["︙"]),null==e.title&&(e.title=n.join("\n")),o=n[0]||""}else o=t[r.id];n.push(Le("td",e,o))}let i=[];"function"==typeof u?(i=u(t),Array.isArray(i)||(i=[i])):Array.isArray(u)&&(i=u);for(const e of i)n.push(Le("td.table-row-links",e));p.push(Le("tr",{onclick:e=>{["INPUT","BUTTON","A"].includes(e.target.nodeName)?e.redraw=!1:o.delete(r)||o.add(r)}},n))}p.length||p.push(Le("tr.empty",Le("td",{colspan:h.length},"No records")));const m=[];null!=r?m.push(`${f.length}/${r}`):m.push(`${f.length}`),m.push(Le("button",{title:"Show more records",onclick:n,disabled:!t.length||f.length>=r},"More")),a&&m.push(Le("a.download-csv",{href:a,download:""},"Download"));const g=Le("tfoot",Le("tr",Le("td",{colspan:h.length},m))),v=[Le("table.table.highlight",Le("thead",Le("tr",h)),Le("tbody",p),g)];return d.length&&v.push(Le("div.actions-bar",d)),v}(r,n,i,s,e=d,a,l,c,o,u,f)}}};class Qe{constructor(e,t){this.callback=t,this.element=null,this.hideTimeout=null,this.visible=!1,this.default=null,this.selection=null,this.container=document.createElement("div"),this.container.style.position="absolute",this.container.style.display="block",this.container.style.opacity="0",this.container.className=e}attach(e){e.setAttribute("autocomplete","off"),e.addEventListener("focus",()=>{this.element=e;const t=e.getBoundingClientRect();this.container.style.left=`${t.left+window.pageXOffset}px`,this.container.style.width=`${t.width}px`,this.container.style.top=`${t.bottom+window.pageYOffset}px`,this.update()}),e.addEventListener("blur",()=>{this.element===e&&this.visible&&this.hide()}),e.addEventListener("keydown",t=>{this.element===e&&("Escape"===t.key?this.visible&&this.hide():"Enter"===t.key?null!=this.default&&(e.value=this.default,t.preventDefault(),this.update()):"ArrowDown"===t.key?(t.preventDefault(),null==this.selection?this.selection=0:++this.selection,this.update()):"ArrowUp"===t.key&&(t.preventDefault(),--this.selection,this.update()))}),e.addEventListener("input",()=>{this.element===e&&(this.selection=null,this.update())})}hide(){this.container.style.opacity="0",this.visible=!1,this.default=null,this.selection=null,clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(()=>{for(this.hideTimeout=null;this.container.firstChild;)this.container.removeChild(this.container.firstChild);document.body.removeChild(this.container)},500)}update(){const e=this.element;this.callback(e.value,t=>{if(this.element!==e)return;if(this.default=null,!t.length)return void(this.visible&&this.hide());for(;this.container.firstChild;)this.container.removeChild(this.container.firstChild);let r;this.visible||(this.hideTimeout?(clearTimeout(this.hideTimeout),this.hideTimeout=null):(document.body.appendChild(this.container),window.getComputedStyle(this.container).opacity),this.container.style.opacity="1",this.visible=!0),null!=this.selection?(this.selection=(this.selection%t.length+t.length)%t.length,this.default=t[this.selection].value):this.default=t[0].value;for(const[n,o]of t.entries()){const t=document.createElement("div");o.tip&&(t.title=o.tip),t.classList.add("suggestion"),n===this.selection&&(t.classList.add("selected"),r=t);const i=document.createTextNode(o.value);t.appendChild(i),t.addEventListener("mousedown",t=>{t.preventDefault(),e.value=o.value,this.element===e&&this.update()}),this.container.appendChild(t)}r&&(this.container.scrollTop=Math.min(this.container.scrollTop,r.offsetTop),this.container.scrollTop=Math.max(this.container.scrollTop,r.offsetTop+r.scrollHeight-this.container.clientHeight))})}}const Ge={devices:{},faults:{Device:{parameter:["PARAM","device"],type:"string"},Channel:{parameter:["PARAM","channel"],type:"string"},Code:{parameter:["PARAM","code"],type:"string"},Retries:{parameter:["PARAM","retries"],type:"number"},Timestamp:{parameter:["PARAM","timestamp"],type:"timestamp"}},presets:{ID:{parameter:["PARAM","_id"],type:"string"},Channel:{parameter:["PARAM","channel"],type:"string"},Weight:{parameter:["PARAM","weight"],type:"number"}},provisions:{ID:{parameter:["PARAM","_id"],type:"string"}},virtualParameters:{ID:{parameter:["PARAM","_id"],type:"string"}},files:{ID:{parameter:["PARAM","_id"],type:"string"},Type:{parameter:["PARAM","metadata.fileType"],type:"string"},OUI:{parameter:["PARAM","metadata.oui"],type:"string"},"Product class":{parameter:["PARAM","metadata.productClass"],type:"string"},Version:{parameter:["PARAM","metadata.version"],type:"string"}},permissions:{Role:{parameter:["PARAM","role"],type:"string"},Resource:{parameter:["PARAM","resource"],type:"string"},Access:{parameter:["PARAM","access"],type:"number"}},users:{Username:{parameter:["PARAM","_id"],type:"string"}}};for(const e of Object.values(L.ui.filters))Ge.devices[e.label]={parameter:e.parameter,type:(e.type||"").split(",").map(e=>e.trim())};function Ze(e,t){let r;if(Ge[e]&&Ge[e][t]){const n=Ge[e][t],o="devices"===e?n.type:n.type.split(","),i=[];for(const e of o)switch(e.trim()){case"string":i.push("case insensitive string pattern");break;case"number":i.push("numeric value");break;case"timestamp":i.push("Unix timestamp or string in the form YYYY-MM-DDTHH:mm:ss.sssZ");break;case"mac":i.push("partial case insensitive MAC address");break;case"tag":i.push("case sensitive string")}i.length&&(r=`${t}: ${i.join(", ")}`)}return r}function Xe(e,t,r){if(!Ge[e])return null;const n=Ge[e][t].type;r=r.trim();const o=["OR"];if(0===n.length||n.includes("number")){const n=function(e,t){let r="=";for(const e of["<>","=","<=","<",">=",">"])if(t.startsWith(e)){r=e,t=t.slice(e.length).trim();break}const n=parseInt(t);return n!==+t?null:[r,e,n]}(Ge[e][t].parameter,r);n&&o.push(n)}if(0===n.length||n.includes("string")){const n=function(e,t){return["LIKE",["FUNC","LOWER",e],t.toLowerCase()]}(Ge[e][t].parameter,r);n&&o.push(n)}if(0===n.length||n.includes("timestamp")){const n=function(e,t){let r="=";for(const e of["<>","=","<=","<",">=",">"])if(t.startsWith(e)){r=e,t=t.slice(e.length).trim();break}let n=parseInt(t);return n!==+t&&(n=Date.parse(t)),isNaN(n)?null:[r,e,n]}(Ge[e][t].parameter,r);n&&o.push(n)}if(n.includes("mac")){const n=function(e,t){return(t=t.replace(/[^a-f0-9]/gi,"").toLowerCase())?12===t.length?["LIKE",["FUNC","LOWER",e],t.replace(/(..)(?!$)/g,"$1:")]:["OR",["LIKE",["FUNC","LOWER",e],`%${t.replace(/(..)(?!$)/g,"$1:")}%`],["LIKE",["FUNC","LOWER",e],`%${t.replace(/(.)(.)/g,"$1:$2")}%`]]:null}(Ge[e][t].parameter,r);n&&o.push(n)}if(n.includes("tag")){const e=["IS NOT NULL",["PARAM",`Tags.${r.replace(/[^a-zA-Z0-9-]+/g,"_")}`]];e&&o.push(e)}return o.length<=1?null:2===o.length?o[1]:o}const et=Array.isArray;const tt=T(e=>{const t=function(e){return Ge[e]?Object.keys(Ge[e]):[]}(e);return new Qe("autocomplete",(r,n)=>{r=r.toLowerCase(),n(t.filter(e=>e.toLowerCase().includes(r)).map(t=>({value:`${t}: `,tip:Ze(e,t)})))})});function rt(e,t){let r;if(/^[\s0-9a-zA-Z]+:/.test(t)){const e=t.split(":",1)[0],n=t.slice(e.length+1).trim();r=["FUNC","Q",e.trim(),n]}else r=f(t);return function(e){const t={OR:0,AND:0,NOT:0,"=":1,"<>":1,">":1,">=":1,"<":1,"<=":1,LIKE:1,"NOT LIKE":1,"IS NULL":1,"IS NOT NULL":1},r=E(e,null,Date.now());if(!et(r)){if(!0===r)return{};throw new Error("Primitives are not valid queries")}(function e(r,n,o={}){const i=r[0];if(0===t[i]){for(let e=1;e<r.length;++e)if(!et(r[e])||null==t[r[e][0]])throw new Error(`Invalid expression in ${i} clause`);if(!n&&"AND"===i||n&&"OR"===i){o.$and=o.$and||[];for(let t=1;t<r.length;++t)o.$and.push(e(r[t],n))}else if(!n&&"OR"===i||n&&"AND"===i){o.$or=o.$or||[];for(let t=1;t<r.length;++t)o.$or.push(e(r[t],n))}else"NOT"===i&&e(r[1],!n,o)}else{if(1!==t[i])throw new Error(`Unrecognized operator ${i}`);if(et(r[2]))throw new Error(`Right operand of ${i} clause is not a primitive`);if(["LIKE","NOT LIKE"].includes(i)&&et(r[1])&&"FUNC"===r[1][0]&&["UPPER","LOWER"].includes(r[1][1])){if("UPPER"===r[1][1]&&r[2]!==r[2].toUpperCase()||"LOWER"===r[1][1]&&r[2]!==r[2].toLowerCase())throw new Error(`Cannot compare ${r[1][1]}() against non-${r[1][1].toLowerCase()}case pattern`)}else if(!et(r[1])||"PARAM"!==r[1][0])throw new Error(`Left operand of ${i} clause is not a parameter`);if("="===i){const e=r[1][1],t=o[e]=o[e]||{};n?t.$ne=r[2]:t.$eq=r[2]}else if("<>"===i){const e=r[1][1];let t=o[e]=o[e]||{};n&&(t=t.$not=t.$not||{}),t.$ne=r[2],"_tags"!==e&&(t.$exists=!0)}else if(">"===i){const e=r[1][1];let t=o[e]=o[e]||{};n&&(t=t.$not=t.$not||{}),t.$gt=r[2]}else if(">="===i){const e=r[1][1];let t=o[e]=o[e]||{};n&&(t=t.$not=t.$not||{}),t.$gte=r[2]}else if("<"===i){const e=r[1][1];let t=o[e]=o[e]||{};n&&(t=t.$not=t.$not||{}),t.$lt=r[2]}else if("<="===i){const e=r[1][1];let t=o[e]=o[e]||{};n&&(t=t.$not=t.$not||{}),t.$lte=r[2]}else if("IS NULL"===i)o[r[1][1]]={$exists:n};else if("IS NOT NULL"===i)o[r[1][1]]={$exists:!n};else{let e,t;"NOT LIKE"===i&&(n=!n),"FUNC"===r[1][0]&&"UPPER"===r[1][1]?(e=r[1][2][1],t="i"):"FUNC"===r[1][0]&&"LOWER"===r[1][1]?(e=r[1][2][1],t="i"):(e=r[1][1],t="");const s=O(r[2],r[3],t);o[e]=n?{$not:s}:s}}return o})(r,!1)}(l(r,t=>Array.isArray(t)&&"FUNC"===t[0]&&"Q"===t[1]?Xe(e,t[2],t[3]):t)),r}function nt(e){return Array.isArray(e)&&"FUNC"===e[0]&&"Q"===e[1]?`${e[2]}: ${e[3]}`:d(e)}const ot=T(e=>{if(!e)return[""];const t=[],r=f(e);if(Array.isArray(r)&&"AND"===r[0])for(const e of r.slice(1))t.push(nt(e));else t.push(nt(r));return t.push(""),t}),it=()=>({view:e=>{return e.state.filterList&&e.attrs.filter===e.state.filter||(e.state.filterInvalid=0,e.state.filter=e.attrs.filter,e.state.filterList=ot(e.attrs.filter)),o()("div.filter",[o()("b","Filter")].concat(e.state.filterList.map((t,r)=>o()("input",{type:"text",class:`${e.state.filterInvalid>>r&1?"error":""}`,value:t,onchange:t=>{e.state.filterList=e.state.filterList.slice(),e.state.filterList[r]=t.target.value.trim(),function(){e.state.filterInvalid=0,e.state.filterList=e.state.filterList.filter(e=>e);let t=e.state.filterList.map((t,r)=>{try{return rt(e.attrs.resource,t)}catch(t){e.state.filterInvalid|=1<<r}return null});e.state.filterList.push(""),e.state.filterInvalid||(delete e.state.filter,0===t.length?e.attrs.onChange(""):(t=t.length>1?["AND"].concat(t):t[0],e.attrs.onChange(d(t))))}()},oncreate:t=>{tt(e.attrs.resource).attach(t.dom)}}))))}}),st=L.ui.pageSize||10,at=T(f),lt=T(JSON.parse),ct=T(e=>{const t=function(e){const t=new Set;return l(e,e=>(w(e)&&"PARAM"===e[0]&&t.add(e[1]),e)),Array.from(t)}(e);if(1===t.length){const e=E(t[0]);if("string"==typeof e)return e}return null}),ut=T((e,t)=>{const r={};for(const e of t)r[e.label]=d(e.parameter);return`/api/devices.csv?${Le.buildQueryString({filter:d(e),columns:JSON.stringify(r)})}`}),ft=T(e=>l(e,e=>Array.isArray(e)&&"FUNC"===e[0]&&"Q"===e[1]?Xe("devices",e[2],e[3]):e));function dt(e){const t=[];return t.push(Le("button.primary",{title:"Reboot selected devices",disabled:!e.size,onclick:()=>{for(const t of e)fe({name:"reboot",device:t})}},"Reboot")),t.push(Le("button.critical",{title:"Factory reset selected devices",disabled:!e.size,onclick:()=>{for(const t of e)fe({name:"factoryReset",device:t})}},"Reset")),t.push(Le("button.primary",{title:"Delete selected devices",disabled:!e.size,onclick:()=>{const t=Array.from(e);if(!confirm(`Deleting ${t.length} devices. Are you sure?`))return;let r=1;for(const e of t)++r,oe("devices",e).then(()=>{N("success",`${e}: Deleted`),0==--r&&te(0,Date.now())}).catch(t=>{N("error",`${e}: ${t.message}`),0==--r&&te(0,Date.now())});0==--r&&te(0,Date.now())}},"Delete")),t.push(Le("button.primary",{title:"Tag selected devices",disabled:!e.size,onclick:()=>{const t=Array.from(e),r=prompt(`Enter tag to assign to ${t.length} devices:`);if(!r)return;let n=1;for(const e of t)++n,ne(e,{[r]:!0}).then(()=>{N("success",`${e}: Tags updated`),0==--n&&te(0,Date.now())}).catch(t=>{N("error",`${e}: ${t.message}`),0==--n&&te(0,Date.now())});0==--n&&te(0,Date.now())}},"Tag")),t.push(Le("button.primary",{title:"Untag selected devices",disabled:!e.size,onclick:()=>{const t=Array.from(e),r=prompt(`Enter tag to unassign from ${t.length} devices:`);if(!r)return;let n=1;for(const e of t)++n,ne(e,{[r]:!1}).then(()=>{N("success",`${e}: Tags updated`),0==--n&&te(0,Date.now())}).catch(t=>{N("error",`${e}: ${t.message}`),0==--n&&te(0,Date.now())});0==--n&&te(0,Date.now())}},"Untag")),t}const ht=Object.freeze({init:function(e){return new Promise((t,r)=>{if(!window.authorizer.hasAccess("devices",2))return void r(new Error("You are not authorized to view this page"));const n=e.hasOwnProperty("filter")?""+e.filter:"",o=e.hasOwnProperty("sort")?""+e.sort:"",i=Object.values(L.ui.index);i.length||i.push({label:"ID",parameter:["PARAM","DeviceID.ID"]}),t({filter:n,indexParameters:i,sort:o})})},component:()=>({view:e=>{document.title="Devices - GenieACS";const t=e.attrs.indexParameters,r=e.attrs.sort?lt(e.attrs.sort):{},n={};for(let e=0;e<t.length;e++){const o=t[e];if(o.unsortable)continue;const i=ct(o.parameter);i&&(n[e]=r[i]||0)}let o=!e.attrs.filter||at(e.attrs.filter);const i=ee("devices",o=ft(o),{limit:e.state.showCount||st,sort:r}),s=G("devices",o),a=ut(o,t),l={};l.attributes=t,l.data=i.value,l.total=s.value,l.showMoreCallback=function(){e.state.showCount=(e.state.showCount||st)+st,Le.redraw()},l.sortAttributes=n,l.onSortChange=function(n){const o=Object.assign({},r);for(const[e,r]of Object.entries(n)){const n=ct(t[e].parameter);n&&(delete o[n],o[n]=r)}const i={sort:JSON.stringify(o)};e.attrs.filter&&(i.filter=e.attrs.filter),Le.route.set("/devices",i)},l.downloadUrl=a,l.valueCallback=(e,t)=>Le.context({device:t,parameter:e.parameter},e.type||"parameter",e),l.recordActionsCallback=e=>Le("a",{href:`#!/devices/${encodeURIComponent(e["DeviceID.ID"].value[0])}`},"Show"),window.authorizer.hasAccess("devices",3)&&(l.actionsCallback=dt);const c={resource:"devices"};return c.filter=e.attrs.filter,c.onChange=function(t){const r={filter:t};e.attrs.sort&&(r.sort=e.attrs.sort),Le.route.set("/devices",r)},[Le("h1","Listing devices"),Le(it,c),Le(Ke,l)]}})});const pt=Object.freeze({init:function(e){return window.authorizer.hasAccess("devices",2)?Promise.resolve({deviceId:e.id,deviceFilter:["=",["PARAM","DeviceID.ID"],e.id]}):Promise.reject(new Error("You are not authorized to view this page"))},component:()=>({view:e=>{document.title=`${e.attrs.deviceId} - Devices - GenieACS`;const t=ee("devices",e.attrs.deviceFilter).value;if(!t.length)return"Loading";const r=L.ui.device,n=[];for(const e of Object.values(r))n.push(Le.context({device:t[0]},e.type,e));return[Le("h1",e.attrs.deviceId),n]}})}),mt=()=>({view:function(e){return document.title="Error! - GenieACS",Le("p.error",e.attrs.error)}});let gt,vt,wt;function yt(){wt||(wt=N("error","Error loading JS resource, please reload the page",{Reload:()=>{window.location.reload()}}))}function bt(){return gt?Promise.resolve():new Promise((e,t)=>{const n=[r.e(1).then(r.t.bind(null,33,7)),r.e(1).then(r.t.bind(null,34,7)),r.e(1).then(r.t.bind(null,35,7))];Promise.all(n).then(t=>{gt=t[0],e()}).catch(e=>{yt(),t(e)})})}function At(){return vt?Promise.resolve():new Promise((e,t)=>{r.e(2).then(r.t.bind(null,36,7)).then(t=>{vt=t,e()}).catch(e=>{yt(),t(e)})})}const Ot=L.ui.pageSize||10,Et=T(f),Pt=T(JSON.parse),xt=[{id:"device",label:"Device"},{id:"channel",label:"Channel"},{id:"code",label:"Code"},{id:"message",label:"Message"},{id:"detail",label:"Detail"},{id:"retries",label:"Retries"},{id:"timestamp",label:"Timestamp"}],jt=T(e=>{const t={};for(const e of xt)t[e.label]="timestamp"===e.id?`DATE_STRING(${e.id})`:e.id;return`/api/faults.csv?${Le.buildQueryString({filter:d(e),columns:JSON.stringify(t)})}`}),kt=T(e=>l(e,e=>Array.isArray(e)&&"FUNC"===e[0]&&"Q"===e[1]?Xe("faults",e[2],e[3]):e));const St=Object.freeze({init:function(e){if(!window.authorizer.hasAccess("faults",2))return Promise.reject(new Error("You are not authorized to view this page"));const t=e.hasOwnProperty("sort")?""+e.sort:"",r=e.hasOwnProperty("filter")?""+e.filter:"";return new Promise((e,n)=>{At().then(()=>{e({filter:r,sort:t})}).catch(n)})},component:()=>({view:e=>{document.title="Faults - GenieACS";const t=e.attrs.sort?Pt(e.attrs.sort):{},r={};for(let e=0;e<xt.length;e++){const n=xt[e];"detail"!==n.id&&(r[e]=t[n.id]||0)}let n=!e.attrs.filter||Et(e.attrs.filter);const o=ee("faults",n=kt(n),{limit:e.state.showCount||Ot,sort:t}),i=G("faults",n),s=jt(n),a={};a.attributes=xt,a.data=o.value,a.valueCallback=(e,t)=>{if("device"===e.id){const e=`#!/devices/${encodeURIComponent(t.device)}`;return Le("a",{href:e},t.device)}return"detail"===e.id?Le("long-text",{text:vt.stringify(t.detail)}):"timestamp"===e.id?new Date(t.timestamp).toLocaleString():t[e.id]},a.total=i.value,a.showMoreCallback=function(){e.state.showCount=(e.state.showCount||Ot)+Ot,Le.redraw()},a.sortAttributes=r,a.onSortChange=function(r){const n=Object.assign({},t);for(const[e,t]of Object.entries(r))delete n[xt[e].id],n[xt[e].id]=t;const o={sort:JSON.stringify(n)};e.attrs.filter&&(o.filter=e.attrs.filter),Le.route.set("/faults",o)},a.downloadUrl=s,window.authorizer.hasAccess("faults",3)&&(a.actionsCallback=e=>Le("button.primary",{disabled:0===e.size,title:"Delete selected faults",onclick:t=>{t.redraw=!1,t.target.disabled=!0,confirm(`Deleting ${e.size} faults. Are you sure?`)&&Promise.all(Array.from(e).map(e=>oe("faults",e))).then(e=>{N("success",`${e.length} faults deleted`),te(0,Date.now())}).catch(e=>{N("error",e.message),te(0,Date.now())})}},"Delete"));const l={resource:"faults"};return l.filter=e.attrs.filter,l.onChange=function(t){const r={filter:t};e.attrs.sort&&(r.sort=e.attrs.sort),Le.route.set("/faults",r)},[Le("h1","Listing faults"),Le(it,l),Le(Ke,a)]}})}),Ct=()=>({view:e=>Le("textarea",{name:e.attrs.id,value:e.attrs.value,oncreate:t=>{const r=gt.fromTextArea(t.dom,{mode:e.attrs.mode,lineNumbers:!0,readOnly:e.attrs.readOnly,extraKeys:{"Ctrl-Enter":()=>{e.attrs.onSubmit&&e.attrs.onSubmit(t.dom)},"Cmd-Enter":()=>{e.attrs.onSubmit&&e.attrs.onSubmit(t.dom)}}});e.attrs.onChange&&r.on("change",t=>{e.attrs.onChange(t.getValue())}),e.attrs.focus&&r.focus(),e.attrs.onReady&&e.attrs.onReady(r)}})}),$t={presets:"preset",provisions:"provision",virtualParameters:"virtual parameter",files:"file",users:"user",permissions:"permission"};function Dt(e,t,r){if("combo"===t.type){let n="",o=t.options;null!=e.object[t.id]&&(o.includes(e.object[t.id])||(o=o.concat([e.object[t.id]])),n=e.object[t.id]);const i=[Le("option",{value:""},"")];for(const e of o)i.push(Le("option",{value:e},e));return Le("select",{name:t.id,value:n,oncreate:r?e=>{e.dom.focus()}:null,onchange:r=>{e.object[t.id]=r.target.value,r.redraw=!1}},i)}if("multi"===t.type){const n=Array.from(new Set(t.options.concat(e.object[t.id]||[]))),o=new Set(e.object[t.id]),i=n.map(n=>{const s=`${t.id}-${n}`;return Le("tr",[Le("td",Le("input",{type:"checkbox",id:s,value:n,oncreate:e=>{r&&!i.length&&e.dom.focus(),o.has(n)&&(e.dom.checked=!0)},onchange:r=>{r.target.checked?o.add(n):o.delete(n),e.object[t.id]=Array.from(o),r.redraw=!1}})),Le("td",n)])});return Le("table",i)}if("code"===t.type){const r={id:t.id,value:e.object[t.id],mode:"javascript",onSubmit:e=>{e.form.querySelector("button[type=submit]").click()},onChange:r=>{e.object[t.id]=r}};return Le(Ct,r)}return"file"===t.type?Le("input",{type:"file",name:t.id,oncreate:r?e=>{e.dom.focus()}:null,onchange:r=>{e.object[t.id]=r.target.files,r.redraw=!1}}):"textarea"===t.type?Le("textarea",{name:t.id,value:e.object[t.id],readonly:"_id"===t.id&&!e.isNew,cols:t.cols||80,rows:t.rows||4,style:"resize: none;",oncreate:r?e=>{const t=e.dom;t.focus(),t.setSelectionRange(t.value.length,t.value.length)}:null,oninput:r=>{e.object[t.id]=r.target.value,r.redraw=!1},onkeypress:e=>{if(e.redraw=!1,13===e.which&&!e.shiftKey){return e.target.form.querySelector("button[type=submit]").click(),!1}return!0}}):Le("input",{type:"password"===t.type?"password":"text",name:t.id,disabled:"_id"===t.id&&!e.isNew,value:e.object[t.id],oncreate:r?e=>{e.dom.focus()}:null,oninput:r=>{e.object[t.id]=r.target.value,r.redraw=!1}})}const Tt=()=>({view:e=>{const t=e.attrs.actionHandler,r=e.attrs.attributes,n=e.attrs.resource,o=e.attrs.base||{};e.state.current||(e.state.current={isNew:!o._id,object:Object.assign({},o)});const i=e.state.current,s=[];let a=!1;for(const e of r){let t=!1;a||!i.isNew&&"_id"===e.id||(t=a=!0),s.push(Le("p",Le("label",{for:e.id},e.label||e.id),Le("br"),Dt(i,e,t)))}const l=Le("button.primary",{type:"submit"},"Save"),c=[l];i.isNew||c.push(Le("button.primary",{type:"button",title:`Delete ${$t[n]||n}`,onclick:e=>{e.redraw=!1,e.target.disabled=!0,t("delete",i.object).then(()=>{e.target.disabled=!1})}},"Delete")),s.push(Le(".actions-bar",c));const u=[Le("h1",`${i.isNew?"New":"Editing"} ${$t[n]||n}`),Le("form",{onsubmit:e=>{e.redraw=!1,e.preventDefault(),l.dom.disabled=!0,t("save",i.object).then(()=>{l.dom.disabled=!1})}},s)];return Le("div.put-form",u)}}),It=L.ui.pageSize||10,Rt=T(f),Nt=T(JSON.parse),_t=[{id:"_id",label:"Name"},{id:"channel",label:"Channel"},{id:"weight",label:"Weight"},{id:"schedule",label:"Schedule"},{id:"events",label:"Events"},{id:"precondition",label:"Precondition",type:"textarea"},{id:"provision",label:"Provision",type:"combo"},{id:"provisionArgs",label:"Arguments"}],Lt=T(e=>l(e,e=>Array.isArray(e)&&"FUNC"===e[0]&&"Q"===e[1]?Xe("presets",e[2],e[3]):e));function Mt(e,t,r){return new Promise((n,o)=>{const i=Object.assign({},t);if("save"===e){const e=i._id;delete i._id;const t={};if(e||(t._id="ID can not be empty"),i.provision||(t.provision="Provision not selected"),Object.keys(t).length)return void n(t);if(i.precondition)try{i.precondition=d(Rt(i.precondition))}catch(e){return void n({precondition:"Precondition must be valid expression"})}se("presets",e).then(t=>t&&r?(te(0,Date.now()),void n({_id:"Preset already exists"})):t||r?void ie("presets",e,i).then(()=>{N("success",`Preset ${t?"updated":"created"}`),te(0,Date.now()),n()}).catch(o):(te(0,Date.now()),void n({_id:"Preset does not exist"}))).catch(o)}else"delete"===e?oe("presets",i._id).then(()=>{N("success","Preset deleted"),te(0,Date.now()),n()}).catch(e=>{o(e),te(0,Date.now())}):o(new Error("Undefined action"))})}const Ut={resource:"presets",attributes:_t},zt=T(e=>{const t={};for(const e of _t)t[e.label]=e.id;return`/api/presets.csv?${Le.buildQueryString({filter:d(e),columns:JSON.stringify(t)})}`});const Bt=Object.freeze({init:function(e){if(!window.authorizer.hasAccess("presets",2))return Promise.reject(new Error("You are not authorized to view this page"));const t=e.hasOwnProperty("sort")?""+e.sort:"",r=e.hasOwnProperty("filter")?""+e.filter:"";return Promise.resolve({filter:r,sort:t})},component:()=>({view:e=>{document.title="Presets - GenieACS";const t=e.attrs.sort?Nt(e.attrs.sort):{},r={};for(let e=0;e<_t.length;e++){const n=_t[e];"events"!==n.id&&"precondition"!==n.id&&"provision"!==n.id&&"provisionArgs"!==n.id&&(r[e]=t[n.id]||0)}let n=!e.attrs.filter||Rt(e.attrs.filter);const o=ee("presets",n=Lt(n),{limit:e.state.showCount||It,sort:t}),i=G("presets",n),s=new Set,a=new Set(["refresh","value","tag","reboot","reset","download","instances"]),l=ee("provisions",!0);if(l.fulfilled)for(const e of l.value)s.add(e._id),a.add(e._id);_t.find(e=>"provision"===e.id).options=Array.from(a);const c=zt(n),u={};u.attributes=_t,u.data=o.value,u.total=i.value,u.showMoreCallback=function(){e.state.showCount=(e.state.showCount||It)+It,Le.redraw()},u.sortAttributes=r,u.onSortChange=function(r){const n=Object.assign({},t);for(const[e,t]of Object.entries(r))delete n[_t[e].id],n[_t[e].id]=t;const o={sort:JSON.stringify(n)};e.attrs.filter&&(o.filter=e.attrs.filter),Le.route.set("/admin/presets",o)},u.downloadUrl=c,u.valueCallback=(e,t)=>{if("precondition"===e.id){let e="/#!/devices";return t.precondition.length&&(e+=`?${Le.buildQueryString({filter:t.precondition})}`),Le("a",{href:e,title:t.precondition},t.precondition)}return"provision"===e.id&&s.has(t[e.id])?Le("a",{href:`/#!/admin/provisions?${Le.buildQueryString({filter:`Q("ID", "${t.provision}")`})}`},t.provision):t[e.id]},u.recordActionsCallback=e=>[Le("a",{onclick:()=>{const t=()=>e.provision?Le(Tt,Object.assign({base:e,actionHandler:(e,r)=>new Promise(n=>{Mt(e,r,!1).then(e=>{const r=e?Object.values(e):[];if(r.length)for(const e of r)N("error",e);else je(t);n()}).catch(e=>{N("error",e.message),n()})})},Ut)):Le("div",{style:"margin:20px"},"This UI only supports presets with a single 'provision' configuraiton. If this preset was originally created from the old UI (genieacs-gui), you must edit it there.");xe(t)}},"Show")],window.authorizer.hasAccess("presets",3)&&(u.actionsCallback=e=>[Le("button.primary",{title:"Create new preset",onclick:()=>{const e=()=>Le(Tt,Object.assign({actionHandler:(t,r)=>new Promise(n=>{Mt(t,r,!0).then(t=>{const r=t?Object.values(t):[];if(r.length)for(const e of r)N("error",e);else je(e);n()}).catch(e=>{N("error",e.message),n()})})},Ut));xe(e)}},"New"),Le("button.primary",{title:"Delete selected presets",disabled:!e.size,onclick:t=>{confirm(`Deleting ${e.size} presets. Are you sure?`)&&(t.redraw=!1,t.target.disabled=!0,Promise.all(Array.from(e).map(e=>oe("presets",e))).then(e=>{N("success",`${e.length} presets deleted`),te(0,Date.now())}).catch(e=>{N("error",e.message),te(0,Date.now())}))}},"Delete")]);const f={resource:"presets"};return f.filter=e.attrs.filter,f.onChange=function(t){const r={filter:t};e.attrs.sort&&(r.sort=e.attrs.sort),Le.route.set("/admin/presets",r)},[Le("h1","Listing presets"),Le(it,f),Le(Ke,u)]}})}),Ft=L.ui.pageSize||10,Yt=T(f),Wt=T(JSON.parse),Vt=[{id:"_id",label:"Name"},{id:"script",label:"Script",type:"code"}],qt=T(e=>l(e,e=>Array.isArray(e)&&"FUNC"===e[0]&&"Q"===e[1]?Xe("provisions",e[2],e[3]):e));function Jt(e,t,r){return new Promise((n,o)=>{const i=Object.assign({},t);if("save"===e){const e=i._id;if(delete i._id,!e)return void n({_id:"ID can not be empty"});se("provisions",e).then(t=>t&&r?(te(0,Date.now()),void n({_id:"Provision already exists"})):t||r?void ie("provisions",e,i).then(()=>{N("success",`Provision ${t?"updated":"created"}`),te(0,Date.now()),n()}).catch(o):(te(0,Date.now()),void n({_id:"Provision does not exist"}))).catch(o)}else"delete"===e?oe("provisions",i._id).then(()=>{N("success","Provision deleted"),te(0,Date.now()),n()}).catch(e=>{te(0,Date.now()),o(e)}):o(new Error("Undefined action"))})}const Ht={resource:"provisions",attributes:Vt},Kt=T(e=>{const t={};for(const e of Vt)t[e.label]=e.id;return`/api/provisions.csv?${Le.buildQueryString({filter:d(e),columns:JSON.stringify(t)})}`});const Qt=Object.freeze({init:function(e){if(!window.authorizer.hasAccess("provisions",2))return Promise.reject(new Error("You are not authorized to view this page"));const t=e.hasOwnProperty("sort")?""+e.sort:"",r=e.hasOwnProperty("filter")?""+e.filter:"";return new Promise((e,n)=>{bt().then(()=>{e({filter:r,sort:t})}).catch(n)})},component:()=>({view:e=>{document.title="Provisions - GenieACS";const t=e.attrs.sort?Wt(e.attrs.sort):{},r={};for(let e=0;e<Vt.length;e++)r[e]=t[Vt[e].id]||0;let n=!e.attrs.filter||Yt(e.attrs.filter);const o=ee("provisions",n=qt(n),{limit:e.state.showCount||Ft,sort:t}),i=G("provisions",n),s=Kt(n),a={};a.attributes=Vt,a.data=o.value,a.total=i.value,a.showMoreCallback=function(){e.state.showCount=(e.state.showCount||Ft)+Ft,Le.redraw()},a.sortAttributes=r,a.onSortChange=function(r){const n=Object.assign({},t);for(const[e,t]of Object.entries(r))delete n[Vt[e].id],n[Vt[e].id]=t;const o={sort:JSON.stringify(n)};e.attrs.filter&&(o.filter=e.attrs.filter),Le.route.set("/admin/provisions",o)},a.downloadUrl=s,a.recordActionsCallback=e=>[Le("a",{onclick:()=>{const t=()=>Le(Tt,Object.assign({base:e,actionHandler:(e,r)=>new Promise(n=>{Jt(e,r,!1).then(e=>{const r=e?Object.values(e):[];if(r.length)for(const e of r)N("error",e);else je(t);n()}).catch(e=>{N("error",e.message),n()})})},Ht));xe(t)}},"Show")],window.authorizer.hasAccess("provisions",3)&&(a.actionsCallback=e=>[Le("button.primary",{title:"Create new provision",onclick:()=>{const e=()=>Le(Tt,Object.assign({actionHandler:(t,r)=>new Promise(n=>{Jt(t,r,!0).then(t=>{const r=t?Object.values(t):[];if(r.length)for(const e of r)N("error",e);else je(e);n()}).catch(e=>{N("error",e.message),n()})})},Ht));xe(e)}},"New"),Le("button.primary",{title:"Delete selected provisions",disabled:!e.size,onclick:t=>{confirm(`Deleting ${e.size} provisions. Are you sure?`)&&(t.redraw=!1,t.target.disabled=!0,Promise.all(Array.from(e).map(e=>oe("provisions",e))).then(e=>{N("success",`${e.length} provisions deleted`),te(0,Date.now())}).catch(e=>{N("error",e.message),te(0,Date.now())}))}},"Delete")]);const l={resource:"provisions"};return l.filter=e.attrs.filter,l.onChange=function(t){const r={filter:t};e.attrs.sort&&(r.sort=e.attrs.sort),Le.route.set("/admin/provisions",r)},[Le("h1","Listing provisions"),Le(it,l),Le(Ke,a)]}})}),Gt=L.ui.pageSize||10,Zt=T(f),Xt=T(JSON.parse),er=[{id:"_id",label:"Name"},{id:"script",label:"Script",type:"code"}],tr=T(e=>l(e,e=>Array.isArray(e)&&"FUNC"===e[0]&&"Q"===e[1]?Xe("virtualParameters",e[2],e[3]):e));function rr(e,t,r){return new Promise((n,o)=>{const i=Object.assign({},t);if("save"===e){const e=i._id;if(delete i._id,!e)return void n({_id:"ID can not be empty"});se("virtualParameters",e).then(t=>t&&r?(te(0,Date.now()),void n({_id:"Virtual parameter already exists"})):t||r?void ie("virtualParameters",e,i).then(()=>{N("success",`Virtual parameter ${t?"updated":"created"}`),te(0,Date.now()),n()}).catch(o):(te(0,Date.now()),void n({_id:"Virtual parameter does not exist"}))).catch(o)}else"delete"===e?oe("virtualParameters",i._id).then(()=>{N("success","Virtual parameter deleted"),te(0,Date.now()),n()}).catch(e=>{te(0,Date.now()),o(e)}):o(new Error("Undefined action"))})}const nr={resource:"virtualParameters",attributes:er},or=T(e=>{const t={};for(const e of er)t[e.label]=e.id;return`/api/virtualParameters.csv?${Le.buildQueryString({filter:d(e),columns:JSON.stringify(t)})}`});const ir=Object.freeze({init:function(e){if(!window.authorizer.hasAccess("virtualParameters",2))return Promise.reject(new Error("You are not authorized to view this page"));const t=e.hasOwnProperty("sort")?""+e.sort:"",r=e.hasOwnProperty("filter")?""+e.filter:"";return new Promise((e,n)=>{bt().then(()=>{e({filter:r,sort:t})}).catch(n)})},component:()=>({view:e=>{document.title="Virtual Parameters - GenieACS";const t=e.attrs.sort?Xt(e.attrs.sort):{},r={};for(let e=0;e<er.length;e++)r[e]=t[er[e].id]||0;let n=!e.attrs.filter||Zt(e.attrs.filter);const o=ee("virtualParameters",n=tr(n),{limit:e.state.showCount||Gt,sort:t}),i=G("virtualParameters",n),s=or(n),a={};a.attributes=er,a.data=o.value,a.total=i.value,a.showMoreCallback=function(){e.state.showCount=(e.state.showCount||Gt)+Gt,Le.redraw()},a.sortAttributes=r,a.onSortChange=function(r){const n=Object.assign({},t);for(const[e,t]of Object.entries(r))delete n[er[e].id],n[er[e].id]=t;const o={sort:JSON.stringify(n)};e.attrs.filter&&(o.filter=e.attrs.filter),Le.route.set("/admin/virtualParameters",o)},a.downloadUrl=s,a.recordActionsCallback=e=>[Le("a",{onclick:()=>{const t=()=>Le(Tt,Object.assign({base:e,actionHandler:(e,r)=>new Promise(n=>{rr(e,r,!1).then(e=>{const r=e?Object.values(e):[];if(r.length)for(const e of r)N("error",e);else je(t);n()}).catch(e=>{N("error",e.message),n()})})},nr));xe(t)}},"Show")],window.authorizer.hasAccess("virtualParameters",3)&&(a.actionsCallback=e=>[Le("button.primary",{title:"Create new virtual parameter",onclick:()=>{const e=()=>Le(Tt,Object.assign({actionHandler:(t,r)=>new Promise(n=>{rr(t,r,!0).then(t=>{const r=t?Object.values(t):[];if(r.length)for(const e of r)N("error",e);else je(e);n()}).catch(e=>{N("error",e.message),n()})})},nr));xe(e)}},"New"),Le("button.primary",{title:"Delete selected virtual parameters",disabled:!e.size,onclick:t=>{confirm(`Deleting ${e.size} virtual parameters. Are you sure?`)&&(t.redraw=!1,t.target.disabled=!0,Promise.all(Array.from(e).map(e=>oe("virtualParameters",e))).then(e=>{N("success",`${e.length} virtual parameters deleted`),te(0,Date.now())}).catch(e=>{N("error",e.message),te(0,Date.now())}))}},"Delete")]);const l={resource:"virtualParameters"};return l.filter=e.attrs.filter,l.onChange=function(t){const r={filter:t};e.attrs.sort&&(r.sort=e.attrs.sort),Le.route.set("/admin/virtualParameters",r)},[Le("h1","Listing virtual parameters"),Le(it,l),Le(Ke,a)]}})}),sr=L.ui.pageSize||10,ar=T(f),lr=T(JSON.parse),cr=[{id:"_id",label:"Name"},{id:"metadata.fileType",label:"Type",type:"combo",options:["1 Firmware Upgrade Image","2 Web Content","3 Vendor Configuration File","4 Tone File","5 Ringer File"]},{id:"metadata.oui",label:"OUI"},{id:"metadata.productClass",label:"Product Class"},{id:"metadata.version",label:"Version"}],ur={resource:"files",attributes:cr.slice(1).concat([{id:"file",label:"File",type:"file"}])},fr=T(e=>l(e,e=>Array.isArray(e)&&"FUNC"===e[0]&&"Q"===e[1]?Xe("files",e[2],e[3]):e));const dr=T(e=>{const t={};for(const e of cr)t[e.label]=e.id;return`/api/files.csv?${Le.buildQueryString({filter:d(e),columns:JSON.stringify(t)})}`});const hr=Object.freeze({init:function(e){if(!window.authorizer.hasAccess("files",2))return Promise.reject(new Error("You are not authorized to view this page"));const t=e.hasOwnProperty("sort")?""+e.sort:"",r=e.hasOwnProperty("filter")?""+e.filter:"";return Promise.resolve({filter:r,sort:t})},component:()=>({view:e=>{document.title="Files - GenieACS";const t=e.attrs.sort?lr(e.attrs.sort):{},r={};for(let e=0;e<cr.length;e++)r[e]=t[cr[e].id]||0;let n=!e.attrs.filter||ar(e.attrs.filter);const o=ee("files",n=fr(n),{limit:e.state.showCount||sr,sort:t}),i=G("files",n),s=dr(n),a={};a.attributes=cr,a.data=o.value,a.total=i.value,a.showMoreCallback=function(){e.state.showCount=(e.state.showCount||sr)+sr,Le.redraw()},a.sortAttributes=r,a.onSortChange=function(r){const n=Object.assign({},t);for(const[e,t]of Object.entries(r))delete n[cr[e].id],n[cr[e].id]=t;const o={sort:JSON.stringify(n)};e.attrs.filter&&(o.filter=e.attrs.filter),Le.route.set("/admin/files",o)},a.downloadUrl=s,window.authorizer.hasAccess("files",3)&&(a.actionsCallback=e=>[Le("button.primary",{title:"Create new file",onclick:()=>{const e=()=>Le(Tt,Object.assign({actionHandler:(t,r)=>new Promise(n=>{(function(e,t){return new Promise((r,n)=>{const o=Object.assign({},t);if("save"===e){const e=o.file?o.file[0]:null;if(delete o.file,!e)return void r({file:"File not selected"});const t=e.name;se("files",t).then(i=>{if(i)return te(0,Date.now()),void r({file:"File already exists"});K({method:"PUT",headers:Object.assign({"Content-Type":"application/octet-stream",Accept:"application/octet-stream"},o),url:`/api/files/${encodeURIComponent(t)}`,serialize:e=>e,body:e}).then(()=>{N("success",`File ${i?"updated":"created"}`),te(0,Date.now()),r()}).catch(n)}).catch(n)}else n(new Error("Undefined action"))})})(t,r).then(t=>{const r=t?Object.values(t):[];if(r.length)for(const e of r)N("error",e);else je(e);n()}).catch(e=>{N("error",e.message),n()})})},ur));xe(e)}},"New"),Le("button.primary",{title:"Delete selected files",disabled:!e.size,onclick:t=>{confirm(`Deleting ${e.size} files. Are you sure?`)&&(t.redraw=!1,t.target.disabled=!0,Promise.all(Array.from(e).map(e=>oe("files",e))).then(e=>{N("success",`${e.length} files deleted`),te(0,Date.now())}).catch(e=>{N("error",e.message),te(0,Date.now())}))}},"Delete")]);const l={resource:"files"};return l.filter=e.attrs.filter,l.onChange=function(t){const r={filter:t};e.attrs.sort&&(r.sort=e.attrs.sort),Le.route.set("/admin/files",r)},[Le("h1","Listing files"),Le(it,l),Le(Ke,a)]}})});function pr(e,t){return new Promise((r,n)=>{try{let i=vt.parse(t,{schema:"failsafe"});if(i){const t={};let r=t;e.forEach((t,n)=>{n<e.length-1?(r[t]={},r=r[t]):r[t]=i}),i=function(e){const t={},r=(e,n)=>{for(const[o,i]of Object.entries(e)){const e=n?`${n}.${o}`:o;void 0!==i&&(null===i||"object"!=typeof i?t[e]=i:r(i,e))}};return null!==e&&"object"==typeof e&&r(e,""),t}(t)}else i={};for(const e of Object.values(i))f(e);(function(e="%"){const t=d(["LIKE",["PARAM","_id"],e]);return K({method:"GET",url:`api/config/?${o.a.buildQueryString({filter:t})}`,background:!0})})(`${e.join(".")}.%`).then(e=>{const t={};for(const r of e)t[r._id]=r.value;const o=function(e,t){const r={add:[],remove:[]};for(const[n,o]of Object.entries(t))e[n]&&e[n]===o||r.add.push({_id:n,value:o});for(const n of Object.keys(e))t[n]||r.remove.push(n);return r}(t,i);if(!o.add.length&&!o.remove.length)return void r();const s=[];for(const e of o.add)s.push(ie("config",e._id,e));for(const e of o.remove)s.push(oe("config",e));Promise.all(s).then(()=>{r()}).catch(n)}).catch(n)}catch(e){r({config:e.message})}})}const mr=()=>({view:e=>{const t=e.attrs.prefix.split("."),r=e.attrs.name,n=e.attrs.data;let o;if(""===t[t.length-1]&&t.pop(),n.length){o=function(e){e.sort((e,t)=>e._id>t._id?1:e._id<t._id?-1:0);const t={};for(const r of e){const e=r._id.split(".");let n=t;for(;e.length>1;){const t=e.shift();"object"!=typeof n[t]&&(n[t]={}),n=n[t]}n[e[0]]=r.value}const r=function(e){if(null==e||"object"!=typeof e)return e;if(Object.keys(e).length<=300){let t=[];for(const r of Object.keys(e)){const e=Math.floor(+r);if(!(e>=0&&e<300&&String(e)===r)){t=[];break}{const r=Math.floor(e/30);t[r]||(t[r]=0),t[r]|=1<<e%30}}let r=0;for(;t.length&&1073741823===(r=t.shift()););if(r&&(~r&r+1)===r+1){const t=[];for(let r=0;r<Object.keys(e).length;r++)t[r]=e[r];e=t}}for(const[t,n]of Object.entries(e))e[t]=r(n);return e};return r(t)}(n);for(const e of t)o=o[e]}const i=o&&Object.values(o).length?vt.stringify(o,{schema:"failsafe",tags:e=>e}):"",s=Le(Ct,{id:`${r}-ui-config`,value:i,mode:"yaml",focus:!0,onSubmit:e=>{e.form.querySelector("button[type=submit]").click()},onChange:t=>{e.state.updatedYaml=t}}),a=Le("button.primary",{type:"submit"},"Save");return Le("div.put-form",[Le("h1",`Editing ${r}`),Le("form",{onsubmit:r=>{r.redraw=!1,r.preventDefault(),null==e.state.updatedYaml&&(e.state.updatedYaml=i),pr(t,e.state.updatedYaml).then(e.attrs.onUpdate).catch(e.attrs.onError)}},[s,Le(".actions-bar",[a])])])}});function gr(e,t,r){return new Promise((n,o)=>{const i=Object.assign({},t);if("save"===e){let e=i._id||"";delete i._id;const t=/^[0-9a-zA-Z_.-]+$/;if(!(e=e.trim()).match(t))return void n({_id:"Invalid ID"});try{i.value=d(f(i.value||""))}catch(e){return void n({value:"Config value must be valid expression"})}se("config",e).then(t=>t&&r?(te(0,Date.now()),void n({_id:"Config already exists"})):t||r?void ie("config",e,i).then(()=>{N("success",`Config ${t?"updated":"created"}`),te(0,Date.now()),n()}).catch(o):(te(0,Date.now()),void n({_id:"Config does not exist"}))).catch(o)}else"delete"===e?oe("config",i._id).then(()=>{N("success","Config deleted"),te(0,Date.now()),n()}).catch(e=>{te(0,Date.now()),o(e)}):o(new Error("Undefined action"))})}const vr={resource:"config",attributes:[{id:"_id",label:"Key"},{id:"value",label:"Value",type:"textarea"}]};function wr(e,t){const r=e.value.sort((e,t)=>e._id<t._id?-1:1);let n;if(t){const e=t.split(" ").filter(e=>e);e.length&&(n=new RegExp(e.map(e=>(function(e){return e.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")})(e)).join(".*"),"i"))}const o=[];for(const e of r){const t={};!n||n.test(e._id)||n.test(e.value)||(t.style="display: none;");const r=Le("button",{title:"Edit config value",onclick:()=>{const t=()=>Le(Tt,Object.assign({base:e,actionHandler:(e,r)=>new Promise(n=>{gr(e,r,!1).then(e=>{const r=e?Object.values(e):[];if(r.length)for(const e of r)N("error",e);else je(t);n()}).catch(e=>{N("error",e.message),n()})})},vr));xe(t)}},ve("edit")),i=Le("button",{title:"Delete config",onclick:()=>{confirm(`Deleting ${e._id} config. Are you sure?`)&&gr("delete",e).catch(e=>{throw e})}},ve("remove"));o.push(Le("tr",t,Le("td.left",Le("long-text",{text:e._id})),Le("td.right",Le("span",[Le("long-text",{text:`${e.value}`}),r,i]))))}return o.length||o.push(Le("tr.empty",Le("td",{colspan:2},"No config"))),Le("table",Le("tbody",o))}const yr=Object.freeze({init:function(){return window.authorizer.hasAccess("config",2)?new Promise((e,t)=>{Promise.all([bt(),At()]).then(()=>{e({})}).catch(t)}):Promise.reject(new Error("You are not authorized to view this page"))},component:()=>({view:e=>{document.title="Config - GenieACS";const t=Le("input",{type:"text",placeholder:"Search config",oninput:t=>{e.state.searchString=t.target.value,t.redraw=!1,clearTimeout(e.state.timeout),e.state.timeout=setTimeout(Le.redraw,250)}}),r=ee("config",!0);let n;const o=[];if(window.authorizer.hasAccess("config",3)){n=Le("button.primary",{title:"Create new config",onclick:()=>{const e=()=>Le(Tt,Object.assign({actionHandler:(t,r)=>new Promise(n=>{gr(t,r,!0).then(t=>{const r=t?Object.values(t):[];if(r.length)for(const e of r)N("error",e);else je(e);n()}).catch(e=>{N("error",e.message),n()})})},vr));xe(e)}},"New config");const e=[{name:"overview",prefix:"ui.overview.groups.",data:[]},{name:"charts",prefix:"ui.overview.charts.",data:[]},{name:"filters",prefix:"ui.filters.",data:[]},{name:"index page",prefix:"ui.index.",data:[]},{name:"device page",prefix:"ui.device.",data:[]}];if(r.fulfilled)for(const t of r.value)for(const r of e)if(t._id.startsWith(r.prefix)){r.data.push(t);break}for(const t of e){const e={prefix:t.prefix,name:t.name,data:t.data};o.push(Le("button",{onclick:()=>{const r=()=>Le(mr,Object.assign({onUpdate:e=>{const n=e?Object.values(e):[];if(n.length)for(const e of n)N("error",e);else N("success",`${t.name.replace(/^[a-z]/,t.name[0].toUpperCase())} config updated`),je(r);te(0,Date.now())},onError:e=>{N("error",e.message),te(0,Date.now()),je(r)}},e));xe(r)}},`Edit ${t.name}`))}}return[Le("h1","Listing config"),Le(".all-parameters",t,Le(".parameter-list",{style:"height: 400px"},wr(r,e.state.searchString)),Le(".actions-bar",[n].concat(o)))]}})}),br=L.ui.pageSize||10,Ar=T(f),Or=T(JSON.parse),Er=[{id:"role",label:"Role"},{id:"resource",label:"Resource",type:"combo",options:["config","devices","faults","files","permissions","users","presets","provisions","virtualParameters"]},{id:"filter",label:"Filter",type:"textarea"},{id:"access",label:"Access",type:"combo",options:["1: count","2: read","3: write"]},{id:"validate",label:"Validate",type:"textarea"}],Pr=T(e=>l(e,e=>Array.isArray(e)&&"FUNC"===e[0]&&"Q"===e[1]?Xe("permissions",e[2],e[3]):e));function xr(e,t){return new Promise((r,n)=>{const o=Object.assign({},t);if("save"===e){if(!o.role)return void r({role:"Role can not be empty"});if(!o.resource)return void r({resource:"Resource can not be empty"});if(!o.access)return void r({access:"Access can not be empty"});if("3: write"===o.access)o.access=3;else if("2: read"===o.access)o.access=2;else{if("1: count"!==o.access)return void r({access:"Invalid access level"});o.access=1}if(o.filter)try{o.filter=d(Ar(o.filter))}catch(e){return void r({filter:"Filter must be valid expression"})}if(o.validate)try{o.validate=d(Ar(o.validate))}catch(e){return void r({validate:"Validate must be valid expression"})}const e=`${o.role}:${o.resource}:${o.access}`;se("permissions",e).then(t=>{if(t)return te(0,Date.now()),void r({_id:"Permission already exists"});ie("permissions",e,o).then(()=>{N("success","Permission created"),te(0,Date.now()),r()}).catch(n)}).catch(n)}else"delete"===e?oe("permissions",o._id).then(()=>{N("success","Permission deleted"),te(0,Date.now()),r()}).catch(e=>{te(0,Date.now()),n(e)}):n(new Error("Undefined action"))})}const jr={resource:"permissions",attributes:Er},kr=T(e=>{const t={};for(const e of Er)t[e.label]=e.id;return`/api/permissions.csv?${Le.buildQueryString({filter:d(e),columns:JSON.stringify(t)})}`});const Sr=Object.freeze({init:function(e){if(!window.authorizer.hasAccess("permissions",2))return Promise.reject(new Error("You are not authorized to view this page"));const t=e.hasOwnProperty("sort")?""+e.sort:"",r=e.hasOwnProperty("filter")?""+e.filter:"";return Promise.resolve({filter:r,sort:t})},component:()=>({view:e=>{document.title="Permissions - GenieACS";const t=e.attrs.sort?Or(e.attrs.sort):{},r={};for(let e=0;e<Er.length;e++){const n=Er[e];"filter"!==n.id&&"validate"!==n.id&&(r[e]=t[n.id]||0)}let n=!e.attrs.filter||Ar(e.attrs.filter);const o=ee("permissions",n=Pr(n),{limit:e.state.showCount||br,sort:t}),i=G("permissions",n),s=kr(n),a={};a.attributes=Er,a.data=o.value,a.total=i.value,a.valueCallback=(e,t)=>{if("access"===e.id){const e=t.access;return 1===e?"1: count":2===e?"2: read":3===e?"3: write":e}return t[e.id]},a.showMoreCallback=function(){e.state.showCount=(e.state.showCount||br)+br,Le.redraw()},a.sortAttributes=r,a.onSortChange=function(r){const n=Object.assign({},t);for(const[e,t]of Object.entries(r))delete n[Er[e].id],n[Er[e].id]=t;const o={sort:JSON.stringify(n)};e.attrs.filter&&(o.filter=e.attrs.filter),Le.route.set("/admin/permissions",o)},a.downloadUrl=s,window.authorizer.hasAccess("permissions",3)&&(a.recordActionsCallback=e=>[Le("button",{title:"Delete permission",onclick:()=>{confirm(`Deleting ${e._id} permission. Are you sure?`)&&xr("delete",e).catch(e=>{N("error",e.message)})}},ve("remove"))],a.actionsCallback=e=>[Le("button.primary",{title:"Create new permission",onclick:()=>{const e=()=>Le(Tt,Object.assign({actionHandler:(t,r)=>new Promise(n=>{xr(t,r).then(t=>{const r=t?Object.values(t):[];if(r.length)for(const e of r)N("error",e);else je(e);n()}).catch(e=>{N("error",e.message),n()})})},jr));xe(e)}},"New"),Le("button.primary",{title:"Delete selected permissions",disabled:!e.size,onclick:t=>{confirm(`Deleting ${e.size} permissions. Are you sure?`)&&(t.redraw=!1,t.target.disabled=!0,Promise.all(Array.from(e).map(e=>oe("permissions",e))).then(e=>{N("success",`${e.length} permissions deleted`),te(0,Date.now())}).catch(e=>{N("error",e.message),te(0,Date.now())}))}},"Delete")]);const l={resource:"permissions"};return l.filter=e.attrs.filter,l.onChange=function(t){const r={filter:t};e.attrs.sort&&(r.sort=e.attrs.sort),Le.route.set("/admin/permissions",r)},[Le("h1","Listing permissions"),Le(it,l),Le(Ke,a)]}})}),Cr=L.ui.pageSize||10,$r=T(f),Dr=T(JSON.parse),Tr=[{id:"_id",label:"Username"},{id:"roles",label:"Roles",type:"multi",options:[]}],Ir=T(e=>l(e,e=>Array.isArray(e)&&"FUNC"===e[0]&&"Q"===e[1]?Xe("users",e[2],e[3]):e));function Rr(e,t,r){return new Promise((n,o)=>{const i=Object.assign({},t);if("save"===e){const e=i._id,t=i.password,s=i.confirm;if(delete i._id,delete i.password,delete i.confirm,!e)return void n({_id:"ID can not be empty"});if(r){if(!t)return void n({password:"Password can not be empty"});if(t!==s)return void n({confirm:"Confirm password doesn't match password"})}if(!Array.isArray(i.roles)||!i.roles.length)return void n({roles:"Role(s) must be selected"});i.roles=i.roles.join(","),se("users",e).then(s=>s&&r?(te(0,Date.now()),void n({_id:"User already exists"})):s||r?void ie("users",e,i).then(()=>{r?le(e,t).then(()=>{N("success","User created"),te(0,Date.now()),n()}).catch(o):(N("success","User updated"),te(0,Date.now()),n())}).catch(o):(te(0,Date.now()),void n({_id:"User does not exist"}))).catch(o)}else"delete"===e?oe("users",i._id).then(()=>{N("success","User deleted"),te(0,Date.now()),n()}).catch(e=>{te(0,Date.now()),o(e)}):o(new Error("Undefined action"))})}const Nr=T(e=>{const t={};for(const e of Tr)t[e.label]=e.id;return`/api/users.csv?${Le.buildQueryString({filter:d(e),columns:JSON.stringify(t)})}`});const _r=Object.freeze({init:function(e){if(!window.authorizer.hasAccess("users",2))return Promise.reject(new Error("You are not authorized to view this page"));const t=e.hasOwnProperty("sort")?""+e.sort:"",r=e.hasOwnProperty("filter")?""+e.filter:"";return Promise.resolve({filter:r,sort:t})},component:()=>({view:e=>{document.title="Users - GenieACS";const t=e.attrs.sort?Dr(e.attrs.sort):{},r={};for(let e=0;e<Tr.length;e++)"roles"!==Tr[e].id&&(r[e]=t[Tr[e].id]||0);let n=!e.attrs.filter||$r(e.attrs.filter);const o=ee("users",n=Ir(n),{limit:e.state.showCount||Cr,sort:t}),i=G("users",n),s=ee("permissions",!0);if(s.fulfilled)for(const e of Tr)"roles"===e.id&&(e.options=[...new Set(s.value.map(e=>e.role))]);const a=Nr(n),l=window.authorizer.hasAccess("users",3),c={};if(c.attributes=Tr,c.data=o.value,c.total=i.value,c.showMoreCallback=function(){e.state.showCount=(e.state.showCount||Cr)+Cr,Le.redraw()},c.sortAttributes=r,c.onSortChange=function(r){const n=Object.assign({},t);for(const[e,t]of Object.entries(r))delete n[Tr[e].id],n[Tr[e].id]=t;const o={sort:JSON.stringify(n)};e.attrs.filter&&(o.filter=e.attrs.filter),Le.route.set("/admin/users",o)},c.downloadUrl=a,c.recordActionsCallback=e=>[Le("a",{onclick:()=>{const t=()=>{const r=[Le(Tt,Object.assign({base:{_id:e._id,roles:e.roles.split(",")},actionHandler:(e,r)=>new Promise(n=>{Rr(e,r,!1).then(e=>{const r=e?Object.values(e):[];if(r.length)for(const e of r)N("error",e);else je(t);n()}).catch(e=>{N("error",e.message),n()})})},{resource:"users",attributes:Tr}))];if(l){r.push(Le("hr"));const n={noAuth:!0,username:e._id,onPasswordChange:()=>{je(t),Le.redraw()}};r.push(Le(Be,n))}return r};xe(t)}},"Show")],l){const e={resource:"users",attributes:[Tr[0],{id:"password",label:"Password",type:"password"},{id:"confirm",label:"Confirm password",type:"password"},Tr[1]]};c.actionsCallback=t=>[Le("button.primary",{title:"Create new user",onclick:()=>{const t=()=>Le(Tt,Object.assign({actionHandler:(e,r)=>new Promise(n=>{Rr(e,r,!0).then(e=>{const r=e?Object.values(e):[];if(r.length)for(const e of r)N("error",e);else je(t);n()}).catch(e=>{N("error",e.message),n()})})},e));xe(t)}},"New"),Le("button.primary",{title:"Delete selected users",disabled:!t.size,onclick:e=>{confirm(`Deleting ${t.size} users. Are you sure?`)&&(e.redraw=!1,e.target.disabled=!0,Promise.all(Array.from(t).map(e=>oe("users",e))).then(e=>{N("success",`${e.length} users deleted`),te(0,Date.now())}).catch(e=>{N("error",e.message),te(0,Date.now())}))}},"Delete")]}const u={resource:"users"};return u.filter=e.attrs.filter,u.onChange=function(t){const r={filter:t};e.attrs.sort&&(r.sort=e.attrs.sort),Le.route.set("/admin/users",r)},[Le("h1","Listing users"),Le(it,u),Le(Ke,c)]}})});window.authorizer=new class{constructor(e){this.permissionSets=e,this.validatorCache=new WeakMap,this.hasAccessCache=new Map,this.getFilterCache=new Map}hasAccess(e,t){const r=`${e}-${t}`;if(this.hasAccessCache.has(r))return this.hasAccessCache.get(r);let n=!1;for(const r of this.permissionSets)for(const o of r)if(o[e]&&o[e].access>=t){n=!0;break}return this.hasAccessCache.set(r,n),n}getFilter(e,t){const r=`${e}-${t}`;if(this.getFilterCache.has(r))return this.getFilterCache.get(r);let n=null;for(const r of this.permissionSets)for(const o of r)o[e]&&o[e].access>=t&&(n=x(n,o[e].filter));return this.getFilterCache.set(r,n),n}getValidator(e,t){if(this.validatorCache.has(t))return this.validatorCache.get(t);const r=[];for(const t of this.permissionSets)for(const n of t)n[e]&&n[e].access>=3&&n[e].validate&&r.push(n[e].validate);const n=(n,o,i)=>{if(!r.length)return!1;const s={mutationType:n,mutation:o,resourceType:e,object:t,options:i},a=E(r.length>1?["OR",r]:r[0],e=>{const t=e.split(".",1)[0];e=e.slice(t.length+1);let r=null;if(["mutation","options"].includes(t)){r=s[t];for(const t of e.split("."))if(null==(r=null!=r&&"object"!=typeof r?null:r[t]))break}else s[t]&&(r=s[t][e]);return r},Date.now());return!Array.isArray(a)&&!!a};return this.validatorCache.set(t,n),n}getPermissionSets(){return this.permissionSets}}(window.permissionSets);const Lr=["presets","provisions","virtualParameters","files","config","users","permissions"];let Mr,Ur=0,zr=0,Br=null;function Fr(){clearTimeout(Br),Br=setTimeout(()=>{te(Ur,zr).then(e=>{e&&o.a.redraw()})},100)}function Yr(e,t){const r={render:()=>{let r;Ur=Date.now(),r=Mr&&Mr.error?o()(mt,Mr):o()(ze(t.component),Mr),Fr();const n={};return n.page=e,o()(Se,n,r)},onmatch:null};return r.onmatch=(e,r)=>(zr=Date.now(),t.init?new Promise(n=>{t.init(e).then(e=>{e?(Mr=e,n(),Fr()):o.a.route.set("/")}).catch(e=>{!window.username&&e.message.indexOf("authorized")>=0&&(N("error",e.message),o.a.route.set("/login",{continue:r})),Mr={error:e.message},n()})}):(Mr=null,Fr(),null)),r}o.a.route(document.body,"/overview",{"/wizard":Yr("wizard",Ce),"/login":Yr("login",Fe),"/overview":Yr("overview",He),"/devices":Yr("devices",ht),"/devices/:id":Yr("devices",pt),"/faults":Yr("faults",St),"/admin":{onmatch:()=>{for(const e of Lr)if(window.authorizer.hasAccess(e,2))return o.a.route.set(`/admin/${e}`),null;return null}},"/admin/presets":Yr("presets",Bt),"/admin/provisions":Yr("provisions",Qt),"/admin/virtualParameters":Yr("virtualParameters",ir),"/admin/files":Yr("files",hr),"/admin/config":Yr("config",yr),"/admin/users":Yr("users",_r),"/admin/permissions":Yr("permissions",Sr)})},function(e,t,r){"use strict";var n=r(7);n.trust=r(19),n.fragment=r(20),e.exports=n},function(e,t,r){"use strict";var n=r(2);e.exports=function(e){return null==e&&(e=""),n("<",void 0,void 0,e,void 0,void 0)}},function(e,t,r){"use strict";var n=r(2),o=r(8);e.exports=function(){var e=o.apply(0,arguments);return e.tag="[",e.children=n.normalizeChildren(e.children),e}},function(e,t,r){"use strict";var n=r(9),o=r(4);e.exports=r(26)(window,n,o.redraw)},function(e,t,r){(function(e,t){!function(e,r){"use strict";if(!e.setImmediate){var n,o,i,s,a,l=1,c={},u=!1,f=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?n=function(e){t.nextTick(function(){p(e)})}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?e.MessageChannel?((i=new MessageChannel).port1.onmessage=function(e){p(e.data)},n=function(e){i.port2.postMessage(e)}):f&&"onreadystatechange"in f.createElement("script")?(o=f.documentElement,n=function(e){var t=f.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,o.removeChild(t),t=null},o.appendChild(t)}):n=function(e){setTimeout(p,0,e)}:(s="setImmediate$"+Math.random()+"$",a=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(s)&&p(+t.data.slice(s.length))},e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),n=function(t){e.postMessage(s+t,"*")}),d.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var o={callback:e,args:t};return c[l]=o,n(l),l++},d.clearImmediate=h}function h(e){delete c[e]}function p(e){if(u)setTimeout(p,0,e);else{var t=c[e];if(t){u=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(r,n)}}(t)}finally{h(e),u=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,r(3),r(23))},function(e,t){var r,n,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var l,c=[],u=!1,f=-1;function d(){u&&l&&(u=!1,l.length?c=l.concat(c):f=-1,c.length&&h())}function h(){if(!u){var e=a(d);u=!0;for(var t=c.length;t;){for(l=c,c=[];++f<t;)l&&l[f].run();f=-1,t=c.length}l=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new p(e,t)),1!==c.length||u||a(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,r){"use strict";var n=r(2);e.exports=function(e){var t,r=e&&e.document,o={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function i(e){return e.attrs&&e.attrs.xmlns||o[e.tag]}function s(e,t){if(e.state!==t)throw new Error("`vnode.state` must not be modified")}function a(e){var t=e.state;try{return this.apply(t,arguments)}finally{s(e,t)}}function l(){try{return r.activeElement}catch(e){return null}}function c(e,t,r,n,o,i,s){for(var a=r;a<n;a++){var l=t[a];null!=l&&u(e,l,o,s,i)}}function u(e,t,o,s,l){var f=t.tag;if("string"==typeof f)switch(t.state={},null!=t.attrs&&_(t.attrs,t,o),f){case"#":!function(e,t,n){t.dom=r.createTextNode(t.children),y(e,t.dom,n)}(e,t,l);break;case"<":d(e,t,s,l);break;case"[":!function(e,t,n,o,i){var s=r.createDocumentFragment();if(null!=t.children){var a=t.children;c(s,a,0,a.length,n,null,o)}t.dom=s.firstChild,t.domSize=s.childNodes.length,y(e,s,i)}(e,t,o,s,l);break;default:!function(e,t,o,s,a){var l=t.tag,u=t.attrs,f=u&&u.is,d=(s=i(t)||s)?f?r.createElementNS(s,l,{is:f}):r.createElementNS(s,l):f?r.createElement(l,{is:f}):r.createElement(l);t.dom=d,null!=u&&function(e,t,r){for(var n in t)j(e,n,null,t[n],r)}(t,u,s);if(y(e,d,a),!b(t)&&(null!=t.text&&(""!==t.text?d.textContent=t.text:t.children=[n("#",void 0,void 0,t.text,void 0,void 0)]),null!=t.children)){var h=t.children;c(d,h,0,h.length,o,null,s),"select"===t.tag&&null!=u&&function(e,t){if("value"in t)if(null===t.value)-1!==e.dom.selectedIndex&&(e.dom.value=null);else{var r=""+t.value;e.dom.value===r&&-1!==e.dom.selectedIndex||(e.dom.value=r)}"selectedIndex"in t&&j(e,"selectedIndex",null,t.selectedIndex,void 0)}(t,u)}}(e,t,o,s,l)}else!function(e,t,r,o,i){(function(e,t){var r;if("function"==typeof e.tag.view){if(e.state=Object.create(e.tag),null!=(r=e.state.view).$$reentrantLock$$)return;r.$$reentrantLock$$=!0}else{if(e.state=void 0,null!=(r=e.tag).$$reentrantLock$$)return;r.$$reentrantLock$$=!0,e.state=null!=e.tag.prototype&&"function"==typeof e.tag.prototype.view?new e.tag(e):e.tag(e)}if(_(e.state,e,t),null!=e.attrs&&_(e.attrs,e,t),e.instance=n.normalize(a.call(e.state.view,e)),e.instance===e)throw Error("A view cannot return the vnode it received as argument");r.$$reentrantLock$$=null})(t,r),null!=t.instance?(u(e,t.instance,r,o,i),t.dom=t.instance.dom,t.domSize=null!=t.dom?t.instance.domSize:0):t.domSize=0}(e,t,o,s,l)}var f={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function d(e,t,n,o){var i=t.children.match(/^\s*?<(\w+)/im)||[],s=r.createElement(f[i[1]]||"div");"http://www.w3.org/2000/svg"===n?(s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+t.children+"</svg>",s=s.firstChild):s.innerHTML=t.children,t.dom=s.firstChild,t.domSize=s.childNodes.length,t.instance=[];for(var a,l=r.createDocumentFragment();a=s.firstChild;)t.instance.push(a),l.appendChild(a);y(e,l,o)}function h(e,t,r,n,o,i){if(t!==r&&(null!=t||null!=r))if(null==t||0===t.length)c(e,r,0,r.length,n,o,i);else if(null==r||0===r.length)A(e,t,0,t.length);else{var s=null!=t[0]&&null!=t[0].key,a=null!=r[0]&&null!=r[0].key,l=0,f=0;if(!s)for(;f<t.length&&null==t[f];)f++;if(!a)for(;l<r.length&&null==r[l];)l++;if(null===a&&null==s)return;if(s!==a)A(e,t,f,t.length),c(e,r,l,r.length,n,o,i);else if(a){for(var d,h,y,b,E,P=t.length-1,x=r.length-1;P>=f&&x>=l&&(y=t[P],b=r[x],y.key===b.key);)y!==b&&p(e,y,b,n,o,i),null!=b.dom&&(o=b.dom),P--,x--;for(;P>=f&&x>=l&&(d=t[f],h=r[l],d.key===h.key);)f++,l++,d!==h&&p(e,d,h,n,v(t,f,o),i);for(;P>=f&&x>=l&&l!==x&&d.key===b.key&&y.key===h.key;)w(e,y,E=v(t,f,o)),y!==h&&p(e,y,h,n,E,i),++l<=--x&&w(e,d,o),d!==b&&p(e,d,b,n,o,i),null!=b.dom&&(o=b.dom),f++,y=t[--P],b=r[x],d=t[f],h=r[l];for(;P>=f&&x>=l&&y.key===b.key;)y!==b&&p(e,y,b,n,o,i),null!=b.dom&&(o=b.dom),x--,y=t[--P],b=r[x];if(l>x)A(e,t,f,P+1);else if(f>P)c(e,r,l,x+1,n,o,i);else{var j,k,S=o,C=x-l+1,$=new Array(C),D=0,T=0,I=2147483647,R=0;for(T=0;T<C;T++)$[T]=-1;for(T=x;T>=l;T--){null==j&&(j=m(t,f,P+1));var N=j[(b=r[T]).key];null!=N&&(I=N<I?N:-1,$[T-l]=N,y=t[N],t[N]=null,y!==b&&p(e,y,b,n,o,i),null!=b.dom&&(o=b.dom),R++)}if(o=S,R!==P-f+1&&A(e,t,f,P+1),0===R)c(e,r,l,x+1,n,o,i);else if(-1===I)for(D=(k=function(e){for(var t=[0],r=0,n=0,o=0,i=g.length=e.length,o=0;o<i;o++)g[o]=e[o];for(var o=0;o<i;++o)if(-1!==e[o]){var s=t[t.length-1];if(e[s]<e[o])g[o]=s,t.push(o);else{for(r=0,n=t.length-1;r<n;){var a=(r>>>1)+(n>>>1)+(r&n&1);e[t[a]]<e[o]?r=a+1:n=a}e[o]<e[t[r]]&&(r>0&&(g[o]=t[r-1]),t[r]=o)}}r=t.length,n=t[r-1];for(;r-- >0;)t[r]=n,n=g[n];return g.length=0,t}($)).length-1,T=x;T>=l;T--)h=r[T],-1===$[T-l]?u(e,h,n,i,o):k[D]===T-l?D--:w(e,h,o),null!=h.dom&&(o=r[T].dom);else for(T=x;T>=l;T--)h=r[T],-1===$[T-l]&&u(e,h,n,i,o),null!=h.dom&&(o=r[T].dom)}}else{var _=t.length<r.length?t.length:r.length;for(l=l<f?l:f;l<_;l++)(d=t[l])===(h=r[l])||null==d&&null==h||(null==d?u(e,h,n,i,v(t,l+1,o)):null==h?O(e,d):p(e,d,h,n,v(t,l+1,o),i));t.length>_&&A(e,t,l,t.length),r.length>_&&c(e,r,l,r.length,n,o,i)}}}function p(e,t,r,o,s,l){var c=t.tag;if(c===r.tag){if(r.state=t.state,r.events=t.events,function(e,t){do{if(null!=e.attrs&&"function"==typeof e.attrs.onbeforeupdate){var r=a.call(e.attrs.onbeforeupdate,e,t);if(void 0!==r&&!r)break}if("string"!=typeof e.tag&&"function"==typeof e.state.onbeforeupdate){var r=a.call(e.state.onbeforeupdate,e,t);if(void 0!==r&&!r)break}return!1}while(0);return e.dom=t.dom,e.domSize=t.domSize,e.instance=t.instance,e.attrs=t.attrs,e.children=t.children,e.text=t.text,!0}(r,t))return;if("string"==typeof c)switch(null!=r.attrs&&L(r.attrs,r,o),c){case"#":!function(e,t){e.children.toString()!==t.children.toString()&&(e.dom.nodeValue=t.children);t.dom=e.dom}(t,r);break;case"<":!function(e,t,r,n,o){t.children!==r.children?(E(e,t),d(e,r,n,o)):(r.dom=t.dom,r.domSize=t.domSize)}(e,t,r,l,s);break;case"[":!function(e,t,r,n,o,i){h(e,t.children,r.children,n,o,i);var s=0,a=r.children;if(r.dom=null,null!=a){for(var l=0;l<a.length;l++){var c=a[l];null!=c&&null!=c.dom&&(null==r.dom&&(r.dom=c.dom),s+=c.domSize||1)}1!==s&&(r.domSize=s)}}(e,t,r,o,s,l);break;default:!function(e,t,r,o){var s=t.dom=e.dom;o=i(t)||o,"textarea"===t.tag&&(null==t.attrs&&(t.attrs={}),null!=t.text&&(t.attrs.value=t.text,t.text=void 0));(function(e,t,r,n){if(null!=r)for(var o in r)j(e,o,t&&t[o],r[o],n);var i;if(null!=t)for(var o in t)null==(i=t[o])||null!=r&&null!=r[o]||k(e,o,i,n)})(t,e.attrs,t.attrs,o),b(t)||(null!=e.text&&null!=t.text&&""!==t.text?e.text.toString()!==t.text.toString()&&(e.dom.firstChild.nodeValue=t.text):(null!=e.text&&(e.children=[n("#",void 0,void 0,e.text,void 0,e.dom.firstChild)]),null!=t.text&&(t.children=[n("#",void 0,void 0,t.text,void 0,void 0)]),h(s,e.children,t.children,r,null,o)))}(t,r,o,l)}else!function(e,t,r,o,i,s){if(r.instance=n.normalize(a.call(r.state.view,r)),r.instance===r)throw Error("A view cannot return the vnode it received as argument");L(r.state,r,o),null!=r.attrs&&L(r.attrs,r,o);null!=r.instance?(null==t.instance?u(e,r.instance,o,s,i):p(e,t.instance,r.instance,o,i,s),r.dom=r.instance.dom,r.domSize=r.instance.domSize):null!=t.instance?(O(e,t.instance),r.dom=void 0,r.domSize=0):(r.dom=t.dom,r.domSize=t.domSize)}(e,t,r,o,s,l)}else O(e,t),u(e,r,o,l,s)}function m(e,t,r){for(var n=Object.create(null);t<r;t++){var o=e[t];if(null!=o){var i=o.key;null!=i&&(n[i]=t)}}return n}var g=[];function v(e,t,r){for(;t<e.length;t++)if(null!=e[t]&&null!=e[t].dom)return e[t].dom;return r}function w(e,t,n){var o=r.createDocumentFragment();!function e(t,r,n){for(;null!=n.dom&&n.dom.parentNode===t;){if("string"!=typeof n.tag){if(null!=(n=n.instance))continue}else if("<"===n.tag)for(var o=0;o<n.instance.length;o++)r.appendChild(n.instance[o]);else if("["!==n.tag)r.appendChild(n.dom);else if(1===n.children.length){if(null!=(n=n.children[0]))continue}else for(var o=0;o<n.children.length;o++){var i=n.children[o];null!=i&&e(t,r,i)}break}}(e,o,t),y(e,o,n)}function y(e,t,r){null!=r?e.insertBefore(t,r):e.appendChild(t)}function b(e){if(null!=e.attrs&&(null!=e.attrs.contenteditable||null!=e.attrs.contentEditable)){var t=e.children;if(null!=t&&1===t.length&&"<"===t[0].tag){var r=t[0].children;e.dom.innerHTML!==r&&(e.dom.innerHTML=r)}else if(null!=e.text||null!=t&&0!==t.length)throw new Error("Child node of a contenteditable must be trusted")}}function A(e,t,r,n){for(var o=r;o<n;o++){var i=t[o];null!=i&&O(e,i)}}function O(e,t){var r,n,o,i=0,l=t.state;"string"!=typeof t.tag&&"function"==typeof t.state.onbeforeremove&&(null!=(o=a.call(t.state.onbeforeremove,t))&&"function"==typeof o.then&&(i=1,r=o));t.attrs&&"function"==typeof t.attrs.onbeforeremove&&(null!=(o=a.call(t.attrs.onbeforeremove,t))&&"function"==typeof o.then&&(i|=2,n=o));if(s(t,l),i){if(null!=r){var c=function(){1&i&&((i&=2)||u())};r.then(c,c)}if(null!=n){c=function(){2&i&&((i&=1)||u())};n.then(c,c)}}else x(t),P(e,t);function u(){s(t,l),x(t),P(e,t)}}function E(e,t){for(var r=0;r<t.instance.length;r++)e.removeChild(t.instance[r])}function P(e,t){for(;null!=t.dom&&t.dom.parentNode===e;){if("string"!=typeof t.tag){if(null!=(t=t.instance))continue}else if("<"===t.tag)E(e,t);else{if("["!==t.tag&&(e.removeChild(t.dom),!Array.isArray(t.children)))break;if(1===t.children.length){if(null!=(t=t.children[0]))continue}else for(var r=0;r<t.children.length;r++){var n=t.children[r];null!=n&&P(e,n)}}break}}function x(e){if("string"!=typeof e.tag&&"function"==typeof e.state.onremove&&a.call(e.state.onremove,e),e.attrs&&"function"==typeof e.attrs.onremove&&a.call(e.attrs.onremove,e),"string"!=typeof e.tag)null!=e.instance&&x(e.instance);else{var t=e.children;if(Array.isArray(t))for(var r=0;r<t.length;r++){var n=t[r];null!=n&&x(n)}}}function j(e,t,n,o,i){if("key"!==t&&"is"!==t&&null!=o&&!S(t)&&(n!==o||function(e,t){return"value"===t||"checked"===t||"selectedIndex"===t||"selected"===t&&e.dom===l()||"option"===e.tag&&e.dom.parentNode===r.activeElement}(e,t)||"object"==typeof o)){if("o"===t[0]&&"n"===t[1])return N(e,t,o);if("xlink:"===t.slice(0,6))e.dom.setAttributeNS("http://www.w3.org/1999/xlink",t.slice(6),o);else if("style"===t)I(e.dom,n,o);else if(C(e,t,i)){if("value"===t){if(("input"===e.tag||"textarea"===e.tag)&&e.dom.value===""+o&&e.dom===l())return;if("select"===e.tag&&null!==n&&e.dom.value===""+o)return;if("option"===e.tag&&null!==n&&e.dom.value===""+o)return}"input"===e.tag&&"type"===t?e.dom.setAttribute(t,o):e.dom[t]=o}else"boolean"==typeof o?o?e.dom.setAttribute(t,""):e.dom.removeAttribute(t):e.dom.setAttribute("className"===t?"class":t,o)}}function k(e,t,r,n){if("key"!==t&&"is"!==t&&null!=r&&!S(t))if("o"!==t[0]||"n"!==t[1]||S(t))if("style"===t)I(e.dom,r,null);else if(!C(e,t,n)||"className"===t||"value"===t&&("option"===e.tag||"select"===e.tag&&-1===e.dom.selectedIndex&&e.dom===l())||"input"===e.tag&&"type"===t){var o=t.indexOf(":");-1!==o&&(t=t.slice(o+1)),!1!==r&&e.dom.removeAttribute("className"===t?"class":t)}else e.dom[t]=null;else N(e,t,void 0)}function S(e){return"oninit"===e||"oncreate"===e||"onupdate"===e||"onremove"===e||"onbeforeremove"===e||"onbeforeupdate"===e}function C(e,t,r){return void 0===r&&(e.tag.indexOf("-")>-1||null!=e.attrs&&e.attrs.is||"href"!==t&&"list"!==t&&"form"!==t&&"width"!==t&&"height"!==t)&&t in e.dom}var $=/[A-Z]/g;function D(e){return"-"+e.toLowerCase()}function T(e){return"-"===e[0]&&"-"===e[1]?e:"cssFloat"===e?"float":e.replace($,D)}function I(e,t,r){if(t===r);else if(null==r)e.style.cssText="";else if("object"!=typeof r)e.style.cssText=r;else if(null==t||"object"!=typeof t)for(var n in e.style.cssText="",r){null!=(o=r[n])&&e.style.setProperty(T(n),String(o))}else{for(var n in r){var o;null!=(o=r[n])&&(o=String(o))!==String(t[n])&&e.style.setProperty(T(n),o)}for(var n in t)null!=t[n]&&null==r[n]&&e.style.removeProperty(T(n))}}function R(){this._=t}function N(e,t,r){if(null!=e.events){if(e.events[t]===r)return;null==r||"function"!=typeof r&&"object"!=typeof r?(null!=e.events[t]&&e.dom.removeEventListener(t.slice(2),e.events,!1),e.events[t]=void 0):(null==e.events[t]&&e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=r)}else null==r||"function"!=typeof r&&"object"!=typeof r||(e.events=new R,e.dom.addEventListener(t.slice(2),e.events,!1),e.events[t]=r)}function _(e,t,r){"function"==typeof e.oninit&&a.call(e.oninit,t),"function"==typeof e.oncreate&&r.push(a.bind(e.oncreate,t))}function L(e,t,r){"function"==typeof e.onupdate&&r.push(a.bind(e.onupdate,t))}return R.prototype=Object.create(null),R.prototype.handleEvent=function(e){var t,r=this["on"+e.type];"function"==typeof r?t=r.call(e.currentTarget,e):"function"==typeof r.handleEvent&&r.handleEvent(e),this._&&!1!==e.redraw&&(0,this._)(),!1===t&&(e.preventDefault(),e.stopPropagation())},function(e,r,o){if(!e)throw new TypeError("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var i=[],s=l(),a=e.namespaceURI;null==e.vnodes&&(e.textContent=""),r=n.normalizeChildren(Array.isArray(r)?r:[r]);var c=t;try{t="function"==typeof o?o:void 0,h(e,e.vnodes,r,i,null,"http://www.w3.org/1999/xhtml"===a?void 0:a)}finally{t=c}e.vnodes=r,null!=s&&l()!==s&&"function"==typeof s.focus&&s.focus();for(var u=0;u<i.length;u++)i[u]()}}},function(e,t,r){"use strict";var n=r(2);e.exports=function(e,t,r){var o=[],i=!1,s=!1;function a(){if(i)throw new Error("Nested m.redraw.sync() call");i=!0;for(var t=0;t<o.length;t+=2)try{e(o[t],n(o[t+1]),l)}catch(e){r.error(e)}i=!1}function l(){s||(s=!0,t(function(){s=!1,a()}))}return l.sync=a,{mount:function(t,r){if(null!=r&&null==r.view&&"function"!=typeof r)throw new TypeError("m.mount(element, component) expects a component, not a vnode");var i=o.indexOf(t);i>=0&&(o.splice(i,2),e(t,[],l)),null!=r&&(o.push(t,r),e(t,n(r),l))},redraw:l}}},function(e,t,r){"use strict";var n=r(5);e.exports=function(e,t,r){var o=0;function i(e){return new t(e)}function s(e){return function(o,s){"string"!=typeof o?(s=o,o=o.url):null==s&&(s={});var a=new t(function(t,r){e(n(o,s.params),s,function(e){if("function"==typeof s.type)if(Array.isArray(e))for(var r=0;r<e.length;r++)e[r]=new s.type(e[r]);else e=new s.type(e);t(e)},r)});if(!0===s.background)return a;var l=0;function c(){0==--l&&"function"==typeof r&&r()}return function e(t){var r=t.then;t.constructor=i;t.then=function(){l++;var n=r.apply(t,arguments);return n.then(c,function(e){if(c(),0===l)throw e}),e(n)};return t}(a)}}function a(e,t){for(var r in e.headers)if({}.hasOwnProperty.call(e.headers,r)&&t.test(r))return!0;return!1}return i.prototype=t.prototype,i.__proto__=t,{request:s(function(t,r,n,o){var i,s=null!=r.method?r.method.toUpperCase():"GET",l=r.body,c=!(null!=r.serialize&&r.serialize!==JSON.serialize||l instanceof e.FormData),u=r.responseType||("function"==typeof r.extract?"":"json"),f=new e.XMLHttpRequest,d=!1,h=f,p=f.abort;for(var m in f.abort=function(){d=!0,p.call(this)},f.open(s,t,!1!==r.async,"string"==typeof r.user?r.user:void 0,"string"==typeof r.password?r.password:void 0),c&&null!=l&&!a(r,/^content-type$/i)&&f.setRequestHeader("Content-Type","application/json; charset=utf-8"),"function"==typeof r.deserialize||a(r,/^accept$/i)||f.setRequestHeader("Accept","application/json, text/*"),r.withCredentials&&(f.withCredentials=r.withCredentials),r.timeout&&(f.timeout=r.timeout),f.responseType=u,r.headers)({}).hasOwnProperty.call(r.headers,m)&&f.setRequestHeader(m,r.headers[m]);f.onreadystatechange=function(e){if(!d&&4===e.target.readyState)try{var i,s=e.target.status>=200&&e.target.status<300||304===e.target.status||/^file:\/\//i.test(t),a=e.target.response;if("json"===u?e.target.responseType||"function"==typeof r.extract||(a=JSON.parse(e.target.responseText)):u&&"text"!==u||null==a&&(a=e.target.responseText),"function"==typeof r.extract?(a=r.extract(e.target,r),s=!0):"function"==typeof r.deserialize&&(a=r.deserialize(a)),s)n(a);else{try{i=e.target.responseText}catch(e){i=a}var l=new Error(i);l.code=e.target.status,l.response=a,o(l)}}catch(e){o(e)}},"function"==typeof r.config&&(f=r.config(f,r,t)||f)!==h&&(i=f.abort,f.abort=function(){d=!0,i.call(this)}),null==l?f.send():"function"==typeof r.serialize?f.send(r.serialize(l)):l instanceof e.FormData?f.send(l):f.send(JSON.stringify(l))}),jsonp:s(function(t,r,n,i){var s=r.callbackName||"_mithril_"+Math.round(1e16*Math.random())+"_"+o++,a=e.document.createElement("script");e[s]=function(t){delete e[s],a.parentNode.removeChild(a),n(t)},a.onerror=function(){delete e[s],a.parentNode.removeChild(a),i(new Error("JSONP request failed"))},a.src=t+(t.indexOf("?")<0?"?":"&")+encodeURIComponent(r.callbackKey||"callback")+"="+encodeURIComponent(s),e.document.documentElement.appendChild(a)})}}},function(e,t,r){"use strict";var n=r(4);e.exports=r(28)(window,n)},function(e,t,r){"use strict";(function(t){var n=r(2),o=r(7),i=r(9),s=r(5),a=r(6),l=r(29),c=r(14),u={};e.exports=function(e,r){var f;function d(t,r,n){if(t=s(t,r),null!=f){f();var o=n?n.state:null,i=n?n.title:null;n&&n.replace?e.history.replaceState(o,i,y.prefix+t):e.history.pushState(o,i,y.prefix+t)}else e.location.href=y.prefix+t}var h,p,m,g,v=u,w=y.SKIP={};function y(o,s,b){if(null==o)throw new Error("Ensure the DOM element that was passed to `m.route` is not undefined");var A,O=0,E=Object.keys(b).map(function(e){if("/"!==e[0])throw new SyntaxError("Routes must start with a `/`");if(/:([^\/\.-]+)(\.{3})?:/.test(e))throw new SyntaxError("Route parameter names must be separated with either `/`, `.`, or `-`");return{route:e,component:b[e],check:l(e)}}),P="function"==typeof t?t:setTimeout,x=i.resolve(),j=!1;if(f=null,null!=s){var k=a(s);if(!E.some(function(e){return e.check(k)}))throw new ReferenceError("Default route doesn't match any known routes")}function S(){j=!1;var t=e.location.hash;"#"!==y.prefix[0]&&(t=e.location.search+t,"?"!==y.prefix[0]&&"/"!==(t=e.location.pathname+t)[0]&&(t="/"+t));var n=t.concat().replace(/(?:%[a-f89][a-f0-9])+/gim,decodeURIComponent).slice(y.prefix.length),o=a(n);function i(){if(n===s)throw new Error("Could not resolve default route "+s);d(s,null,{replace:!0})}c(o.params,e.history.state),function e(t){for(;t<E.length;t++)if(E[t].check(o)){var s=E[t].component,a=E[t].route,l=s,c=g=function(i){if(c===g){if(i===w)return e(t+1);h=null==i||"function"!=typeof i.view&&"function"!=typeof i?"div":i,p=o.params,m=n,g=null,v=s.render?s:null,2===O?r.redraw():(O=2,r.redraw.sync())}};return void(s.view||"function"==typeof s?(s={},c(l)):s.onmatch?x.then(function(){return s.onmatch(o.params,n,a)}).then(c,i):c("div"))}i()}(0)}return f=function(){j||(j=!0,P(S))},"function"==typeof e.history.pushState?(A=function(){e.removeEventListener("popstate",f,!1)},e.addEventListener("popstate",f,!1)):"#"===y.prefix[0]&&(f=null,A=function(){e.removeEventListener("hashchange",S,!1)},e.addEventListener("hashchange",S,!1)),r.mount(o,{onbeforeupdate:function(){return!(!(O=O?2:1)||u===v)},oncreate:S,onremove:A,view:function(){if(O&&u!==v){var e=[n(h,p.key,p)];return v&&(e=v.render(e[0])),e}}})}return y.set=function(e,t,r){null!=g&&((r=r||{}).replace=!0),g=null,d(e,t,r)},y.get=function(){return m},y.prefix="#!",y.Link={view:function(e){var t,r,n=e.attrs.options,i={};c(i,e.attrs),i.selector=i.options=i.key=i.oninit=i.oncreate=i.onbeforeupdate=i.onupdate=i.onbeforeremove=i.onremove=null;var s=o(e.attrs.selector||"a",i,e.children);return(s.attrs.disabled=Boolean(s.attrs.disabled))?(s.attrs.href=null,s.attrs["aria-disabled"]="true",s.attrs.onclick=null):(t=s.attrs.onclick,r=s.attrs.href,s.attrs.href=y.prefix+r,s.attrs.onclick=function(e){var o;"function"==typeof t?o=t.call(e.currentTarget,e):null==t||"object"!=typeof t||"function"==typeof t.handleEvent&&t.handleEvent(e),!1===o||e.defaultPrevented||0!==e.button&&0!==e.which&&1!==e.which||e.currentTarget.target&&"_self"!==e.currentTarget.target||e.ctrlKey||e.metaKey||e.shiftKey||e.altKey||(e.preventDefault(),e.redraw=!1,y.set(r,null,n))}),s}},y.param=function(e){return p&&null!=e?p[e]:p},y}}).call(this,r(11).setImmediate)},function(e,t,r){"use strict";var n=r(6);e.exports=function(e){var t=n(e),r=Object.keys(t.params),o=[],i=new RegExp("^"+t.path.replace(/:([^\/.-]+)(\.{3}|\.(?!\.)|-)?|[\\^$*+.()|\[\]{}]/g,function(e,t,r){return null==t?"\\"+e:(o.push({k:t,r:"..."===r}),"..."===r?"(.*)":"."===r?"([^/]+)\\.":"([^/]+)"+(r||""))})+"$");return function(e){for(var n=0;n<r.length;n++)if(t.params[r[n]]!==e.params[r[n]])return!1;if(!o.length)return i.test(e.path);var s=i.exec(e.path);if(null==s)return!1;for(n=0;n<o.length;n++)e.params[o[n].k]=o[n].r?s[n+1]:decodeURIComponent(s[n+1]);return!0}}},function(e,t,r){"use strict";t.byteLength=function(e){var t=c(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){for(var t,r=c(e),n=r[0],s=r[1],a=new i(function(e,t,r){return 3*(t+r)/4-r}(0,n,s)),l=0,u=s>0?n-4:n,f=0;f<u;f+=4)t=o[e.charCodeAt(f)]<<18|o[e.charCodeAt(f+1)]<<12|o[e.charCodeAt(f+2)]<<6|o[e.charCodeAt(f+3)],a[l++]=t>>16&255,a[l++]=t>>8&255,a[l++]=255&t;2===s&&(t=o[e.charCodeAt(f)]<<2|o[e.charCodeAt(f+1)]>>4,a[l++]=255&t);1===s&&(t=o[e.charCodeAt(f)]<<10|o[e.charCodeAt(f+1)]<<4|o[e.charCodeAt(f+2)]>>2,a[l++]=t>>8&255,a[l++]=255&t);return a},t.fromByteArray=function(e){for(var t,r=e.length,o=r%3,i=[],s=0,a=r-o;s<a;s+=16383)i.push(u(e,s,s+16383>a?a:s+16383));1===o?(t=e[r-1],i.push(n[t>>2]+n[t<<4&63]+"==")):2===o&&(t=(e[r-2]<<8)+e[r-1],i.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return i.join("")};for(var n=[],o=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,l=s.length;a<l;++a)n[a]=s[a],o[s.charCodeAt(a)]=a;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function u(e,t,r){for(var o,i,s=[],a=t;a<r;a+=3)o=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[(i=o)>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return s.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,r,n,o){var i,s,a=8*o-n-1,l=(1<<a)-1,c=l>>1,u=-7,f=r?o-1:0,d=r?-1:1,h=e[t+f];for(f+=d,i=h&(1<<-u)-1,h>>=-u,u+=a;u>0;i=256*i+e[t+f],f+=d,u-=8);for(s=i&(1<<-u)-1,i>>=-u,u+=n;u>0;s=256*s+e[t+f],f+=d,u-=8);if(0===i)i=1-c;else{if(i===l)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,n),i-=c}return(h?-1:1)*s*Math.pow(2,i-n)},t.write=function(e,t,r,n,o,i){var s,a,l,c=8*i-o-1,u=(1<<c)-1,f=u>>1,d=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:i-1,p=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+f>=1?d/l:d*Math.pow(2,1-f))*l>=2&&(s++,l/=2),s+f>=u?(a=0,s=u):s+f>=1?(a=(t*l-1)*Math.pow(2,o),s+=f):(a=t*Math.pow(2,f-1)*Math.pow(2,o),s=0));o>=8;e[r+h]=255&a,h+=p,a/=256,o-=8);for(s=s<<o|a,c+=o;c>0;e[r+h]=255&s,h+=p,s/=256,c-=8);e[r+h-p]|=128*m}},function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}}]);
//# sourceMappingURL=app.js.map